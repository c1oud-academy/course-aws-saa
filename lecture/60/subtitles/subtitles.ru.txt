Добрый день, уважаемые студенты! Рад вас видеть на очередной лекции.
Эта лекция является первой частью большой темы, связанной с Compute.
Это сервисы, связанные с вычислениями в облаке.
В первую очередь это Amazon EC2, о чем сегодня будем с вами говорить.
И так, давайте начнем.
В сегодняшней нашей лекции мы затронем 6 подтем.
В первой части мы вспомним про наш бизнес-кейс в рамках лабораторной работы.
Посмотрим, что мы будем выполнять на этой неделе.
Далее освежим в памяти, что такое сервис Amazon EC2, несколько дополнительных новых деталей.
Далее поговорим подробнее про AMI, что это такое, какие есть преимущества и недостатки.
Далее, на четвертой теме мы подробнее обсудим, как правильно выбрать тип EC2 инстанса в зависимости от use кейсов, бизнес-задачи.
В последних двух темах поговорим о важном функционале, это User Data и какие есть IT-ресурсы, связанные с хранением, которые работают с сервисом Amazon EC2.
Мы начинаем первую часть.
А это именно связано с нашими лабораторными работами, по ходу курса мы будем разрабатывать IT-архитектуру в облаке AWS, которую вы видите на этом слайде.
Каждую неделю мы добавляем новый компонент.
На этой неделе мы будем добавлять EC2 инстансы в связке с Amazon EFS.
Это все, что связано с технической частью.
Теперь подробнее поговорим про сам бизнес-кейс, для чего можно эту техническую задачу решать.
Мы с вами помним, что в рамках бизнес-кейса у нас есть пекарня и кафе, владельцами которых являются Фрэнк и Марта.
Также им в этом помогают София, дочка, и Нихил, работник.
После того, как они запустили статический веб-сайт, количество посетителей увеличилось.
Это очень сильно обрадовало владельцев.
Они начали рассматривать дальнейшие шаги развития и остановились на том, что большее количество посетителей забегает в кафе, чтобы по дороге купить некоторую продукцию и дальше поехать по своим делам.
В связи с этим удобно было бы, в том числе по просьбам клиентов, добавить возможность онлайн заказа на веб-сайт.
То есть, с технической точки зрения, это уже не статический, а динамический веб-сайт, на котором можно оставлять заказ.
Также в рамках этого бизнес-кейса у нас будет возможность посмотреть, какие заказы были сделаны на отдельной странице, чтобы продемонстрировать динамичность этого веб-сайта.
Отлично, на этом мы заканчиваем первую часть и переходим к следующей.
Мы переходим ко второй части нашей сегодняшней лекции.
Перед тем, как начнем, давайте вспомним, какие есть основные сервисы, связанные с вычислениями.
Их можно разделить на пять различных групп.
Отличаются они тем, что в самом первом у нас высокий контроль над инфраструктурой.
Мы можем как угодно кастомизировать ее части.
Таким образом идет смещение до serverless, когда мы большую часть работ по обслуживанию IT-инфраструктуры передаем AWS.
Таким образом делаем лишь ту меньшую часть.
Пройдемся по каждой из групп.
Первая - это Virtual Machines.
Когда мы получаем виртуальную машину, можно к ней подключаться по SSH, сделать необходимые настройки, устанавливать любое приложение.
И в этом случае, если говорить про сервисы, это Amazon EC2, Elastic Compute Cloud, самый основной сервис.
И немного отличающийся, но также предоставляющий виртуальные сервера, это Amazon Lightsail.
Следующий уровень, у нас уже чуть меньше контроля, но тем не менее есть, это Containers.
Самым явным представителем является Amazon ECS, работает с Docker-контейнерами.
Третья группа - PaaS, Platform as a Service, сервис, который ее представляет AWS Elastic Beanstalk.
Идея в том, что вы пишете код вашего приложения, готовите некоторый документ, который описывает конфигурацию вашей инфраструктуры и загружаете в этот сервис.
Далее происходит следующее: AWS Elastic Beanstalk берет на себя все моменты, связанные с поднятием этой инфраструктуры, поднимает все необходимые дополнительные ресурсы и вам уже в удобном виде можно будет через UI, то есть через AWS Management Console управлять вашей инфраструктурой.
Четвертая группа является Serverless, когда мы фактически передаем AWS все, что связано с обслуживанием IT-инфраструктуры, а нам лишь нужно писать код.
Ярким представителем является AWS Lambda, вы пишите код, загружаете ее и AWS все, что связано с обслуживанием, берет на себя.
А вы оплачиваете только за количество гигабайт в секунд исполнения Lambda функции.
В случае, когда у вас ваша Lambda функция не исполняется, вы ни за что не оплачиваете.
Это и есть преимущество Serverless.
Я здесь хотел отметить, обычно, если у вас постоянные нагрузки, которые равномерные, то рекомендуется отдавать предпочтение Amazon EC2 либо ближайшие к нему сервисы.
Если же вы, например, небольшой стартап, либо у вас та часть вашей IT-инфраструктуры, у которой нагрузки непостоянные, они приходят с различными всплесками, есть периоды, когда нагрузка совсем не приходит, в этом случае рекомендуется смотреть в сторону Serverless, так как в момент отсутствия нагрузки вы ничего не оплачиваете.
Таким образом, Serverless решения в подобных нагрузках являются более экономичным решением.
Еще одним представителем Serverless является AWS Fargate.
Это тот сервис, который позволяет нам управлять нашими контейнерами.
Это специальное отдельное Serverless решение, которое помогает с этим справляться.
Также хотелось бы отметить два сервиса из другой категории, связанных с вычислениями.
Это - AWS Outposts.
Идея в том, что вы можете для ваших локальных вычислительных мощностей привязать сервис AWS Outposts и управлять вашими мощностями, как будто бы это AWS мощности.
Второй пример - это AWS Batch, сервис, который позволяет нам выполнять некоторые задачи бачами, то есть некоторыми группами.
На этой лекции мы подробно поговорим про сервис Amazon Elastic Compute Cloud (Amazon EC2).
Что же это такое? Это сервис, который предоставляет нам виртуальные машины, то есть сервера.
У нас есть возможность, используя API либо AWS Management Console, поднимать эти сервера в течение нескольких минут абсолютно в любом количестве.
При необходимости мы можем автоматически настроить масштабирование как в сторону увеличения, так и в сторону уменьшения, в зависимости от нагрузки на IT-инфраструктуру.
Более того, благодаря тому, что сервис облачный, он позволяет нам платить только за те вычислительные мощности, которые нам нужны.
Приведу пример, если мы говорим, что нам нужны кратковременные вычислительные мощности для некоторых расчетов, и эти расчеты при запуске, например, 100 машин занимают 3 дня, мы можем действительно запросить 100 серверов любой конфигурации, которые имеются у AWS, и запустить их на 3 дня.
После того, как мы завершим все наши расчеты, мы можем вернуть обратно эти сервера, и после окончания месяца нам придет счет на оплату именно на эти 3 дня, на то количество серверов, которое работало.
Таким образом, мы платим только за то, что мы используем.
Пару слов о том, из чего состоит Amazon EC2.
Мы с вами знаем, у нас есть AWS Regions, в каждом AWS Regions несколько availability zone, и в рамках availability zone несколько дата-центров.
В дата-центре у нас десятки тысяч серверов, и каждый сервер максимально мощный, насколько это возможно.
Теперь благодаря использованию гипервизора, мы фактически имеем возможность один мощный физический сервер разделить на сотни мелких виртуальных серверов.
Таким образом, в рамках сервиса Amazon EC2 есть возможность выбрать такую конфигурацию, какую мы хотим, из более чем 700 различных вариантов.
Когда мы получаем виртуальный сервер, он в себе содержит CPU, то есть саму вычислительную мощность, RAM, оперативную память, и то, что хранит данные, это либо Instance Store, либо Amazon EBS.
Amazon EBS - это отдельный сервис, который предоставляет нам постоянное хранение.
Instance Store, это временное хранение.
Про особенности и отличия этих двух вариантов хранения мы поговорим чуть позже.
Давайте пару слов скажем про use cases использование сервиса Amazon EC2.
Обычно этот сервис выбирается, если нам нужен полный контроль над вычислительными ресурсами.
При работе с виртуальными серверами мы можем установить любое приложение, сконфигурировать его так, как мы хотим, и никто нас в этом не ограничивает.
Мы можем установить любую операционную систему, и таким образом практически любую IT-инфраструктуру, любое приложение, которое хостится на локальном дата-центре, работающих на физических серверах, можно перенести на сервис Amazon EC2 в облако AWS.
Также мы начинаем использовать сервис Amazon EC2 в случае, если мы хотим оптимизировать наши расходы на вычислительные мощности.
У нас есть возможность купить Reserved Instances, использовать Spot Instances, а также есть Savings Plans, которые дают значительные скидки за использование виртуальных серверов Amazon EC2.
При настройке виртуального сервера EC2 нам необходимо принять несколько решений.
Давайте пройдемся по самым основным шагам.
Самое первое - нужно определиться с AMI, либо это AMI, который мы сами приготовим, либо использовать существующий AMI от AWS.
Далее, мы определяем какой тип инстанса мы будем использовать.
В этом случае мы должны знать какое количество процессоров, какое количество оперативной памяти и хранения нам нужно.
Далее, мы можем дополнительно указать как мы хотим, чтобы наши EC2 инстансы располагались в дата-центре.
Про это мы поговорим в следующих слайдах.
Если наше приложение работает с другими сервисами, то также необходимо настроить роль, которая будет использовать наш инстанс и обращаться к другим сервисам.
Необходимо также понять будем ли мы использовать User Data или нет.
Часть команд по преднастройке нашего инстанса мы можем добавить в AMI, часть по некоторым причинам расположить в AMI не получится, поэтому необходимо настроить User Data, который будет исполнять некоторые команды в момент поднятия инстанса.
Нужно решить также вопросы связанные с хранением.
У нас есть два варианта, как мы помним, есть возможность использовать Instance store, это старая опция или использовать Amazon EBS, отдельный сервис, который предоставляет нам Persistent Block Storage, то есть постоянное блочное хранение, что является рекомендацией и best practice от AWS.
Далее необходимо рассмотреть вопросы, связанные с безопасностью - это настройка Security Group, какой трафик разрешен, какой трафик запрещен и самое последнее Key pair, это ключ, который позволяет нам подключаться удаленно через SSH к нашим виртуальным серверам.
На этом мы подошли к концу второй части нашей сегодняшней лекции, освежили в памяти что же такое сервис Amazon EC2, какие возможности он нам предоставляет, также остановились на тех шагах, которые необходимо выполнить для успешной настройки и запуска нашего сервера.
Первый и самый основной - это выбор AMI, что такое AMI и какие возможности оно нам предоставляет мы рассмотрим в третьей части нашей сегодняшней лекции.
Теперь рассмотрим что такое AMI, расшифровывается как Amazon Machine Image, это некий template шаблон, который позволяет нам на базе этого шаблона поднимать виртуальные сервера EC2.
Как вы видите на картинке с использованием одного лишь AMI мы можем поднять абсолютно идентичные EC2 инстансы.
AMI описывает root volume, то есть корневой раздел жесткого диска, на котором устанавливается операционная система, а также возможно некоторое программное обеспечение.
Далее здесь же описывается информация какие аккаунты могут использовать этот AMI.
Третий пункт - это описание дополнительных разделов жесткого диска для целей хранения.
Какие же преимущества нам предоставляет AMI, это 3R - Repeatability, Reusability и Recoverability.
Идея в том, что мы создаем этот шаблон один раз и используем его много раз.
Более того исключается человеческий фактор и какая-то часть конфигурации настроек сидит в этом шаблоне и возможность получить другую конфигурацию просто невозможна.
Таким образом исключается человеческий фактор.
Другой момент, мы можем использовать AMI самым примитивным образом, это настроить некоторый сервер, установить все необходимое ПО, убедиться, что все работает как нам нужно и от этого сервера создать AMI.
Это будет кастомный шаблон, который вы можете использовать для восстановления.
В случае, если что-то происходит и ваш сервер падает, то вы оперативно, используя ваш кастомный AMI, можете поднять и вернуть в строй.
Это естественно самое простое использование.
Есть более продвинутые практики использования AMI, о которых мы поговорим с вами в дальнейшем.
Давайте теперь остановимся на основных моментах, которые позволяют выбрать правильный AMI.
Существует 5 различных пунктов.
Первый и основной - это регион.
Мы с вами помним, что AMI создается в рамках определенного AWS региона и используется там же.
В случае, если вы хотите использовать этот AMI в другом регионе, то вам необходимо ее скопировать.
Это достаточно просто делается.
В этом случае копия получает отдельный уникальный ID этого AMI и дальше используется уже независимо.
Второй пункт - это выбор операционной системы.
Мы не ограничены абсолютно ничем.
Можем установить любую операционную систему.
Наиболее частыми вариантами в этом случае являются либо Windows OS, либо некоторые вариации Linux OS.
Далее необходимо определиться с IT ресурсом хранения.
Это может быть EBS, отдельный сервис, который помогает нам обеспечить постоянное блочное хранение, либо это Instance Store.
Instance Store - это та память, которая физически находится возле нашей виртуальной машины.
Она не рекомендуется, так как это старый вариант использования и как best practice рекомендуется использовать EBS ввиду его преимуществ.
На этом мы более подробно остановимся на следующих слайдах.
Четвертый пункт - это выбор архитектуры.
Мы можем выбрать либо 32-битную либо 64-битную.
Более того можем выбрать ARM архитектуру.
Также появилась собственная разработка от AWS Graviton.
Есть определенные преимущества.
Подробно можете ознакомиться на официальной документации AWS.
Там проводятся различные сравнения для различных типов нагрузок, какие архитектуры работают лучше.
Последний пункт - тип виртуализации.
Есть два варианта, PV Paravirtual и HVM Hardware Virtual Machine.
В большинстве случаев рекомендуется использовать HVM.
Если же мы говорим про источники откуда мы можем получить AMI.
Первый - это Quick Start.
Это готовые AMI предоставленные от AWS.
Второй - это так называемые My AMIs.
Это все те AMI, которые мы сами создаем для себя, кастомные AMI.
Далее, есть AWS Marketplace.
Это специальное место, в котором вы можете использовать AMI созданный другими компаниями.
При этом никаких гарантий AWS не предоставляет.
Поэтому использование здесь на ваш страх и риск.
В AWS Marketplace вы можете найти как бесплатные так и платные AMI от популярных вендоров.
Например, Red Hat и другие.
Четвертый - это Community AMIs.
Это те AMI, которые были созданы пользователями AWS.
Здесь также AWS не несет никакой ответственности и вы используете эти AMI на свой страх и риск.
Мы с вами добрались до сравнения двух типов хранения для Root Volume.
Это Instance Store либо Amazon EBS.
Предоставлена таблица в пяти различных характеристиках.
Давайте пройдемся по каждому.
Запуск инстанса с EBS намного быстрее чем запуск с Instance Store.
Это связано с тем, что Instance Store хранит некоторые части данных в Amazon S3.
И загрузка данных с Amazon S3 занимает некоторое время.
Максимальный размер Root Volume для EBS - 16 ТБ, а для Instance Store всего лишь 10 ГБ.
Но для большинства задач 10 ГБ более чем достаточно.
Если говорим про возможность останавливать инстансы, это можем сделать для инстансов с EBS.
И в момент когда инстанс остановлен, мы за это не несем никаких затрат.
Если мы говорим про Instance Store, остановить такой инстанс невозможно, его можно лишь перезагрузить, либо терминейтнуть, то есть отключить.
В момент когда вы отключаете все данные, которые хранились в Instance Store, пропадают.
Если мы говорим про возможность изменять тип инстанса, то в случае с EBS это очень легко делается.
Вы можете в любой момент остановить инстанс, изменить Instance type, и в момент когда вы ее включите обратно, Instance type уже будет изменен.
Если мы говорим про Instance Store, то это сделать невозможно ввиду того, что это тот раздел жесткого диска, который находится физически рядом с виртуальным сервером.
Поэтому при смене Instance type вас перекинет уже на другой физический сервер, у которого свой Instance store.
Таким образом нет возможности изменить Instance type.
Если мы говорим про вопросы оплаты, то в случае с EBS вы несете затраты по тарифам сервиса Amazon EBS.
В случае когда мы говорим про затраты Instance Store, это те затраты, связанные с хранением данных в Amazon S3.
Зачастую хранение данных в Amazon S3 дешевле чем в EBS.
Если мы говорим про гигабайты, до 100 гигабайтов, то эти затраты они минимальные, отличаются не сильно.
Поэтому следует этот момент также учитывать.
Если у вас очень большое количество серверов и вам достаточно преимуществ и недостатков Instance Store, то вы ее можете использовать и получать некоторую выгоду ввиду того, что данные хранятся в Amazon S3 и это дешевле.
Во всех остальных случаях рекомендуется как best practice использовать Amazon EBS для Root Volume.
Давайте теперь поговорим немного про Instance Lifecycle, то есть жизненный цикл EC2 инстанса.
Все начинается из состояния Pending.
Когда мы запускаем первый раз наш инстанс из AMI поднимается сервер.
И в момент когда она включается она в состоянии Pending.
В состояние Pending мы так же можем попадать из состояния Stopped.
Это относится только к Amazon EBS-backed Instances, которые мы можем останавливать.
Так вот когда мы остановили ее, и включаем, в первую очередь она переходит из состояния Stopped в состояние Pending.
Далее, как только она включится и будет готова к работе, из состояния Pending она перейдет в состояние Running.
С этого момента вы можете по SSH подключаться к этому EC2 инстансу и работать с ней.
Включенный инстанс вы можете перезагружать.
Она переходит в состояние Rebooting и возвращается обратно в состояние Running.
Когда мы делаем reboot, его публичный IP адрес и физический сервер остаются теми же, если физически не было проблем с этим сервером.
Для Amazon EBS-backed Instances у нас есть возможность ее останавливать.
Как только мы это делаем из состояния Running она переходит в состояние Stopping.
После того как она полностью остановится, она переходит в состояние Stopped.
Мы также можем отправить наши Amazon EBS-backed Instances на гибернацию.
Когда текущее состояние сохраняется в операционной памяти.
Таким образом она быстрее включается.
В этом случае, она также переходит через Stopped и Pending и в итоге переходит в состояние Running.
Отличие от остановки и гибернации в том, что в случае с гибернацией мы сохраняем физический сервер.
Он запускается на нем же, сохраняются его приватные и публичные IP адреса и вы продолжаете с этой машиной работать.
В том случае если физически не было проблем с этим сервером.
В случае, когда мы ее останавливаем, то физический сервер, который хостит нашу виртуальную машину, может сменится.
Последнее состояние - это остановка.
Если машина работает и мы ее терминейтим, она переходит в состояние Shutting down, т.е. отключается и в итоге переходит в состояние Terminated.
Какое-то время в AWS Management Console у вас будет отображаться как Terminated и через некоторое время совсем пропадет.
В состоянии Terminated мы можем переходить из состояния Stopped, то есть если Amazon EBS-backed Instance был остановлен, то не переводя ее в состояние Running, можем терминейтить.
Пару слов хотелось бы сказать про создание нового AMI.
Представим, что мы находимся в регионе A.
Есть некоторые AMI, будь то созданные нами, будь то AMI предоставленные от AWS либо любой другой.
Во время запуска инстанса мы получаем точную копию AMI, уже в запустившемся инстансе будет у нас Unmodified instance.
Далее мы можем подключаться к этому инстансу, проводить некоторые манипуляции.
Еще один подход к созданию AMI - это сервис EC2 Image Builder.
Используя этот сервис, вы можете с легкостью в понятном UI интерфейсе автоматизировать создание, управление, обслуживание, развертывание, а также работа с контролем версии ваших AMI.
На этом слайде вы видите image pipeline сервиса EC2 Image Builder.
Он состоит из 5 основных шагов.
Самым первым делом вам нужно выбрать source image, то есть это операционная система, на котором будет базироваться ваш AMI.
Можете выбрать Amazon Linux 2, Windows операционную систему, Ubuntu и так далее.
Вторым шагом предлагается определить список компонентов.
Вы указываете какие приложения, какое ПО будет установлено.
Один из примеров - это установка языка программирования Python.
Третьим шагом предлагается запустить так называемые Hardening Tests для проверки безопасности.
Есть специальные тесты, которые предоставляются от AWS.
Также вы можете добавить и включить здесь свои собственные тесты.
После того как AMI проходит проверку на безопасность мы переходим к четвертому шагу.
Четвертый шаг - это расписание того как часто будут создаваться новые AMI.
Может возникнуть вопрос: для чего нам необходимо на периодической основе создавать AMI? Ответ достаточно прост.
Мы с вами знаем что, что операционные системы, что программное обеспечение не стоят на месте и развиваются.
И один из видов обновления это ни сколько новый функционал, а обновление безопасности, то есть патчи безопасности.
Так вот это расписание позволяет вам создавать AMI ровно с таким же составом компонентов внутри, но при этом уже будут применены новые обновления тех или иных приложении.
Последним шагом вам необходимо определить на какие регионы будут распространяться ваши AMI.
Вы можете выбрать один основной или несколько регионов, если вы хостите свою инфраструктуру в нескольких регионах.
На этом мы заканчиваем третью часть нашей сегодняшней лекции.
Мы разобрали основные моменты связанные с AMI.
Мы с вами добрались до четвертой части нашей сегодняшней лекции и поговорим о нюансах выбора типа инстанса EC2.
Что такое тип инстанса? Это - некоторая уникальная конфигурация, которая включает в себя характеристики CPU процессорных мощностей.
Далее, Memory, это операционная память.
Storage - хранилище, наши жесткие диски.
И Network Performance, то есть свойства железа по работе с сетью.
Название типа инстанса состоит из нескольких частей.
Вы это можете видеть на слайде.
Самое первое - это семейство типов инстансов.
Про них мы поговорим на следующих слайдах.
В этом случае это семейство m.
Далее, вторым обязательно идет номер поколения.
В нашем случае m5 - это значит инстанс из семейства m 5-го поколения.
Каждый год Amazon увеличивает это число и предлагает еще более привлекательные условия: обычно за ту же цену предлагается машина более мощная, либо лучше предыдущего поколения.
Например, m6 будет точно такой же по цене, но по характеристикам может быть лучше.
Третья часть - это некоторые дополнительные возможности.
В этом случае вы видите букву d, она означает, что этот тип инстанса для жесткого диска использует тип SSD вместо HDD.
После этих основных частей через точку описывается размер инстанса.
Есть определенная градация, начиная от nano, micro и так далее.
Например xlarge, говорит о том, что этот инстанс extra large.
Также можете видеть характеристики.
У него 4 ядра процессора.
Оперативная память на 16 ГБ.
Один жесткий диск на 150 ГБ.
И Network performance - мы можем передавать данные по сети до 10 гигабитов в секунду.
Увеличение размера увеличивает соответственно одну или несколько характеристик, которые вы видите в левой части этого слайда.
На следующих двух слайдах мы разберем 5 самых популярных семейств типов инстансов.
Для каждого семейства будут даны примеры использования, а также буквенные обозначения.
Давайте пройдемся по каждому.
Самый популярный, подходящий для большинства случаев - General Purpose.
Буквенные обозначения - M, T, A.
Далее идет Compute optimized, это те инстансы при всех прочих равных условиях будет большее количество ядер CPU.
Буквенные обозначения - C, возможно CN, где N - дополнительно увеличиваются характеристики по работе с сетью.
Далее, у нас есть семейство Memory optimized, увеличенный объем оперативной памяти RAM.
Буквенные обозначения - R, X и HMI.
После этого есть у нас семейство - Storage Optimized.
Они ориентированы по работе с операциями ввода-вывода по работе с жестким диском.
Примерами буквенных обозначений могут быть I, D, H.
И еще одно также набирающее популярность семейство - это Accelerated Computing, используется для тренировки моделей нейронных сетей, машин обучения, все те нагрузки, которые требовательны к ресурсам видеокарты.
Буквенное обозначение - P, G и F.
При всех прочих равных характеристиках в типах инстансов из Accelerated Computing будет дополнительно или увеличенное количество памяти для видеокарты.
Для того, чтобы принять решение какой тип инстанса подходит вам необходимо учесть основные два пункта.
Первое - это знать какие нагрузки будут на ваше приложение.
Второе - знать бюджет.
Чем мощнее инстанс, очевидно это будет требовать больших денежных затрат.
Для того, чтобы определиться с типом нового инстанса, вы можете на основной странице сервиса EC2 перейти на вкладку Instance Types и посмотреть какие виды есть.
Есть удобный фильтр, можно отфильтровать и оставить нужные семейства либо наоборот зафиксировать количество некоторой характеристики.
Например, количество процессорных ядер, и посмотреть какие варианты у вас остаются.
Рекомендуется использовать последнее поколение так как оно самое оптимальное с точки зрения цены и качества.
Если вы работаете уже с существующим инстансом, видите, что есть необходимость обновить тип инстанса, рекомендуется посмотреть в сторону сервиса AWS Compute Optimizer.
Она использует историю нагрузки на ваши EC2 инстансы и дает некоторые рекомендации по типу инстансов, по их размерам, количеству и даже конфигурации Auto Scaling группы.
По результатам анализа он может выдать вам вердикт, а именно по вашим инстансам или они перегружены, недогружены, оптимизированы или с пометкой None, что говорит о том, что информации по нагрузкам недостаточно для конкретного инстанса.
На этом мы разобрали основные вопросы, связанные с выбором типа инстанса EC2.
Переходим к следующей части.
Мы с вами добрались до пятой части нашей лекции и поговорим про User Data.
Что же такое User Data? Для чего мы ее можем использовать? User Data - это набор некоторых команд, которые отрабатывают во время инициации вашего инстанса.
Если говорить про LifeCycle инстанса, то все команды внутри User Data отрабатывают в шаге Pending.
Обратите внимание, что User Data запускается только при первом запуске.
Поэтому после того как вы остановите, еще раз запустите, либо перезагрузите ваш инстанс, User Data отрабатывать не будет.
Зачем использовать User Data? Обычно там есть список команд, которые обновляют существующее ПО.
Это ПО уже включено в AMI.
Но может там быть не самой последней версии.
Поэтому используя User Data в момент запуска вы подтягиваете самые последние изменения и дозагружаете обновление вашего ПО.
Также в User Data попадают те команды, которые требуют непосредственной привязки к инстансу.
Например, некоторые команды могут использовать метаданные вашего инстанса, может быть публичные или внутренние API для дополнительной настройки.
В этом случае мы не можем добавить ее в AMI.
И она будет находиться в User Data.
Также в User Data запускаются команды для старта веб-сервера.
В этом случае обратите внимание, что User Data запускается только один раз.
Поэтому помимо запуска веб-сервера в первый раз вам также необходимо внести некоторые вправки в автозагрузку, чтобы при каждом включении и выключении вашего инстанса стартовал веб-сервер, либо любое другое программное обеспечение.
Если же говорить в сравнении, куда передавать те или иные команды, в AMI или UserData так как они достаточно заменяемы, отвечу следующим образом.
Всегда должен быть некоторый баланс.
Все те команды, которые вы можете вложить в AMI, желательно положить туда, это первая часть команд.
Вторая часть команд по обновлению и все нюансы, которые говорил ранее следует добавить в User Data.
Так как большой объем команд в User Data замедлит старт вашего инстанса.
Когда у вас будет баланс, часть команд будет на стороне AMI, и часть команд на стороне User Data, то с одной стороны у вас будет актуальный AMI, с другой стороны инстанс будет запускаться намного быстрее, потому что User Data не такая большая.
В итоге вы получаете инстанс с обновленным ПО и полностью готовым к работе.
Раз уж мы заговорили об информации про наш инстанс, так называемый instance metadata, давайте остановимся на том, где и как эту информацию можно получить.
На уровне каждого инстанса есть некоторый URL.
Это 169.254.169.254/latest/meta-data/.
По этому адресу находится основная информация, связанная непосредственно к этому инстансу.
Этот URL доступен только на уровне конкретного инстанса.
Также если вместо metadata написать User Data, то вы получите список тех команд, которые есть в вашей User Data.
Также можете ее использовать для дополнительной настройки.
Когда я говорил про баланс команд на стороне AMI и User Data естественно нет универсального ответа.
Всегда надо смотреть на конкретную бизнес-задачу.
Давайте рассмотрим 4 различных варианта того, где могут находиться ваши команды в AMI и UserData, какие это преимущества дает и какие у каждого подхода есть недостатки.
Если вы обратите внимание, что на самом верху есть стрелка Flexibility, то есть каждый следующий вариант, слева направо, дает большую гибкость.
Если посмотреть на стрелку внизу Simplicity, противоположное, и мы справа налево упрощаем работу с нашими EC2 инстансами, но при этом теряем в гибкости.
Давайте подробнее посмотрим на каждый из конфигураций.
Самый первый - это Fully baked AMI, в котором все абсолютно команды необходимые для запуска, начиная от операционной системы, ее дополнительные настройки, подготовки среды для приложения и установки, соответственно, самого приложения происходит на стороне AMI.
В этом случае ваш инстанс запускается максимально быстро и User data может быть совсем пустой.
Это связано с тем, что AMI вы готовите асинхронно.
Она уже предварительно приготовлена, все готово.
В момент необходимости запуска вы включаете только сервер и все остальное у вас готово.
Плюсом может быть то, что вы очень быстро запускаете ваши сервера и они в самое максимально быстрое время готовы к работе.
Недостатком может являться то, что любое приложение для корректной работы требует другое ПО и возможно не одно.
Каждое из этих ПО независимо друг от друга развивается, выходят патчи безопасности, обновление функционала и так далее.
Поэтому с этим подходом рекомендуется чаще готовить или обновлять ваши AMI.
Следующие два пункта увеличивают гибкость, но при этом немного усложняет работу с вашим инстансом в том плане, что есть отдельный набор команд на стороне AMI и отдельный набор команд на стороне User Data.
В первом случае у вас приложение устанавливается только в момент запуска приложения.
Это может быть необходимо так как внутри AMI не получится добавить те команды по настройке вашего приложения.
Это тот случай когда вы используете некоторые данные о конкретном инстансе.
Все остальное находится внутри AMI.
Более гибкий подход - это когда вы настраиваете операционную систему, устанавливаете все необходимые ПО для корректного функционирования этой операционной системы внутри AMI, а вторую часть, а именно подготовку среды для вашего приложения и непосредственно установка вашего приложения проделываете внутри User Data.
В этом случае она запускаться будет еще дольше, но при этом вы получаете гибкость и любые команды могут быть изменены на стороне User Data.
Новый AMI для этого выпускать не нужно.
Последнее - это JeOS, расшифруется как Just Enough OS.
Простыми словами это только операционная система.
Все остальное, настройка операционной системы, патчи безопасности, настройка мониторинга и логирования и все что выше, подготовка среды для приложения и само приложение на стороне User Data.
В этом случае вам достаточно выбрать любой подходящий для вас AMI, который предоставляет AWS и все необходимые настройки производить на стороне User Data.
В этом случае ничего связанного с AMI делать не нужно.
Достаточно использовать уже готовые, но при этом нужно будет менеджить User Data и понимать, что у вас максимальная гибкость.
Вы можете менять очень часто ваши User Data, не меняя AMI, но при этом понимаете, что запуск вашего инстанса требует намного больше времени ввиду того, что она фактически полноценно будет настраиваться только в момент запуска.
На этом мы разобрали все, что связано с User Data в EC2 инстансе.
На этом мы заканчиваем пятую часть и двигаемся дальше.
Мы с вами добрались до шестой части нашей сегодняшней лекции и затронем все аспекты, связанные с хранением при работе с сервисом Amazon EC2.
Как мы знаем у нас есть два раздела, это Root volume и Data volume.
В Root volume мы устанавливаем нашу операционную систему, все приложения.
А в Data volume храним данные.
Root volume может быть Instance store либо поддерживаться Amazon EBS.
Если мы говорим про Data volume, то они опциональные, их может и не быть.
Если мы говорим про данные, которые доступны только для текущего инстанса, то мы можем использовать наш Instance store, хоть он и небольшой и ограничен.
Также мы можем добавить дополнительные независимые от Root volume, EBS жесткие диски.
Если же мы говорим, что нам нужно хранилище, общедоступное среди всех EC2 инстансов, то нам на помощь приходят еще два сервиса.
Первый - это Amazon EFS для Linux based серверов.
И второй - это Amazon FSx For Windows File Server.
Это аналогичный сервис только для машин с операционной системой Windows.
Давайте остановимся на каждом из вариантов более подробно.
Самый первый - это Instance store.
Instance store - это непостоянное блочное хранилище.
На него можно установить операционную систему.
У нее есть некоторые ограничения, которые мы рассмотрели ранее, в том числе преимущества.
Самый основной момент, который связан с Instance store, это то, что его невозможно остановить.
Если же у вас есть лишние инстансы и вам необходимо их отключить, то при отключении все те данные, которые хранятся в Instance store, будут потеряны.
Поэтому в Instance store данные хранить можно, но это такие кеш данные либо данные, которые можно с легкостью восстановить и не страшно потерять.
В этом случае можно использовать Instance store.
Следующий - это Amazon EBS.
Это жесткие диски, которые подключены через интернет.
Они не относятся физически к нашему виртуальному серверу.
И есть у нее ряд преимуществ.
Best practice - это использовать EBS, так как преимуществ намного больше, но по оплате выходит немного дороже ввиду того, что жесткие диски обычно устанавливаются не более 100 гигабайтов, то разница в цене не ощутима и те преимущества, которые вы получаете намного больше.
Основные преимущества, которые вы получаете при работе с Amazon EBS, можно отсоединить ваш жесткий диск от инстанса и подключить к другому инстансу и дальше продолжать работать с этим жестким диском.
Также это то, что вы можете использовать различные типы жестких дисков - это SSD либо HDD.
Другой момент, то что вы можете создавать снапшоты, которые будут храниться в Amazon S3.
Давайте рассмотрим какие типы volume-ов сервиса Amazon EBS нам доступны.
Есть 4 вида, подразделяются на 2 группы - SSD-backed Volumes и HDD-backed Volumes.
Если мы говорим про Root Volume, это тот volume на который устанавливается операционная система, то она должна быть только типа SSD.
Таким образом у нас только два варианта для Root Volume - General Purpose SSD (gp2) либо Provisioned IOPS SSD (io1).
Для большинства случаев типа General Purpose SSD будет достаточно.
Она достаточно быстро работает.
В случае, если вам помимо скорости также важна высокая пропускная способность, то нужно смотреть в сторону Provisioned IOPS SSD.
Оно дороже, но при этом вы получаете скорость и пропускную способность.
Если мы говорим про вторую группу - это HDD-backed Volumes, они не подходят как для Root Volume, но при этом вы можете использовать эти volume как Data Volume для хранения данных.
Выделяют два вида, первый - это Throughput Optimized HDD (st1).
Второй - это Cold HDD (sc1).
Первый - это стандартные HDD диски.
В случае если у вас нагрузки, требующие высокую пропускную способность и при этом данные часто запрашиваются, в этом случае st1 это ваш выбор.
В случае если вы хотите сэкономить на ваших жестких дисках, при этом данные не часто запрашиваются, то Cold HDD идеальный вариант.
Есть еще один функционал, который помогает нам увеличить I/O Performance, то есть Input Output операции, связанные с жесткими дисками - это Amazon EBS-optimized Instances.
Это такой функционал, который поддерживается не всеми EC2 инстансами и в случае если оно поддерживается, то между вашим виртуальным сервером EC2 инстанса и отдельно стоящим EBS Volume настраивается выделенное сетевое подключение.
Это увеличивает скорость передачи данных.
Давайте теперь рассмотрим оставшиеся два сервиса, которые нам помогают предоставить общий доступ для наших EC2 инстансов.
В этом случае EBS нам не поможет, так как в один момент времени EBS Volume может быть подключен только к одному инстансу.
Да, можно переподключить, но для этого нужно отключить от предыдущего инстанса.
Если мы говорим про S3, оно доступно для всех инстансов.
Можно произвести соответствующие настройки, но оно не идеальное так как это не блочное, а объектное хранилище, в зависимости от типа нагрузок может не подойти.
В случае если вам нужен именно жесткий диск, блочное хранилище, которое доступно для всех ваших для всех ваших EC2 инстансов, то рекомендуется использовать Amazon EFS для Linux операционных систем и Amazon FSx for Windows File Server, это специально для EC2 машин с операционной системой Windows.
Давайте отдельно рассмотрим каждый сервис.
Amazon EFS, еще раз повторюсь, предназначен для Linux-based нагрузок.
Она монтируется через NFS протоколы к EC2 инстансу.
Может увеличиваться в размере до петабайтов.
Также оно автоматически масштабируется как в сторону увеличения так и в сторону уменьшении, вы оплачиваете только за то, что используете.
Например, пол месяца вы хранили 100 гигабайт данных, а остальную часть времени вы хранили 10 гигабайт данных.
И соответственно, оплата будет ровно столько сколько вы использовали.
На этом слайде вы можете видеть примеры EFS use cases.
Это как раз таки все те случаи, когда нам нужен общий доступ в одном месте для всех ваших EC2 инстансов.
Также вы видите пример команды для монтирования EFS в ваши EC2 машины.
Аналогичный с Amazon EFS сервис - Amazon FSx for Windows File Server.
Он поддерживает работу с EC2 инстансами с операционной системой Windows.
Поддерживает технологию NTFS.
Нативно интегрирована с Microsoft Windows.
Также интегрируется с Microsoft Active Directory и поддерживает Windows Access Control Lists (ACLs).
Это значит, что вы в Amazon FSx можете хранить все данные ваших сотрудников.
Они будут храниться в одном месте и доступны с любой EC2 машины, на котором стоит Windows операционная система.
И более того, вы можете разграничить право доступа так, чтобы сотрудники не могли видеть персональные данные других сотрудников.
На этом слайде вы также видите другие примеры.
Идея в том, что у вас, благодаря этому сервису будет отдельно стоящий общедоступный жесткий диск, на котором вы можете записывать и совместно использовать общие данные.
На этом мы заканчиваем шестую секцию.
Это последняя секция в рамках нашей сегодняшней лекции.
Разобрали вопросы хранения, связанные с сервисом Amazon EC2.
На этом мы подошли к концу сегодняшней лекции.
Рассмотрели ряд вопросов, связанных с EC2.
Я хотел бы отметить, что это первая часть из двух, посвященной теме Compute.
Сегодня мы разобрали следующие темы.
Поговорили про AMI, зачем она нужна, какие преимущества дает.
Далее, рассмотрели подробнее, что такое Instance Type, какие семейства бывают, чем они отличаются, как выбрать оптимальный для себя Instance Type.
Далее поговорили про User Data, для чего она нужна, какие преимущества дает.
И в конце рассмотрели все моменты, связанные с хранением в рамках использования сервиса Amazon EC2.
На этом мы заканчиваем нашу сегодняшнюю лекцию.
Спасибо за внимание.
Увидимся с вами на следующих наших активностях.
