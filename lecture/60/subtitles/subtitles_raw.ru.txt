 Добрый день, уважаемые студенты! Рад вас всех видеть на очередной лекции. Эта лекция является первой частью большой темы, связанной с Compute. Это сервисы, связанные с вычислениями в облаке. В первую очередь это EC2, о чем мы сегодня будем с вами говорить. Итак, давайте начнем. В сегодняшней нашей лекции мы затронем 6 под тем. В первой части мы вспомним про наш бизнес-кейс в рамках лабораторной работы. Посмотрим, что мы будем выполнять на этой неделе. Далее освежим в памяти, что же такое сервис Amazon EC2. Несколько дополнительных новых деталей. Далее поговорим подробнее про AMI, что это такое, какие есть преимущества и недостатки. Далее на четвертой теме мы подробнее обсудим, как правильно выбрать тип EC2-инстанца. В зависимости от use-кейсов, зависимости от вашей бизнес-дадачи. И в последних двух темах поговорим о так же важном функционале, это User Data. И какие есть IT-ресурсы, связанные с хранением, которые работают с сервисом Amazon EC2. Мы начинаем первую часть. А это именно связано с нашими лабораторными работами, по ходу курса мы будем разрабатывать IT-архитектуру в облаке AWS, которую вы видите на этом слайде. Каждую неделю мы добавляем новый компонент. На этой неделе мы будем добавлять EC2-инстанции в связке с Amazon EFS. Это все, что связано с технической частью. Теперь давайте подробнее поговорим про сам бизнес-кейс, для чего можно эту техническую задачу решать. Мы с вами помним, что в рамках бизнес-кейса у нас есть пекарня и кафе, владельцами которых являются Фрэнк и Марта. Также им в этом помогают София, дочка и Ини Хилл, работник. После того, как они запустили статический веб-сайт, количество посетителей увеличилось. Это очень сильно обрадовало владельцев. Они начали рассматривать дальнейшие шаги развития и остановились на том, что большее количество посетителей забегает в кафе, для того, чтобы по дороге купить некоторую продукцию и дальше поехать по своим делам. В связи с этим удобно было бы, в том числе по просьбам клиентов, добавить возможность онлайн заказа на веб-сайт. То есть, технические точки зрения, оно уже не статическое, а это динамический веб-сайт, на котором можно оставлять заказ. Также в рамках этого бизнес-кейса у нас будет возможность посмотреть, какие заказы были сделаны на отдельной странице, чтобы продемонстрировать динамичность этого веб-сайта. Отлично, на этом мы заканчиваем первую часть и переходим к следующей. Мы переходим ко второй части нашей сегодняшней лекции. Перед тем, как ее начнем, давайте вспомним, какие есть у нас основные сервисы, связанные с вычислениями. Их можно разделить на пять различных групп. Отличаются они тем, что в самом первом у нас высокий контроль над инфраструктурой. Мы можем как угодно кастомизировать ее части. И таким образом идет смещение до серверлесс, когда мы большую часть работ по обслуживанию IT-инфраструктурой передаем AWS. Таким образом делаем лишь ту меньшую часть. Давайте пройдемся по каждой из групп. Первая это Virtual Machines. То есть тот случай, когда мы получаем виртуальную машину, можно к ней подключаться по SSH, все необходимые настройки делать, любое приложение устанавливать. И в этом случае, если говорить про сервисы, это EC2, Elastic Compute Cloud, самый основной сервис. И также немного отличающийся, но также предоставляющий виртуальные сервера, это Amazon LightSail. Следующий уровень, то есть у нас уже чуть меньше контроля, но тем не менее есть, это контейнеры. Самым явным представителем является Amazon ECS, работает с Docker-контейнерами. Третья группа это так называемый PaaS, платформация сервис. И сервисом, который ее представляет, является Amazon Elastic Beanstalk. Идея в том, что вы пишете код вашего приложения, готовите некоторый документ, который описывает конфигурацию вашей инфраструктуры и загружаете в этот сервис. Далее уже происходит следующее. Elastic Beanstalk берет на себя все те моменты, связанные с поднятием этой инфраструктуры, поднимает все необходимые дополнительные ресурсы. И вам уже в удобном виде можно будет через UI, то есть через AWS Management Console управлять вашей инфраструктурой. Четвертая группа является Serverless, когда мы фактически передаем все, что связано с обслуживанием IT инфраструктуры AWS, нам лишь нужно писать код. Ярким представителем является AWS Lambda, вы пишите код, загружаете ее и AWS все, что связано с обслуживанием, берет на себя. И вы оплачиваете только за количество гигабайт секунд исполнения Lambda функции. В случае, когда у вас ваша Lambda функция не исполняется, вы ни за что не оплачиваете. Это и есть преимущество Serverless. Я здесь хотел отметить, обычно, если у вас постоянные нагрузки, которые равномерные, то рекомендуется отдавать предпочтение EC2 либо ближайшие к нему сервисы. Если же вы, например, небольшой стартап, либо у вас та часть вашей IT инфраструктуры, у которой нагрузки непостоянные, они приходят с различными всплесками, есть периоды, когда нагрузка совсем не приходит, в этом случае рекомендуется смотреть в сторону Serverless, так как в момент отсутствия нагрузки вы ничего не оплачиваете. Таким образом, Serverless решения в подобных нагрузках являются более экономичным решением. Еще одним представителем Serverless является AWS Fargate. Это тот сервис, который позволяет нам управлять нашими контейнерами. Это специальное отдельное Serverless решение, которое помогает с этим справляться. Также хотелось бы отметить два сервиса немного из другой категории, тоже связанных с вычислениями. Это AWS Outposts. Идея в том, что вы можете для вашей локальной вычислительной мощности привязать сервис AWS Outposts и управлять вашими мощностями, как будто бы это AWS мощности. И второй пример это AWS Batch, сервис, который позволяет нам выполнять некоторые задачи бачами, то есть некоторыми группами. На этой лекции мы подробно поговорим про сервис Elastic Compute Cloud EC2. Что же это такое? Это сервис, который предоставляет нам виртуальные машины, то есть сервера. У нас есть возможность, используя API для AWS Management Console, поднимать эти сервера в течение нескольких минут абсолютно в любом количестве. При необходимости мы можем автоматически настроить масштабирование как в сторону увеличения, так и в сторону уменьшения, в зависимости от нашей нагрузки на нашу IT инфраструктуру. И более того, вот это все, все то, что этот сервис облачный, он позволяет нам платить только за те вычислительные мощности, которые нам нужны. Приведу пример, если мы говорим, что нам нужны кратковременные вычислительные мощности для некоторых расчетов, и эти расчеты при запуске, например, 100 машин занимают 3 дня, мы можем действительно запросить 100 серверов любой конфигурации, которые имеются у AWS, и запустить их на 3 дня. После того, как мы завершим все наши расчеты, мы можем вернуть обратно эти сервера, и после окончания месяца нам придет счет на оплату именно на эти 3 дня, на то количество серверов, которые работали. Таким образом, мы платим только за то, что мы используем. Пару слов о том, из чего состоит EC2. Мы с вами знаем, у нас есть AWS регионы, далее в каждом AWS регионе несколько availability zone, и в рамках availability zone несколько data center. В data center у нас десятки тысяч серверов, и каждый сервер максимально мощный, насколько это возможно. Теперь благодаря использованию гипервизора, мы фактически один мощный физический сервер имеем возможность разделить на сотни мелких виртуальных серверов. Таким образом, в рамках сервиса Amazon EC2 есть возможность выбрать такую конфигурацию, какую мы хотим, из более чем 700 различных вариантов. Когда мы получаем виртуальный сервер, оно в себе содержит CPU, то есть самую вычислительную мощность, RAM, которая является оперативной памятью, и то, что хранит данные, это либо Instant Store, либо EBS. EBS это отдельный сервис, который предоставляет нам постоянное хранение. Когда мы говорим про Instant Store, это временное хранение. Особенности и отличия этих двух вариантов хранения мы поговорим чуть позже. Давайте пару слов скажем про use case и использование сервиса Amazon EC2. Обычно этот сервис выбирается, если нам нужен полный контроль над нашими вычислительными ресурсами. При работе с виртуальными серверами мы можем установить любое приложение, мы можем сконфигурировать его так, как мы хотим, и никто нас в этом не ограничивает. Мы можем установить любую операционную систему, и таким образом практически любую IT-инфраструктуру, любое приложение, которое хостится на локальном дата-центре, работающих на физических серверах, можно перенести на сервис Amazon EC2 в облако AWS. Также мы начинаем использовать сервис Amazon EC2 в случае, если мы хотим оптимизировать наши расходы на вычислительные мощности. У нас есть возможность купить Reset Instances, у нас есть возможность использовать Spot Instances, а также есть Savings Plans, которые дают значительные скидки за использование виртуальных серверов Amazon EC2. При настройке виртуального сервера EC2 нам необходимо принять несколько решений. Давайте пройдемся по самым основным шагам. Самое первое нужно определиться с AMI, либо это AMI, который мы сами приготовим, либо использовать AMI существующий, вот AWS. Далее мы определяемся какой тип инстанций нам будем использовать. В этом случае мы должны знать какое количество процессоров, какое количество оперативной памяти и хранения нам нужно. Далее мы можем дополнительно указать как мы хотим чтобы наши EC2 инстанции располагались в дата центре. Про это мы поговорим в следующих слайдах. Если наше приложение работает с другими сервисами, то также необходимо настроить роль, которая будет использовать наш инстанс и обращаться к другим сервисам. Необходимо также понять будем ли мы использовать UserData или нет. Часть команд по преднастройке нашего инстанца мы можем добавить в AMI, часть по некоторым причинам расположить в AMI не получится, поэтому необходимо настроить UserData, который будет исполнять некоторые команды в момент поднятия инстанца. Нужно решить также вопросы связанные с хранением. У нас есть два варианта, как мы помним есть возможность использовать InstantStore, это старая опция или использовать EBS, отдельный сервис который предоставляет нам Persistent Block Storage, то есть постоянное блочное хранение, что является рекомендацией и best practice MOTEWS. Далее необходимо рассмотреть вопросы связанные с безопасностью, это настройка Security Group, какой трафик разрешен, какой трафик запрещен. И самое последнее, это Key Pair, это ключ который позволяет нам подключаться удаленно через SSH к нашим виртуальным серверам. На этом мы подошли к концу, ко второй части нашей сегодняшней лекции, освежили в памяти, что же такое сервис Amazon EC2, какие возможности он нам предоставляет, также остановились на тех шагах, которые необходимо выполнить для успешной настройки и запуска нашего сервера. Первый и самый основной это выбор AMI, что такое AMI и какие возможности оно нам предоставляет, мы рассмотрим в третьей части нашей сегодняшней лекции. Давайте теперь подробнее остановимся, что же такое AMI, AMI расшифровывается как Amazon Machine Image, это некий template, шаблон, который позволяет нам на базе этого шаблона поднимать виртуальные сервера EC2. Как вы видите на картинке с использованием одного лишь AMI, мы можем поднять абсолютно идентичные EC2 инстанции. Что же такое AMI, оно описывает root volume, то есть корневой раздел жесткого диска, на котором устанавливается операционная система, а также возможно некоторое программное обеспечение. Далее здесь же описывается информация какие аккаунты могут использовать этот AMI. И третий пункт это описание дополнительных разделов жесткого диска для целей хранения. Какие же преимущества нам предоставляет AMI, это так называемые 3R, repeatability, reusability и recoverability. Идея в том, что мы создаем этот шаблон один раз и используем ее много раз. Более того, исключается человеческий фактор и какая-то часть конфигурации настроек, она сидит в этом шаблоне и возможность получить другую конфигурацию просто невозможна. Таким образом исключается человеческий фактор. Другой момент это то, что мы можем использовать самым примитивным образом AMI, это настроить некоторый сервер, установить все необходимое, убедиться, что все работает как нам нужно и от этого сервера создать AMI. Это будет кастомный шаблон, который вы можете использовать для восстановления. В случае, если что-то не так происходит, ваш сервер падает, то в этом случае вы оперативно используя ваш кастомный AMI можете поднять и вернуть в строй. Это естественно самое простое использование, есть более продвинутые практики использования AMI, о которых мы поговорим с вами в дальнейшем. Давайте теперь остановимся на основных моментах, которые позволяют выбрать правильный AMI. Существует пять различных пунктов. Первый и основной это регион. Мы с вами помним, что AMI создается в рамках определенного AWS региона и используется там же. В случае, если вы хотите использовать этот AMI в другом регионе, то вам необходимо ее скопировать. Это достаточно просто делается. В этом случае копия получает отдельный уникальный ID этого AMI и дальше используется уже независимо. Второй пункт это выбор операционной системы. Мы не ограничены абсолютно ничем, можем установить любую операционную систему. Наиболее частыми вариантами в этом случае являются либо Windows операционной системы, либо некоторые вариации Linux операционных систем. Далее необходимо определиться с IT ресурсом хранения. Это может быть EBS, то есть отдельный сервис, который помогает нам обеспечить постоянное блочное хранение. Либо это Instant Store. Instant Store это та память, которая физически находится возле нашей виртуальной машины. Она не рекомендуется, так как это старый вариант использования и как best practice рекомендуется использовать EBS ввиду его преимуществ. На этом мы более подробно остановимся на следующих слайдах. Четвертый пункт это выбор архитектуры. Мы можем выбрать либо 32-битную, либо 64-битную. Более того, можем выбрать ARM архитектуру. Также появилась собственная разработка 3WS Graviton. Есть определенные преимущества. Более подробно вы можете ознакомиться на официальной документации WS. Там проводятся различные сравнения для различных типов нагрузок, какие архитектуры работают лучше. Последний пункт это тип виртуализации. Здесь есть два варианта. Это PV, пара виртуал, и HVM, hardware virtual machine. В большинстве случаев рекомендуется использовать HVM. Если же мы говорим про источники, откуда мы можем получить AMI. Первый это QuickStart. Это готовые AMI, предоставленные от AWS. Второй это так называемые AMI. Это все те AMI, которые мы сами создаем для себя. Кастомные AMI. Далее есть AWS Marketplace. Это специальное место, в котором вы можете использовать AMI, созданный другими компаниями. При этом никаких гарантий AWS не предоставляет. Поэтому использование здесь на ваш страх и риск. В AWS Marketplace вы можете найти как бесплатные, так и платные AMI от популярных вендоров. Например Red Hat и другие. И четвертый это Community AMI. Это те AMI, которые были созданы пользователями AWS. Здесь также AWS не несет никакой ответственности. И вы используете эти AMI на свой страх и риск. Мы с вами добрались до сравнения двух типов хранения для Root Volume. Это Instant Store и Amazon EBS. Предоставлена таблица в пяти различных характеристиках. И давайте пройдемся по каждому из них. Запуск Инстенса с EBS намного быстрее, чем запуск с Instant Store. Это связано с тем, что Instant Store хранит некоторые части данных в S3. И загрузка данных с S3 занимает некоторое время. Если говорить про максимальный размер Root Volume, это для EBS 16 ТБ, а для Instant Store всего лишь 10 ГБ. Но для большинства задач 10 ГБ более чем достаточно. Если мы говорим про возможность останавливать Инстанции, мы это можем сделать для Инстанцев с EBS. И в момент, когда Инстанц остановлен, мы за это не несем никаких затрат. Если мы говорим про Instant Store, остановить такой Инстанц невозможно. Его можно лишь перезагрузить, либо терминейтнуть, то есть отключить. В момент, когда вы отключаете, все данные, которые хранились в Instant Store, они пропадают. Если мы говорим про возможность изменять тип Инстанца, в случае с EBS это очень легко делается. Вы можете в любой момент остановить Инстанц, изменить Инстанц Тайп. И в момент, когда вы ее включите обратно, Инстанц Тайп уже будет изменен. Если мы говорим про Instant Store, это сделать невозможно. Ввиду того, что это тот раздел жесткого диска, который находится физически рядом с виртуальным сервером. Поэтому при смене Инстанц Тайпа вас перекинет уже на другой физический сервер, у которого свой Инстанц Тайп. Таким образом, нет возможности изменить Инстанц Тайп. Если мы говорим про вопросы оплаты, в случае с EBS вы несете затраты по тарифам сервиса Amazon EBS. В случае, когда мы говорим про затраты Instant Store, это те затраты связанные с хранением данных в S3. Зачастую хранение данных в S3, она дешевле чем с EBS. Если мы говорим про гигабайты до 100 гигабайтов, то эти затраты, они минимальные, отличаются не сильно. Поэтому следует этот момент также учитывать. Если у вас очень большое количество серверов и вам достаточно преимуществ и недостатков Instant Store, то вы ее можете использовать и получать некоторую выгоду ввиду того, что данные хранятся в S3. И это дешевле. Во всех остальных случаях рекомендуется как best practice использовать EBS для вашего root volume. Давайте теперь поговорим немного про Instant Life Cycle, то есть жизненный цикл и сету инстанца. Все начинается из состояния pending, в момент когда мы запускаем первый раз наш инстанц из AMI, поднимается сервер и в момент когда она включается, она в состоянии pending. В состояние pending мы также можем попадать из состояния stopped. Это относится только к EBS back-up инстанции, которые мы можем останавливать. Так вот, когда мы остановили ее включаем, в первую очередь она переходит из состояния stopped в состояние pending. Далее, как только оно включится и будет готово к работе, из состояния pending она перейдет в состояние running. С этого момента вы можете по SSH подключаться к этому и сету инстанцу и работать с ней. Включенный инстанц вы можете перезагружать. Она переходит в состояние rebooting и возвращается обратно в состояние running. В случае когда мы делаем reboot, его публичный IP-адрес и физический сервер остаются теми же, в случае если не было проблем физически с этим сервером. Для EBS back-up инстанцев у нас есть возможность ее останавливать. Как только мы это делаем, из состояния running она переходит в состояние stopping. После того как она полностью остановится, она переходит в состояние stopped. Мы также можем отправить наш EBS back-up инстанцы на гибернацию. Гибернация это когда состояние текущее сохраняется в память операционную и таким образом она быстрее включается. В этом случае она также переходит через stop and pending и переходит в состояние running. Отличие от остановки и гибернации в том, что в случае с гибернацией мы сохраняем физический сервер. Он запускается на нем же, сохраняются его IP-адреса, приватные, публичные и вы продолжаете с этой машиной работать. В том случае если не было проблем физически с этим сервером. В случае когда мы ее останавливаем, то физический сервер который хостит нашу виртуальную машину может сменится. Последнее состояние это остановка. Если машина работает и мы ее terminate, она переходит в состояние shutting down. Отключается и в итоге переходит в состояние terminated. Какое-то время она в AWS Management Console будет отображаться как terminated и через некоторое время она совсем пропадет. В состояние terminated мы также можем переходить из состояния stop at. То есть если EBS Backed Instance был остановлен, то мы не переводя ее в состояние running можем ее terminate. Пару слов хотелось бы сказать про создание нового AMI. Представим что мы находимся в регионе A. Есть у нас некоторые AMI, будь то созданные нами, будь то AMI предоставленные AWS либо любой другой. Во время запуска инстанца мы получаем точную копию AMI уже в запустившемся инстанции. Будет у нас Unmodified Instance. Далее мы можем подключаться к этому инстанцу проводить некоторые манипуляции. Еще один подход к созданию AMI это сервис EC2 Image Builder. Используя этот сервис вы можете с легкостью в понятном UI интерфейсе автоматизировать создание, управление, обслуживание, развертывание, а также работа с контролем версии ваших AMI. На этом слайде вы видите Image pipeline сервиса EC2 Image Builder. Он состоит из 5 основных шагов. Самым первым делом вам нужно выбрать Source Image, то есть это операционная система на котором будет базироваться ваш AMI. Можете выбрать Amazon Linux 2, Windows операционную систему, Ubuntu и так далее. Вторым шагом предлагается определить список компонентов, то есть вы указываете какие приложения, какое ПО будет установлено. Один из примеров это установка языка программирования Python. Третьим шагом предлагается запустить так называемые Hardening Tests для проверки безопасности. Есть специальные тесты которые предоставляются от AWS. Также вы можете добавить и включить здесь свои собственные тесты. После того как AMI проходит проверку на безопасность, мы переходим к четвертому шагу. Четвертый шаг это расписание того как часто будет создаваться новый AMI. Может возникнуть вопрос для чего нам необходимо на периодической основе создавать AMI. Ответ достаточно прост. Мы с вами знаем что операционные системы, что программное обеспечение они развиваются не стоят на месте. И один из видов обновления это не сколько новый функционал, а обновление безопасности, то есть патчи безопасности. Так вот, вот это расписание оно позволяет вам создавать AMI ровно с таким же составом компонентов внутри, но при этом уже будут применены новые обновления тех или иных приложений. Последним шагом вам необходимо определить на какие регионы будут распространяться ваши AMI. Вы можете выбрать один основной или несколько регионов, если вы хостите свою инфраструктуру в нескольких регионах. На этом мы заканчиваем третью часть нашей сегодняшней лекции. Разобрали основные моменты связанные с AMI. Мы с вами добрались до четвертой части нашей сегодняшней лекции и поговорим о нюансах выбора типа инстанца AC2. Что такое тип инстанца? Это некоторая уникальная конфигурация, которая в себя включает характеристики CPU процессорных мощностей, далее Memory это операционная память, Storage это хранилище наши жесткие диски и Network Performance, то есть свойства железа по работе с сетью. Название типа инстанца состоит из нескольких частей. Вы это можете видеть на слайде. Самое первое это семейство типов инстанцев. Про них мы поговорим на следующих слайдах. В этом случае это семейство M, далее вторым обязательно идет номер поколения, в нашем случае M5. Это значит инстанц из семейства M пятого поколения. Каждый год Amazon увеличивает это число и предлагает нам еще более привлекательные условия. Обычно за ту же цену предлагается машина более мощная либо чем-то в лучшую сторону, отличающаяся от предыдущего поколения. Например, M6 будет точно такой же по цене и по характеристикам может быть где-то лучше. Третья часть это некоторые дополнительные возможности. В этом случае вы видите букву D. Она означает, что этот тип инстанца для жесткого диска использует тип SSD вместо хард драйва. После этих основных частей через точку у нас описывается размер инстанца. Есть определенная градация начиная от nano, micro и так далее. Здесь мы видим на примере Xlarge, что говорит о том, что это инстанц XtraLarge. Также можете видеть характеристики. У него 4 ядра процессора, оперативная память на 16 ГБ, один жесткий диск на 150 ГБ и Network Performance. Мы можем передавать данные по сети до 10 ГБ в секунду. Увеличение размера увеличивает соответственно одну или несколько характеристик, которые вы видите в левой части этого слайда. На следующих двух слайдах мы разберем 5 самых популярных семейств типов инстанцев. Для каждого семейства будут данные примеры использования, а также буквенные обозначения. Давайте пройдемся по каждому из них. Самый первый, самый популярный и подходящий для большинства случаев это General Purpose. Буквенное обозначение это MTEA. Далее идет Computer Optimized. Это те инстанции при всех прочих равных условиях будет большее количество ядер CPU. Буквенное обозначение это C, возможно CN, где N это дополнительно увеличиваются характеристики по работе с сетью. Далее у нас есть семейство Memory Optimized, увеличенные объем оперативной памяти RAM. Буквенное обозначение R, X и HMI. После этого есть у нас семейство Storage Optimized, то есть они ориентированы по работе с операциями водо-вывода по работе с жестким диском. Примерами буквенных обозначений могут быть I, D, H. И еще одно также набирающее популярность семейство это Accelerated Computing. Это используется для тренировки моделей нейронных сетей, машинного обучения, все те нагрузки, которые требовательны к ресурсам видеокарты. И в этом случае буквенное обозначение это P, G и F. При всех прочих равных характеристиках в типах инстанцев из Accelerated Computing будет дополнительно или увеличенное количество памяти для видеокарты. Для того чтобы принять решение какой тип инстанца подходит вам, что необходимо сделать. Основные два пункта. Первое это знать какие нагрузки будут на ваше приложение и второе знать бюджет. Чем мощнее инстанс очевидно это требует больших затрат денежных. Для того чтобы определиться с типом нового инстанца вы можете на основной странице сервиса EC2 перейти во вкладку instance types и там посмотреть какие виды есть. Там есть удобный фильтр, вы можете отфильтровать оставить нужное семейство, либо наоборот зафиксировать количество, некоторые характеристики, например количество процессорных ядер и посмотреть какие варианты у вас остаются. Рекомендуется использовать последнее поколение, так как оно самое оптимальное с точки зрения цены и качества. Если вы работаете уже существующим инстанцем и видите что есть необходимость обновить тип инстанца, рекомендуется посмотреть в сторону сервиса AWS Compute Optimizer. Она использует историю нагрузки на ваши EC2 инстанции и дает некоторые рекомендации по типу инстанцев, по их размерам, количеству и даже конфигурации авто скейлинг группы. По результатам анализа она может выдать вам вердикт именно по вашим инстанцам или они перегружены, недогружены, оптимизированы или с пометкой non, что говорит о том что информации по нагрузкам недостаточно для конкретного инстанца. На этом мы разобрали основные вопросы связанные с выбором типа инстанца EC2. Мы с вами переходим к следующей части. Мы с вами добрались до пятой части нашей сегодняшней лекции и поговорим про UserData. Что же такое UserData, для чего мы ее можем использовать? UserData это набор некоторых команд, которые отрабатывают во время инициации вашего инстанца. Если говорить про lifecycle инстанца, то все команды внутри UserData отрабатывают в шаге pending. Обратите внимание, что UserData запускается только при первом запуске, поэтому после того как вы остановите и еще раз запустите, либо перезагрузите ваш инстанц, UserData отрабатывать не будет. Зачем использовать UserData? Обычно там есть список команд, которые обновляют существующие по это по уже включено в AMI, но может там быть в не самой последней версии. Поэтому используя UserData в момент запуска вы подтягиваете самые последние изменения и дозагружаете обновление вашего пула. Далее также в UserData попадают те команды, которые требуют непосредственной привязки к вашему инстанцу. Например, некоторые команды могут использовать метаданные вашего инстанца, может быть публичные или внутренние API для дополнительной настройки. В этом случае мы не можем добавить ее в AMI и она будет находиться в UserData. Также в UserData запускаются команды для старта веб-сервера. В этом случае обратите внимание, что UserData запускается только один раз, поэтому помимо запуска веб-сервера в первый раз, вам также необходимо внести некоторые правки в автозагрузку, чтобы при каждом включении и выключении вашего инстанца стартовал веб-сервер либо любое другое программное обеспечение. Если же говорить в сравнении, куда передавать те или иные команды в AMI или UserData, так как они достаточно заменяемы, отвечу следующим образом. Всегда должен быть некоторый баланс. Все те команды, которые вы можете вложить в AMI, желательно положить туда. Это первая часть команд. Вторая часть команд по обновлению и все те нюансы, которые говорил ранее, следует добавить в UserData, так как большой объем команд в UserData замедлит старт вашего инстанца. Когда у вас будет баланс, часть команд будет на стороне AMI, часть команд на стороне UserData, то с одной стороны у вас будет актуальный AMI, с другой стороны инстанц будет запускаться намного быстрее, потому что UserData не такая большая. И в итоге вы получаете инстанц с обновленным программным обеспечением и полностью готовым к работе. Раз уж мы заговорили о информации про наш инстанц, так называемый инстанц metadata, давайте остановимся на том, где и как эту информацию можно получить. На уровне каждого инстанца есть некоторые URL. Это 169.254.169.254.LATEST.METADATA. По эту матрицу находится основная информация, связанная непосредственно к этому инстанцу. Этот URL доступен только на уровне конкретного инстанца. Также, если вместо metadata написать UserData, то вы получите список тех команд, которые есть в вашей UserData. Также можете ее использовать для дополнительной настройки. Когда я говорил про баланс команд на стороне AMI и UserData, естественно, нет универсального ответа. Всегда надо смотреть на конкретную бизнес-задачу. Давайте рассмотрим четыре различных варианта того, где могут находиться ваши команды в AMI и UserData, какие это преимущества дает и какие у каждого подхода есть недостатки. Если вы обратите внимание, что на самом верху есть стрелка flexibility, то есть каждый следующий вариант слева направо, он дает большую гибкость. Если посмотреть на стрелку внизу simplicity, она противоположная, и мы справа налево упрощаем работу с нашими Institute Инстанциями, но при этом теряем в гибкости. Давайте подробнее посмотрим на каждой из конфигураций. Самый первый это fully-baked AMI, в котором все абсолютно необходимые для запуска, начиная от операционной системы, ее дополнительные настройки, подготовки среды для приложения и установки самого приложения, она происходит на стороне AMI. В этом случае ваш Instance запускается максимально быстро и UserData может быть совсем пустой. Это связано с тем, что AMI вы готовите асинхронно, она уже предварительно приготовлена, в ней все готово и в момент необходимости запуска вы включаете только сервер и все остальное у вас готово. Плюсом может быть то, что вы очень быстро запускаете ваши сервера и они в самое максимально быстрое время готовы к работе. Недостатком может являться то, что любое приложение для корректной работы требует другое ПО и возможно не одно для ее работы. Каждая из этих ПО независимо друг от друга развивается, выходят патчи безопасности, обновление функционала и так далее. Поэтому с этим подходом рекомендуется чаще готовить или обновлять ваши AMI. Следующие два пункта увеличивают гибкость, но при этом немного усложняют работу с вашими SITU Instance в том плане, что есть отдельный набор команд на стороне AMI и отдельный набор команд на стороне UserData. В первом случае у вас приложение устанавливается только в момент запуска приложения. Это может быть необходимо так как внутри AMI не получится добавить те команды по настройке вашего приложения. Это тот случай когда вы используете некоторые данные о конкретном Instance. Все остальное находится внутри AMI. Более гибкий подход это когда вы настраиваете операционную систему, устанавливаете все необходимые для корректного функционирования этой операционной системы внутри AMI. А вторую часть, а именно подготовку среды для вашего приложения и непосредственно установку вашего приложения проделываете внутри UserData. В этом случае она запускаться будет еще дольше, но при этом вы получаете гибкость и любые команды могут быть изменены на стороне UserData. Новый AMI для этого выпускать не нужно. И самое последнее это GEOS, то есть расшифруется как Just Enough OS. Простыми словами это только операционная система. Все остальное у вас на стороне UserData. Даже настройка операционной системы, а именно патчи безопасности, настройка мониторинга и логирования и все что выше это подготовка среды для приложения и само приложение на стороне UserData. В этом случае вам достаточно выбрать любой подходящий для вас AMI который предоставляет AWS и все необходимые настройки производительной стороне UserData. В этом случае ничего связанное с AMI делать не нужно. Достаточно использовать уже готовые, но при этом нужно будет менеджировать UserData. И понимать что у вас максимальная гибкость вы можете менять очень часто ваши UserData не меняя AMI, но при этом понимаете что запуск вашего инстанца требует намного больше времени. И до того что она фактически полноценно будет настраиваться только в момент запуска. На этом мы разобрали все что связано с UserData в EC2 Инстанции. Заканчиваем пятую часть и двигаемся дальше. Мы с вами добрались до шестой части нашей сегодняшней лекции и затронем все аспекты связанные с хранением при работе сервисом Amazon EC2. Как мы знаем у нас есть два раздела это Root volume и Data volume. В Root volume мы устанавливаем нашу операционную систему все приложения, а в Data volume храним данные. Так вот когда мы говорим про Root volume, Root volume может быть Instant Store либо поддерживаться Amazon EBS. Если мы говорим про Data volume то они опциональные их может и не быть. Если мы говорим про данные которые доступны только для текущего инстанца, то мы можем использовать наш Instant Store хоть он и небольшой и ограничен. Также мы можем добавить дополнительные независимые от Root volume EBS жесткие диски. Если же мы говорим что нам нужно такое хранилище которое общедоступное среди всех EC2 инстанцев, то нам на помощь приходят еще два сервиса. Первый это Amazon EFS для Linux based серверов и второй это Amazon FSx for Windows Server Windows File Server. Это аналогичный сервис только для машин с операционной системой Windows. Давайте остановимся на каждом из вариантов более подробно. Самый первый это Instant Store. Instant Store это не постоянное блочное хранилище. На него можно установить операционную систему. У нее есть некоторые ограничения которые мы рассмотрели ранее, в том числе преимущества. Самый основной момент который связан с Instant Store это то что его невозможно остановить. Если же у вас есть лишние инстанции и вам необходимо их отключить, то при отключении все те данные которые хранятся в Instant Store они будут потеряны. Поэтому в Instant Store данные хранить можно, но это такие данные, либо кэш данные, либо данные которые можно с легкостью восстановить и не страшно потерять. В этом случае можно использовать Instant Store. Следующий это EBS. Это жесткие диски которые подключены через интернет. Они не относятся физически к нашему виртуальному серверу и есть у нее ряд преимуществ. Бест практикс это использовать EBS, так как преимуществ намного больше, но по оплате выходит немного дороже. Ввиду того что жесткие диски обычно устанавливаются не более 100 гигабайтов, то разница в цене она не ощутима и те преимущества которые вы получаете они намного больше. Основные преимущества которые вы получаете при работе с Amazon EBS это то что вы можете отсоединить ваш жесткий диск от инстанца и подключить к другому инстанцу. Вы дальше продолжите работать с этим жестким диском. Также это то что вы можете использовать различные типы жестких дисков это SSD или HDD. Другой момент это то что вы можете создавать снапшоты которые будут храниться в S3. Давайте рассмотрим какие типы волюмов сервиса Amazon EBS нам доступны. Есть 4 вида подразделяются на 2 группы это SSD Backed Volumes и HDD Backed Volumes. Если мы говорим про Root Volume это тот volume на который устанавливается операционная система то в ней она должна быть только типа SSD. Таким образом у нас только два варианта для Root Volume это General Purpose SSD, GP2 либо Provisional IOPS SSD. Для большинства случаев типа GP2 будет достаточно она достаточно быстро работает. В случае если вам помимо скорости также важна высокая пропускная способность то нужно смотреть в сторону Provisional IOPS SSD. Оно дороже но при этом вы получаете скорость и пропускную способность. Если мы говорим про вторую группу это HDD Backed Volumes они не подходят как для Root Volume но при этом вы можете использовать эти volume как Data Volume для хранения данных. Выделяют два вида. Первый это Throat Put Optimized HDD ST1, второй это Cold HDD SC1. Первый это стандартные HDD диски в случае если у вас нагрузки требующие высокую пропускную способность и при этом данные часто запрашиваются в этом случае ST1 это ваш выбор. В случае если вы хотите сэкономить на ваших жестких дисках при этом данные не часто запрашиваются то Cold HDD идеальный вариант. Есть еще один функционал который помогает нам увеличить IO Performance то есть Input Output операции связанные с жесткими дисками это Amazon EBS Optimized Instances. Это такой функционал который поддерживается не всеми EC2 инстанциями. И в случае если оно поддерживается то между вашим виртуальным сервером EC2 инстанция и отдельно стоящим EBS Volume настраивается выделенное сетевое подключение. Это увеличивает скорость передачи данных. Давайте теперь рассмотрим оставшиеся два сервиса которые нам помогают предоставить общий доступ для наших EC2 инстанций. В этом случае EBS нам не поможет так как в один момент времени EBS Volume может быть подключен только к одному инстанцию. Да можно подключить но для этого нужно отключить от предыдущего инстанция. Если мы говорим про S3 оно доступно для всех инстанций можно соответственно настройки произвести. произвести, но оно не идеальное, так как это не блочное, а объектное хранилище. В зависимости от типа нагрузок, оно может не подойти. В случае если вам нужен именно жесткий диск, блочное хранилище, которое доступно для всех ваших EC2-инстанцев, то рекомендуется использовать Amazon EFS для Linux операционных систем и Amazon FSx for Windows File Server. Это специально для EC2-машин с операционной системой Windows. Давайте отдельно рассмотрим каждый сервис. Amazon EFS, еще раз повторюсь, предназначен для Linux Based нагрузок. Она монтируется через NFS-протоколы к вашему EC2-инстанцу, может увеличиваться до 5 байтов размеров. Также оно автоматически масштабируется как в сторону увеличения, так в сторону уменьшения. Вы оплачиваете только за то, что используете. Например, полмесяца вы хранили 100 гигабайт данных, а оставшаяся часть времени вы хранили 10 гигабайт данных. Соответственно оплата будет ровно столько, сколько вы использовали. На этом слайде вы можете видеть примеры use-case EFS. Это как раз таки все те случаи, когда нужен общий доступ в одном месте для всех ваших EC2-инстанцев. Также вы видите пример команды для монтирования EFS в ваши EC2-машины. Аналогичный с Amazon EFS-сервис Amazon FSx for Windows File Server. Оно поддерживает работу с EC2-инстанциями с операционной системой Windows, поддерживает технологию NFS, нативно интегрирована с Microsoft Windows. Здесь также хотел бы отметить, что интегрируется с Microsoft Active Directory и поддерживает Windows Access Control Lists. Это значит, что вы в Amazon FSx можете хранить все данные ваших сотрудников. Они будут храниться в одном месте, доступны с любой EC2-машины, на котором стоит Windows операционная система. Более того, вы можете разграничить право доступа, так чтобы сотрудники не могли видеть персональные данные других сотрудников. На этом слайде вы видите также другие примеры. Идея в том, что у вас благодаря этому сервису будет отдельно стоящий общедоступный жесткий диск, на котором вы можете записывать и совместно использовать общие данные. На этом мы заканчиваем шестую секцию. Это последняя секция в рамках нашей сегодняшней лекции. Разобрали вопрос о хранении, связанный с сервисом Amazon EC2. На этом мы подошли к концу нашей сегодняшней лекции, рассмотрели ряд вопросов, связанных с EC2. Я хотел бы отметить, что это первая часть из двух, посвященных теме Compute. Сегодня мы с вами разобрали следующие темы, поговорили про AMI, зачем она нужна, какие преимущества дает. Далее рассмотрели подробнее, что такое Instance Type, какие семейства бывают, чем они отличаются, как выбрать оптимальный для себя Instance Type. Далее поговорили про User Data, для чего оно нужно, какие преимущества дает. И в конце рассмотрели все моменты, связанные с хранением в рамках использования сервиса Amazon EC2. На этом мы заканчиваем нашу сегодняшнюю лекцию. Спасибо за внимание, увидимся с вами на следующих наших активностях.
