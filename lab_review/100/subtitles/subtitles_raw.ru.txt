 Добрый день, уважаемые студенты! Я рад вас всех видеть на сессии разбора лабораторной работы. Тема сегодняшней лабораторной работы – это миграция базы данных в сервис баз данных Amazon RDS. Итак, давайте начнем. Начинаем мы разбор лабораторной работы с главной страницы AWS Management Console. Переходим к первому заданию. Здесь нам необходимо перейти в сервис Amazon RDS для того, чтобы создать instance базы данных. Как только мы оказываемся на главной странице сервиса Amazon RDS, нам необходимо нажать на кнопку Create database. Мы перейдем на специальную страницу для ввода вкладных данных. Здесь нам необходимо выбрать метод как Standard Create. Далее как движок необходимо выбрать MariaDB. Там где темплейты, необходимо выбрать опцию DevTest. DB instance identifier у нас будет cafe database. Чуть ниже необходимо ввести данные об пользователе баз данных. Пользователь будет называться admin. Пароль мы копируем и вставляем со страницы задания лабораторной работы. Как тип инстенса выбираем T3 micro. Здесь хотел бы отметить, в рамках задания указано, что необходимо выбрать T2 micro, но это семейство сейчас недоступно и оно считается устаревшим. Поэтому мы выбираем более свежее поколение, это T3 и тот же самый размер инстенса micro. Следующая секция это секция связанная с хранилищем. В нашем случае это General Purpose SSD GP2 и как размер необходимо будет указать 20 гигабайтов. Следующая секция availability and durability. Нам необходимо выбрать опцию Do not create a standby instance. То есть мы не будем включать опцию Multi-AZ deployment, так как в рамках лабораторной работы это не нужно. Там где connectivity необходимо указать как VPC, LabVPC. Как subnet group выбираем LabDB subnet group это private subnet group, там где будет располагаться инстанц-пазы данных. Как security группа мы выбираем созданную security группу dbsg и здесь необходимо будет убрать галочку с дефолтовой security группы. Как availability зону выбираем US East 1A. Где дополнительная конфигурация ничего менять не нужно мы подключаемся по TCP порту 3306. В секции monitoring необходимо будет убрать галочку enable enhanced monitoring, так как это не нужно в рамках лабораторной работы и когда мы убираем галочку сама база данных будет создаваться намного быстрее. Отлично, мы прокручиваем до конца страницы видим примерную стоимость в месяц инстанца базы данных. Здесь идет разбивка отдельно оплачивается instance и отдельно оплачивается 20 гигабайтов хранилища. В итоге это все выходит в месяц меньше 15 долларов. Ок, мы все ввели, нам необходимо сейчас нажать на кнопку create database. Нас направляет на страницу со списком баз данных. Сейчас вы видите единственная база данных которую мы сейчас создали status creating. Нам нет необходимости ждать когда она полностью создастся и будет активна. Мы можем переходить к следующему заданию. В рамках следующего задания нам необходимо перейти на сервис амазон и ситу. Нам необходимо воспользоваться строковой поиска сервисов, начать вводить и ситу. Первая ссылка это та которая нам нужна. Далее уже на странице сервиса амазон и ситу воспользуемся левым навигационным меню и выберем опцию instances. Нас направит на страницу со списком инстанцев. Там будет единственный instance с названием кафе сервер. Это тот и ситу сервер на котором установлено приложение веб сервер и находится база данных, которые мы будем переносить на отдельный сервис. Здесь нам необходимо скопировать публичный IP адрес и в новой вкладке в веб браузере ввести этот IP адрес слеш кафе чтобы перейти на веб приложение. Откроется следующая страница. Нам необходимо проверить работоспособность приложения, поэтому необходимо перейти на вкладку меню. Здесь необходимо выбрать для любой позиции количество больше нуля и в самом низу нажать на кнопку submit order. В нашем случае мы заказали 3 пончика по цене 1 доллар и всего вышло 3 доллара. Все верно. Давайте теперь откроем страницу со истории заказов и мы должны увидеть наш заказ под номером 25. Он здесь также отображается. Это говорит о том, что приложение сейчас корректно работает. Мы переходим к следующему заданию и здесь нам необходимо подключиться к нашему EC2 инстанцу. Для этого воспользуемся сервисом Session Manager. Оно находится в сервисе Systems Manager. Мы можем в строке поиска сервисов начать вводить Systems Manager и дальше воспользоваться навигационным меню слева, либо начать вводить имя необходимого нам сервиса, это Sessions Manager, и он у нас отобразится в секции features. Давайте сделаем следующим образом и перейдем по ссылке Session Manager. Здесь, когда мы перейдем на главную страницу сервиса Session Manager, необходимо нажать на кнопку Start Session. Мы увидим Target Instance на текущий момент. Это один-единственный вариант кафе Server. Необходимо его выбрать и нажать на кнопку Start Session. Как только вы это нажимаете, открывается новая вкладка в веб-браузере и вы видите окно терминала. Здесь необходимо первой командой ввести bash для того, чтобы открылся bash shell. Далее необходимо вбить команду sudo su, чтобы начать вводить команды в роли root пользователя. Далее нам необходимо от root пользователя уже перейти к пользователю EC2 User. Для этого вводим команду su EC2 User и необходимо сделать проверку. Если мы введем команду whoami, в ответе увидим пользователя, под которым мы сейчас сидим. Если отображается EC2 User, значит все верно. Двигаемся дальше. Сейчас нам необходимо перейти на домашнюю папку пользователя EC2 User. Для этого необходимо ввести команду cd, то есть Change Directory, путь home EC2 User. Если вы ведете pwd, то здесь отобразится текущая директория и вы увидите, что вы находитесь по верному пути. Теперь нам необходимо проверить состояние баз данных, установленной на EC2 машине. Для этого необходимо ввести команду service maria-db status. Вы увидите большое сообщение и в этом сообщении увидите зеленым active running, что говорит о том, что база данных сейчас активна. Если вы введете также команду mysql--version, вы увидите, что моя директория DB использует директор mysql. Теперь нам необходимо подключиться к базе данных. Для этого нужно добраться до пароля пользователя баз данных. Эти данные у нас хранятся в параметр store. Давайте в строке поиска сервисов в AWS Management Console введем параметр store, в секции features увидим необходимую нам ссылку и перейдем по нему. Вы увидите 7 созданных параметров, каждый отвечает за что-то определенное. Нас интересует кафе DB password. Давайте откроем этот параметр и в значении value вы увидите пароль от root пользователя баз данных. Давайте ее скопируем и вернемся обратно к сессии подключения к EC2 инстанцу. Здесь нам необходимо ввести команду подключения к базе данных это mysql-u root-p. Как только вы нажмете enter у вас запросит пароль. Вам необходимо будет вставить скопированный пароль. Если вы все сделали верно откроется промт баз данных MariaDB и здесь вы уже можете вводить команды. Давайте введем следующие команды. Первым делом show databases вы увидите список баз данных в этой базе данных и также внутри находится интересующая нас база данных кафе DB. Далее нам необходимо ввести команду use-cafedeb для того чтобы мы могли работать с таблицами в этой базе данных. Как только мы выбрали нужную нам базу данных мы можем ввести команду show tables и увидим все таблицы которые есть в этой базе данных. У нас 4 таблицы. Давайте теперь введем команду select all from order. Вы увидите все заказы сделанные через это приложение. Всего 25 заказов и самый последний это тот заказ который мы сделали вместе с вами. Также мы можем ввести запрос select all from order item и вы увидите для каждого заказа какие товары в каком количестве и на какую сумму были выбраны. Отлично у нас база данных работает. Все данные на месте. Теперь мы можем ввести команду mysqldump для того чтобы создать дамп базы данных. Все данные они перенесутся в файл cafedebdump.sql. Как только вы нажмете на enter вас также запросят ввести пароль и в случае если вы не увидите ошибки это говорит о том что дамп базы данных был успешно создан. Давайте теперь проверим что файл действительно появился. Введем команду ls и вы увидите что файл cafedebdump.sql появился. Если мы посмотрим его содержание то вы увидите вначале запускаются команды создания таблиц соответствующей структуры и после уже увидите запросы insert где вводятся данные. Отлично мы переходим к следующему заданию. Здесь нам необходимо будет убедиться в том что база данных успешно создалась. Для этого переходим к сервису amazon rds. Необходимо убедиться что статус available если это так мы переходим на страницу с лабораторной работы и здесь необходимо добраться до страницы с вопросами. Для этого нажимаем на кнопку details в выпадающем списке нажимаем на кнопку show и в всплывающем окне необходимо будет нажать на ссылку access the multiple choice questions. На странице с вопросами вы всего увидите четыре вопроса на все из них нам необходимо сейчас ответить. Первый вопрос у нас спрашивает где запущен instance базы данных amazon rds. Следует обратить внимание что необходимо выбрать опции которые являются верны и most specific то есть максимально детализированы. То есть вариант например что instance базы данных находится в AWS он верный но недостаточно детализирован. Ок давайте посмотрим какие варианты ответов есть. Первый вариант утверждает что он находится на уровне региона. Другой вариант что он на уровне availability зоны чуть точнее но нужно проверить так ли это. Третий вариант говорит о том что находится на edge location и последний вариант все варианты верны. Давайте теперь вернемся на страницу со списком баз данных и посмотрим на столбец region and az мы видим что наша база данных относится к availability зоне us east 1a. Это говорит о том что правильным ответом является второй так как он верный и максимально детализирован. Давайте теперь посмотрим на второй вопрос. Здесь у нас спрашивают есть ли у instance баз данных привязанный публично ip адрес. Давайте вернемся на страницу с деталями баз данных и посмотрим какая же информация здесь есть. Мы видим что у нас есть endpoint и определенный порт. Endpoint не является публичным ip адресом и наличие endpoint не говорит о том что извне из интернета можно к этой базе данных обратиться. Поэтому мы отвечаем на этот вопрос no. Третий вопрос звучит следующим образом. Укажите значение name тага для сабнета на котором расположен RDS instance. Следует обратить внимание что указано на странице с деталями базы данных а также посмотреть отдельно какие сабнеты есть у vpc. Как варианты ответов мы видим есть паблик сабнет private subnet 1 и private subnet 2. Это все имеющиеся сабнеты в нашем vpc. Давайте откроем страницу с деталями нашей базы данных. Мы видим что она находится в availability zone us-east1a. Также видим что сабнеты указан в список из двух сабнетов. Давайте попробуем эти сабнеты найти в списке сабнетов. Для этого необходимо открыть сервис vpc. В левом навигационном меню перейти на ссылку subnets и найти интересующие нас сабнеты. Мы видим что name тага заполнен как private subnet 1 и private subnet 2. Как нам понять в каком из сабнетов находится наш instance базы данных? Ответ прост. Необходимо проверить в какой availability zone находится каждый из сабнетов. Для этого необходимо прокрутить правее эту таблицу и мы увидим что private subnet 1 находится в availability zone us-east1a и private subnet 2 находится в availability zone us-east1b. Таким образом правильным ответом является второй private subnet 1. Давайте посмотрим на четвертый вопрос. Здесь у нас спрашивает какое количество security групп рулов привязано к нашему RDS instance. Для этого обратно мы переходим на страницу с деталями нашего RDS instance и необходимо прокрутить чуть ниже. Есть отдельная секция с security групп рулами. Мы видим что у нас есть один единственный рул. Он разрешает outbound трафик на весь интернет. Отлично. Таким образом мы отвечаем на этот вопрос. Первый вариант ответа значение 1. Мы переходим к следующему заданию и здесь нам необходимо подключиться от EC2 instance к RDS instance. Первым делом нам необходимо скопировать endpoint нашего RDS instance и вернуться к странице с терминалом. Здесь необходимо ввести соответствующую команду. Обратите внимание что пользователем является админ и пароль тот который мы указывали в самом начале при создании RDS instance. Как только нажмете enter попросят ввести пароль. Вы вставите скопированный пароль и посмотрите что случится. Команда долго будет стоять таким образом. Через некоторое время выйдет ошибка таймаута. Это говорит о том что есть некоторые проблемы и нам дается подсказка что проблема не в пользователе и проблема не в пароле. Необходимо подумать где же может быть проблема. Первым то что приходит на ум это действительно ли есть доступ по сети от EC2 instance к RDS instance с учетом того что они находятся в одном VPC но в разных сабнетах. EC2 instance находится в паблик сабнете, а RDS instance находится в private сабнете. Таким образом давайте проверим у instance RDS security группу. Вы можете найти ссылку на security группу во вкладке connectivity and security и соответствующее поле VPC security groups. Как только мы на нее перейдем во вкладке inbound rules мы увидим что не задано ни одного правила которое разрешало бы входящий трафик. Давайте это исправим и нажмем на кнопку edit inbound rules. Здесь необходимо нажать на кнопку add rule и в поле type ввести mysql aurora протокол и порт она ставится автоматически. Как source указываем custom. Мы не можем указать весь интернет так как это небезопасно с точки зрения безопасности, некорректно. Поэтому мы можем предоставить доступ к security группе, а эта security группа привязана к EC2 instance. Таким образом нам необходимо вернуться к нашему EC2 instance, выбрать его и во вкладке security мы увидим security группу к которой она привязана. Полностью ID запоминать не нужно, достаточно запомнить последние два символа это C5. Возвращаемся обратно на страницу редактирования security группы базы данных и как только мы выбираем source активируется следующее поле, начнем вводить SG и отобразится список security групп доступных на этом AWS аккаунте. Нам нужно выбрать ту которая заканчивается на C5. В вашем случае будет другой ID, но идею вы поняли. Также является best practice и рекомендация от меня лично всегда дополнять опциональное поле description так как вы создаёте эти записи один раз правило и когда вы возвращаетесь через некоторое время практически нереально вспомнить для чего вы это делали. А когда есть небольшой комментарий вы можете очень легко вспомнить вы её писали или нет более того по содержанию этого текста понять для чего она была создана. Давайте введем EC2 SG, после этого нажмем на кнопку save rules. Отлично давайте теперь вернёмся обратно к окну терминала и попробуем ввести следующую команду nmap-pn и endpoint нашего RDS инстанца. Отработает проверка портов и мы увидим в большом сообщении в самом конце что порт 3306 TCP по протоколу TCP открыт. Это говорит о том что мы по сети предоставили необходимые права теперь попробуем подключиться к нашему инстанцу RDS используя предыдущую команду. Если мы все сделали правильно мы сможем подключиться. Давайте теперь посмотрим какие базы данных есть в этом инстанции RDS. Для этого необходимо ввести команду show databases. Вы видите здесь 5 баз данных и здесь нет базы данных cafeDB. Все верно так и должно быть так как эта база данных она пустая сейчас там ничего нет. Давайте теперь выйдем с этого промпта и с bash shell введем команду для импорта дампы базы данных. Как только мы это сделаем попросят ввести пароль мы ее введем и если мы не увидим ошибки это говорит о том что дамп был успешно импортирован в наш RDS инстанс. Давайте теперь обратно попробуем подключиться к нашему инстанцу и введем команду show databases. Мы видим что база данных нашего приложения cafeDB появилась давайте теперь ее выберем и посмотрим какие таблицы там есть. Мы видим все необходимые таблицы там есть. Также посмотрим содержание таблицы order мы видим что у нас есть 25 записей и последняя запись это тот заказ который мы с вами вместе сделали. Отлично. Теперь мы двигаемся к следующему заданию. В этом задании нам необходимо произвести изменения в наших параметрах так как приложение работает используя эти параметры. Здесь у нас есть параметры связанные с базой данных это dbpassword и dburl. Давайте их обновим на соответствующие значения. Первым делом сделаем изменения в параметре dbpassword необходимо ее открыть. Верху справа нажать на кнопку edit и ввести новое значение. После чего внизу страницы необходимо нажать на кнопку save changes. Как только мы это сделаем те же самые действия необходимо произвести с параметром dburl и здесь необходимо ввести endpoint инстанца rds. Сохраняем изменения возвращаемся к терминалу с подключением к инстанцу и здесь для чистоты эксперимента остановим локальную базу данных. Для этого введем следующую команду и увидим соответствующий ответ. Теперь попробуем открыть приложение. Ссылка остается той же так как мы веб приложение и веб сервер не меняли. Попробуем открыть вкладку меню и увидим ошибку. Давайте подумаем где же мы не произвели не произвели необходимые изменения. Вы можете сейчас остановить видео и попробовать ответить. Отлично, я надеюсь вы смогли правильно ответить. Правильным ответом является то что у нас есть еще один параметр связанный с базами данных это dbuser. Если вы помните в локальной базе данных мастер пользователем является root, а для инстанца rds мы создавали мастера пользователя под названием admin. Поэтому нам необходимо ввести сейчас соответствующие изменения. После того как мы это сделаем возвращаемся обратно на страницу с меню и попробуем обновить страницу. Мы увидим список товаров и сейчас нам необходимо проверить работу веб приложения. Выберем горячий шоколад в одном количестве и попробуем оставить заявку. Нас направят на страницу с нашим заказом это заказ номер 26. Все необходимые данные корректно отобразились. Давайте теперь попробуем открыть страницу с историей заказов. Мы увидим что и 25 и 26 заказ который мы с вами вместе сделали они корректно отображаются. Отлично на этом мы завершили все задания в рамках лабораторной работы. Если вы добрались до этого места я вас поздравляю. Сейчас мы запустим автоматическое оценивание. Для этого необходимо вернуться обратно на страницу лабораторной работы и нажать на кнопку submit. Здесь нам необходимо подтвердить что мы хотим запустить автоматическое оценивание и через некоторое время это может занять до двух минут. Отработают все скрипты и с правой стороны вы увидите свою оценку. Если вы набрали максимальное количество баллов я вас поздравляю вы молодцы все сделали корректно. Если же где-то не достает баллы посмотрите в каком задании у вас не хватает баллы необходимо вернуться к этому заданию и попробовать сделать ее еще раз. Отлично на этом мы завершаем лабораторную работу. Очень важно корректно выйти со всех систем. В первую очередь это относится к AWS Management консоли. Необходимо в верхней правой части нажать на имя пользователя и далее нажать на кнопку sign out. Если мы говорим про страницу с лабораторной работы нам необходимо завершить корректно лабораторную работу. Для этого нажимаем на кнопку end lab подтверждаем что мы завершаем лабораторную работу и необходимо дождаться сообщения о том что мы можем закрывать страницу AWS Academy. Отлично я вас поздравляю мы с вами завершили разбор лабораторной работы. Я очень надеюсь что вы получили более полное представление о сервисах AWS. Спасибо за внимание. Увидимся с вами на следующих наших активностях.
