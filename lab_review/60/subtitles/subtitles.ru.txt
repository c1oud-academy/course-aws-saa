Добрый день, уважаемые студенты! Рад вас видеть на очередной сессии разбора лабораторной работы. Тема лабораторной работы – знакомство с сервисом Amazon Elastic File System или вкратце Amazon EFS. Давайте начнем. Начинаем лабораторную работу с основной страницы лабораторной работы AWS Academy. Для этого необходимо нажать на кнопку Start Lab. В всплывающем окне вы увидите состояние лабораторной работы и в начале он будет в состоянии In Creation. Как только она перейдет в состояние Ready, вы можете закрывать это всплывающее окно и переходить в AWS Management Console. Для этого необходимо там же возле кнопки Start Lab нажать на кнопку AWS. Как только мы перешли на главную страницу AWS Management Console, мы можем начать выполнение наших заданий. Первое задание - необходимо создать Security group. Для этого необходимо в строке поиска сервисов начать вводить EC2. В строке выдачи выбрать нужный нам сервис и на главной странице сервиса EC2 в левом навигационном меню нажать на вкладку Security Groups. Как только вы на нее нажмете, вы увидите список существующих Security Group в этом AWS аккаунте. Давайте выберем Security Group с названием EFS Client. Скопируем Security Group ID, она понадобится и нажмем на кнопку Create Security Group. Как только мы ее нажмем, мы перейдем на страницу создания Security Group. Здесь необходимо вести некоторые данные. Первым делом необходимо указать Security Group Name. Давайте сюда напишем EFS Mount Target согласно заданию. Как Description напишем Inbound NFC access from EFS Clients. И как VPC выберем Lab VPC. Ниже в секции Inbound Rules необходимо будет нажать на кнопку Add Rule. Появится строчка, здесь необходимо будет как Type выбрать NFC. Автоматически вставится протокол TCP, Port Range 2049, то что нам нужно. И как Source выбрать Custom. Как только вы это сделаете, активируется следующее поле. И там необходимо будет вставить Security Group ID. Либо прокрутить в выпадающем списке и найти нужную нам Security Group с именем EFS Client. Далее, необходимо прокрутить до конца страницы и нажать на кнопку Create Security Group. Мы готовы к созданию EFS файловой системы. Необходимо перейти на этот сервис. Давайте начнем вводить EFS в строку поиска сервисов и перейдем на этот сервис. Мы окажемся на основной странице сервиса Amazon EFS. Так как в этом AWS аккаунте не имеется созданных файловых систем, вы увидите страницу с видеоматериалом, с небольшой информацией об этом сервисе. Также будет кнопка Create File System. Давайте на нее нажмем. Увидите следующую страницу. Здесь нам необходимо будет нажать на кнопку Customize, чтобы открыть расширенные настройки создания файловой системы. Она состоит из четырех шагов. В первом шаге нам необходимо будет для поля Enable Automatic Backups галочку убрать. Для Lifecycle Management нужно будет выбрать опцию None и прокрутить вниз страницы. Здесь как ключ тега Name необходимо будет указать значение My First EFS File System и нажать на кнопку Next. Мы окажемся на второй странице. Здесь необходимо будет как VPC выбрать Lab VPC. Вы увидите, что создается Mount Target для каждой Availability zone. Так как в Lab VPC у нас две Availability zone, мы увидим us-east-1a и us-east-1b. Также вы увидите, что привязаны дефолтные Security Group. Они нам не нужны, поэтому необходимо будет нажать на кнопку X для каждой из Security Group. И после чего для каждой Availability zone выбрать Security Group, созданную нами ранее. Она называется EFS Mount Target. Как только вы ее выбрали, необходимо нажать на кнопку Next. На третьей странице ничего менять не будем. Оставляем по умолчанию. Нажимаем на кнопку Next. На четвертой странице мы видим все введенные нами входные данные. Необходимо будет прокрутить в самый низ страницы и нажать на кнопку Create. Как только вы это сделали, начнется процесс создания EFS файловой системы. Процесс занимает некоторое время. В среднем это 2-3 минуты. Поэтому нам необходимо будет периодически обновлять страницу, используя соответствующую кнопку, либо обновлять всю страницу, используя кнопку F5, кому как удобнее. Как только EFS создастся, вы увидите соответствующее сообщение в зеленом уведомлении. А также увидите, что статус EFS файловой системы сменился на Available. Мы с вами переходим к следующему заданию. Теперь нам нужно подключиться к EC2 инстансу через SSH. Для этого на основной странице лабораторной работы необходимо будет нажать на кнопку Details. В всплывающем списке нажать на кнопку Show. Отобразится отдельное всплывающее окно. Здесь необходимо скачать PPK Private Key, если вы работаете с Windows операционной системой. Если же вы используете MacOS либо Linux операционную систему, в вашем случае нужно будет скачать PEM Private Key, который находится рядом. Как только мы скачали, нам необходимо будет открыть программу PuTTY. Если ее у вас нет, вам нужно будет ее скачать по ссылке в лабораторной работе. Вы можете найти через поисковик и скачать эту программу. Устанавливать ее не нужно. Как только вы ее запускаете, она сразу доступна к работе. Здесь необходимо в левом навигационном меню добраться до вкладки Credentials. Она находится в основной вкладке Connection, далее SSH, дальше Auth. После этого вы увидите вкладку в самом нижнем уровне Credentials. Давайте на нее нажмем. Вы увидите три поля. Первое поле - это то поле, которое нас интересует, Private Key file for authentication. Необходимо нажать на Browse... и указать путь до этого файла. И нажать на вкладку Session в левом навигационном меню. Как только вы окажете здесь, рекомендуется сохранить это подключение, чтобы постоянно не указывать путь до Private Key. Для этого в поле Saved Sessions необходимо будет задать название нового подключения. Я написал aws-academy и нажал на кнопку Save. Далее, нам необходимо будет найти Public IP address нашего инстанса. Вы также ее видели в окне, где вы скачивали Private Key, IP EC2 инстанса. Если она там не отображается, вы можете ее найти в AWS Management Console. Для этого необходимо перейти в сервис EC2, в левом навигационном меню нажать на вкладку Instances. И вы увидите один единственный инстанс, называется EFS Client. Давайте его выберем и в метаданных этого инстанса вы увидите Public IP address. Необходимо будет его сохранить и дальше уже ввести в PuTTY. Здесь также вы видите, что при открытии программы PuTTY отображается список существующих сессий. И в этом случае необходимо будет выбрать aws-academy и нажать на кнопку Load. После этого загрузятся все настройки, в том числе и путь до Private Key. Как только вы нажали на кнопку Load, вам необходимо будет заполнить поле с IP-адресом сервера и далее нажать на кнопку Open. Как только вы ее нажмете, если это первое подключение, то выйдет соответствующее уведомление о том, что это подключение может быть небезопасным. В нашем случае мы знаем, куда мы подключаемся, поэтому нажимаем на кнопку Accept. Нас пропускают дальше и у вас запросит имя пользователя, под которым вы подключаетесь. Для Linux операционных систем внутри EC2 стандартным пользователем является ec2-user. Давайте ее введем, нажмем Enter. Как только вы это сделаете, увидите Welcome сообщение и Prompt, где вы уже можете вводить ваши команды. Давайте начнем вводить команды из следующего задания. Нам необходимо создать папку EFS, для этого введем sudo mkdir efs. Папка создается. Далее нам необходимо будет вернуться в AWS Management Console, перейти на сервис EFS. Как это сделать вы знаете. Как только вы перейдете на основную страницу сервиса Amazon EFS, вы увидите одну файловую систему, необходимо ее выбрать и открыть детали файловой системы. Откроется соответственно страница этой файловой системы, все метаданные, которые нам могут понадобиться, текущее состояние, а также вверху справа вы увидите кнопку Attach. Давайте на нее нажмем, вы увидите всплывающее окно с различными вариантами команд для монтирования этой файловой системы в EC2 Instance. Оно персонально уже заполнено для вашего EFS, вам достаточно скопировать ее. В нашем случае мы используем команду для NFS Client и необходимо ее ввести в нашей SSH сессии. Как только вы это сделаете, можно будет проверить, действительно ли подключение к файловой системе прошло успешно путем ввода команды sudo df. Как только вы это сделаете, отобразится список всех файловых систем, вы увидите, что есть строчка, которая содержит efs.us-east-1.amazonaws.com. Также вы видите, что он примонтирован к нашей папке, он находится по пути /home/ec2-user/efs наш пользователь и папка EFS. Отлично. Давайте теперь введем несколько команд для того, чтобы проверить работоспособность EFS. Воспользуемся инструментом fio, про который мы говорили в обзоре лабораторной работы. Как только мы ее введем, начнется процесс, займет некоторое время, порядка 10 минут, для того, чтобы создать файл размером 10 гигабайтов в нашем EFS. Как только отработает команда, вы увидите детали запуска этого теста, нас интересует строчка, которая начинается на WRITE, мы видим, что io=10240MB, то есть мы создали файл размером 10 гигабайтов. Далее мы видим agrb, это среднее количество байтов, которые мы записывали в секунду, в нашем случае это 103 мегабайта в секунду. Примерно те же значения мы видим для minb и maxb, это минимальная и максимальная скорость записи, которая была во время наших тестов. Отлично. Давайте теперь воспользуемся сервисом CloudWatch для того, чтобы проверить, действительно ли мы с такой скоростью передавали, что мы можем увидеть из AWS Management Console. Для этого в строке поиска сервисов начнем вводить CloudWatch, можете также вводить любую последовательность букв в рамках этого названия. Я обычно для сервисов состоящих из двух слов начинаю вводить со второго слова, в этом случае большая вероятность того, что не придется вводить целиком все слово. Поэтому если написать wat, вы увидите нужную ссылку. Давайте на нее перейдем. Как только вы окажетесь на основной странице CloudWatch, в левом навигационном меню нужно будет выбрать Metrics и дальше выбрать вкладку All metrics. На соответствующую странице необходимо будет выбрать метрики, связанные с EFS, далее выбрать File system metrics и вы увидите 8 различных метрик, связанных с нашей файловой системой. Давайте выберем метрику PermittedThroughput, это какое количество мегабайтов, с какой скоростью мы записывали на наш EFS. Как только вы ее выберете отобразится график, если он не отобразился, подождите 2-3 минуты, после этого обновите страницу. Вы можете также мышкой выделить определенный период времени на графике и он ее приблизит. Как только мы это сделаем, мы видим, что график ровный, скорость не менялась, если навести на любую точку, мы видим 104800, это значит примерно 105 мегабайтов была скорость записи. Если мы перейдем обратно на список метрик и выберем уже другую метрику, в нашем случае DataWriteIOBytes, и уберем галочку с предыдущей, то отобразится другой график. Здесь необходимо перейти на вкладку Graphed Metrics, для столбца Statistic выбрать Sum, Period выбрать 1 minute, в верхней части страницы выбрать один час, мы увидим метрики за последний час. Вы видите некоторый график, давайте попробуем выбрать пиковое значение, у меня два пиковых значения, они совпадают, выбираю любую и вижу следующее значение, это 6300000. Что это значит? Это значит, что в пиковое время мы записали такое количество килобайтов или 6300000 байтов за одну минуту. Для этого как раз таки мы как Statistic выбирали Sum и как Period - 1 minute, то есть все те метрики, которые пришли связанные с количеством input output операции в байтах, они агрегируются до одной минуты и все эти значения они суммируются. Теперь что нам необходимо сделать? Мы это значение можем поделить на 60 для того, чтобы посмотреть какая скорость была в секунду. Вы получите значение те же 105 мегабайтов, которые показали наши тесты в SSH сессии. Отлично, я вас поздравляю, мы завершили все задания в рамках лабораторной работы, теперь попробуем запустить процесс оценивания. Необходимо нажать на кнопку Submit, выйдет сообщение, действительно ли мы хотим запустить этот процесс, нажимаем Yes и когда отработают все тесты, мы увидим наши результаты. В моем случае, я набрал 15 баллов из 15, все задания были выполнены корректно, мы видим три задания, которые оценивались. Я напоминаю, что если вы набрали не максимальный балл, вы можете посмотреть в каком задании была ошибка, выполнить еще раз и запустить процесс оценивания еще раз. Штрафных баллов не выдается, в случае успешного выполнения вы увидите обновленную оценку. Останавливать лабораторную работу в этом случае нет необходимости. Отлично, на этом мы завершаем, нам необходимо выйти правильно со всех систем, начнем с AWS Management Console, в верхней правой части нажмем на название пользователя, дальше в выпадающем списке нажмем на кнопку Sign out и выйдем с AWS Management Console. Дальше возвращаемся на страницу лабораторной работы, здесь необходимо также успешно завершить эту лабораторную работу, поэтому необходимо нажать на кнопку End lab. Мы подтверждаем, что мы хотим завершить лабораторную работу и как только вы увидите сообщение о том, что мы можем закрывать эту страницу, что процесс удаления ресурсов инициирован, вы можете закрыть эту страницу и закрыть всю страницу с лабораторной работы. На этом я очень надеюсь, что вы получили более полное представление о сервисе EFS. Если будут вопросы, задавайте. Спасибо за внимание, увидимся с вами на следующих наших активностях!