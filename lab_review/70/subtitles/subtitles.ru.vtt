WEBVTT

00:00:00.000 --> 00:00:07.000
Добрый день, уважаемые студенты! Рад вас видеть
на очередной сессии разбора лабораторной работы.

00:00:07.000 --> 00:00:13.000
Тема лабораторной работы - создание динамического
 веб-сайта для нашего бизнес-кейса кафе.

00:00:13.000 --> 00:00:21.000
Итак, давайте начнем. Мы начинаем 
с основной страницы лабораторной работы.

00:00:21.000 --> 00:00:24.000
Необходимо убедиться,
что название совпадает.

00:00:24.000 --> 00:00:31.000
Должно быть Module 4 - Challenge Lab:
Creating a Dynamic Website for the Cafe. Отлично.

00:00:31.000 --> 00:00:37.000
Сейчас для начала лабораторной работы нам необходимо
инициировать создание временного AWS аккаунта.

00:00:37.000 --> 00:00:40.000
Для этого необходимо
нажать на кнопку Start Lab.

00:00:40.000 --> 00:00:48.000
Далее в открывшейся странице необходимо
дождаться, что Lab status изменит значение на Ready.

00:00:48.000 --> 00:00:53.000
Как только это произойдет, вы можете
закрывать это всплывающее окно.

00:00:53.000 --> 00:00:59.000
И далее на странице с лабораторной
работой необходимо нажать на кнопку AWS.

00:00:59.000 --> 00:01:04.000
По нажатию на эту кнопку вас направит на
главную страницу AWS Management Console.

00:01:04.000 --> 00:01:09.988
Согласно заданию нам
необходимо перейти в сервис EC2 и

00:01:10.012 --> 00:01:16.000
посмотреть какие же инстансы
есть в этом AWS аккаунте.

00:01:16.000 --> 00:01:19.773
Сделать вы это можете
двумя путями, либо через

00:01:19.797 --> 00:01:25.000
навигационное меню слева,
либо через ссылку Instances ранее.

00:01:25.000 --> 00:01:32.651
Как только вы переходите по любой из этих
ссылок, вы увидите, что есть один единственный EC2

00:01:32.675 --> 00:01:41.000
instance, в названии которого содержится
aws-cloud9-CafeWebServer. Оно пригодится чуть позже.

00:01:41.000 --> 00:01:46.000
Давайте теперь перейдем на
страницу с лабораторной работой.

00:01:46.000 --> 00:01:51.589
Нажмем на кнопку Details, далее нажмем на
кнопку Show и во всплывающем окне перейдем

00:01:51.613 --> 00:01:57.000
на ссылку Access the multiple choice questions.
Откроется страница с вопросами.

00:01:57.000 --> 00:02:01.988
Это первая лабораторная работа,
где мы помимо выполнения этой

00:02:02.012 --> 00:02:07.000
лабораторной работы также будем
отвечать на некоторые вопросы.

00:02:07.000 --> 00:02:14.000
Сейчас нас просят ответить на первые четыре 
вопроса. Давайте пройдемся по каждому из них.

00:02:14.000 --> 00:02:21.000
Первый вопрос звучит следующим образом.
Находится ли этот инстанс в public subnet-е?

00:02:21.000 --> 00:02:25.988
Давайте это проверим.
Для этого вернемся в AWS Management Console,

00:02:26.012 --> 00:02:31.000
откроем детали инстанса и во
вкладке Networking посмотрим Subnet ID.

00:02:31.000 --> 00:02:36.000
Вы видите, что уже есть подсказка,
что этот subnet является public.

00:02:36.000 --> 00:02:40.000
Но тем не менее, давайте
откроем эту ссылку.

00:02:40.000 --> 00:02:50.000
Она перейдет к деталям этого subnet-а и во
вкладке Route table посмотрим какие routes есть.

00:02:50.000 --> 00:02:55.988
Если есть route на Destination весь
интернет и Target является Internet

00:02:56.012 --> 00:03:02.000
Gateway, это по определению значит,
что этот subnet является публичным.

00:03:02.000 --> 00:03:09.000
У нас есть также два ресурса, которые помогают
контролировать доступ до наших ресурсов в subnet-ах.

00:03:09.000 --> 00:03:14.602
Есть Network ACL, который привязывается 
к subnet-ам. Вы видите, что Inbound

00:03:14.626 --> 00:03:20.000
и Outbound rules разрешают доступ 
со всего интернета. Ограничений нет.

00:03:20.000 --> 00:03:27.988
Также если мы посмотрим Security
группу на уровне нашего инстанса,

00:03:28.012 --> 00:03:36.000
мы увидим, что разрешен доступ
на 22 порт на следующие CIDR блоки.

00:03:41.000 --> 00:03:46.000
Отлично. Давайте вернемся обратно к
списку вопросов и ответим на этот вопрос.

00:03:46.000 --> 00:03:53.000
Так как инстанс находится в public
subnet, мы выбираем опцию Yes.

00:03:56.000 --> 00:03:59.000
Давайте теперь перейдем
ко второму вопросу.

00:03:59.000 --> 00:04:06.000
Согласно этому вопросу у нас спрашивают,
есть ли публичный IP адрес у этого EC2 инстанса?

00:04:06.000 --> 00:04:09.551
Чтобы это проверить нам
достаточно открыть вкладку Details

00:04:09.575 --> 00:04:13.000
и в соответствующем поле
посмотреть есть ли значение.

00:04:13.000 --> 00:04:19.000
Если значение есть, это значит, что
публичный IP адрес присвоен к этому инстансу.

00:04:19.000 --> 00:04:25.000
Поэтому на второй вопрос мы отвечаем Yes.
Третий вопрос звучит следующим образом.

00:04:25.000 --> 00:04:38.000
Какие Inbound ports открыты для подключения к
этому инстансу? Мы с вами это уже посмотрели.

00:04:38.000 --> 00:04:43.000
Давайте вернемся обратно к
странице с деталями EC2 инстанса.

00:04:43.000 --> 00:04:50.000
Откроем вкладку Security и в выделенном
квадрате вы видите, какой доступ предоставлен.

00:04:50.000 --> 00:04:55.988
Это 22 порт на два различных CIDR блока.
Поэтому мы выбираем четвертую опцию, TCP

00:04:56.012 --> 00:05:02.000
port 22 only, open to a specific range of
IP addresses является верным ответом.

00:05:02.000 --> 00:05:05.000
Двигаемся дальше.
Четвертый вопрос.

00:05:05.000 --> 00:05:18.000
Здесь нам необходимо ответить на
вопрос, соединена ли IAM role к EC2 инстансу?

00:05:18.000 --> 00:05:24.000
Чтобы это посмотреть мы возвращаемся
обратно к странице с деталями EC2 инстанса.

00:05:24.000 --> 00:05:31.000
Откроем вкладку Details и в соответствующем
поле увидим, есть ли значение для IAM role.

00:05:31.000 --> 00:05:36.988
Если бы роль была, то вы бы увидели название 
роли и по нажатию которой вы могли бы

00:05:37.012 --> 00:05:43.000
перейти на страницу этой роли. Так как там 
стоит прочерк, значит роль не привязана.

00:05:43.000 --> 00:05:51.000
Поэтому мы отвечаем на этот вопрос No.
Мы переходим к следующему заданию.

00:05:51.000 --> 00:05:55.000
Согласно нему нам необходимо
перейти в сервис Cloud9.

00:05:55.000 --> 00:06:02.000
Для этого в строке поиска начнем вводить
cloud9 и воспользуемся нужной нам ссылкой.

00:06:02.000 --> 00:06:10.000
Как только вы перейдете на главную страницу сервиса
Cloud9 вы увидите список существующих Environments.

00:06:10.000 --> 00:06:14.000
Там будет единственный Environment, 
называется CafeWebServer.

00:06:14.000 --> 00:06:22.381
Мы с вами помним, что EC2 инстанс
содержит в имени CafeWebServer,

00:06:22.405 --> 00:06:30.000
что означает IDE Cloud9 был
поднят в нашем EC2 инстансе.

00:06:30.000 --> 00:06:35.000
Для того чтобы открыть IDE
необходимо нажать на ссылку Open.

00:06:35.000 --> 00:06:48.000
Если в это время EC2 инстанс остановлен, то Cloud9
автоматически его стартует и после откроет нам IDE.

00:06:48.000 --> 00:06:56.000
Также я хотел обратить внимание, что есть
настройка, вы указываете количество времени.

00:06:56.000 --> 00:07:04.600
И если такое время IDE не будет
использоваться, то она автоматически остановит

00:07:04.624 --> 00:07:13.000
EC2 инстанс, чтобы мы не несли
дополнительных расходов, что очень удобно.

00:07:13.000 --> 00:07:24.000
Мы оплачиваем только за EC2 инстанс, когда используем
сервис Cloud9. Сам сервис Cloud9 бесплатный.

00:07:24.000 --> 00:07:32.538
После загрузки IDE мы переходим на основную
страницу этой среды разработки, она состоит

00:07:32.562 --> 00:07:41.000
из трех основных частей. С левой стороны
мы видим навигационное меню, файлы и папки.

00:07:41.000 --> 00:07:47.000
В нижней части есть bash терминал. А посередине
 основное поле - это работа с файлами.

00:07:47.000 --> 00:07:56.000
Здесь мы можем просматривать различные файлы,
также изменять наши скрипты и текстовые файлы.

00:07:56.000 --> 00:08:01.529
Согласно заданию нам необходимо
посмотреть какая операционная система

00:08:01.553 --> 00:08:07.000
установлена на нашем EC2 инстансе.
Мы видим, что это Amazon Linux.

00:08:07.000 --> 00:08:15.038
Я рекомендую ее использовать, потому
что это операционная система нативно

00:08:15.062 --> 00:08:25.000
поддерживающая многие моменты, связанные с AWS.
AWS занимается постоянным ее улучшением.

00:08:25.000 --> 00:08:34.000
На текущий момент уже доступна
вторая версия, то есть Amazon Linux 2.

00:08:34.000 --> 00:08:41.276
Далее мы запускаем список команд,
проверяем версию необходимых нам приложений

00:08:41.300 --> 00:08:48.000
и также проверяем их статус.
Первые две команды проверяют веб-сервер.

00:08:48.000 --> 00:08:56.000
Далее, две команды на проверку
версии и статуса базы данных mysql.

00:08:56.000 --> 00:09:02.000
И последняя команда проверка
версии языка программирования PHP.

00:09:02.000 --> 00:09:07.000
Мы видим, что приложения остановлены,
нам необходимо их стартовать.

00:09:07.000 --> 00:09:13.488
Для этого мы запускаем следующие команды.
В первую очередь мы заносим старт

00:09:13.512 --> 00:09:20.000
этих команд в автозагрузку, далее
стартуем эти приложения и проверяем статус.

00:09:20.000 --> 00:09:30.000
Мы видим, что httpd веб-сервер успешно стартовал.
Далее, то же самое проделываем с базой данных.

00:09:30.000 --> 00:09:38.000
И видим, что оба приложения на текущий
момент запущены и в состоянии Running.

00:09:41.000 --> 00:09:46.988
Далее нам необходимо создать
симлинк до пути var/www и как

00:09:47.012 --> 00:09:53.000
target он будет использовать
/home/ec2-user/environment.

00:09:53.000 --> 00:10:00.588
Это все те файлы, которые доступны в
IDE, будет создана соответствующая папка

00:10:00.612 --> 00:10:09.000
html и веб-сервер будет использовать все
содержание из этой папки для отображения.

00:10:14.000 --> 00:10:21.000
Давайте перейдем в папку
html и создадим там новый файл.

00:10:21.000 --> 00:10:27.000
Назовем ее index.html и она будет
содержать в себе простейшую веб-страницу.

00:10:27.000 --> 00:10:33.000
В тегах html будет текст
Hello from the cafe web server!.

00:10:33.000 --> 00:10:37.000
Отлично, теперь попробуем
открыть наш веб-сервер.

00:10:37.000 --> 00:10:47.000
Мы знаем, что необходимые приложения уже
запущены, тестовую HTML страницу мы уже создали.

00:10:47.000 --> 00:10:52.802
И давайте теперь перейдем к нашему
EC2 инстансу для того, чтобы скопировать его

00:10:52.826 --> 00:10:59.000
публичный IP адрес и попробуем по нему перейти.
Мы видим, что сайт не открывается.

00:11:03.000 --> 00:11:07.000
Здесь нам нужно было провести
некоторый troubleshooting.

00:11:07.000 --> 00:11:10.000
В первую очередь необходимо
проверить Security группы.

00:11:10.000 --> 00:11:18.000
Если мы перейдем на вкладку Security
мы увидим ссылку на Security группу.

00:11:18.000 --> 00:11:24.626
Давайте по нему перейдем и вы видите
в Inbound rules, мы видели ее ранее,

00:11:24.650 --> 00:11:31.000
что доступ есть только по 22 порту
на некоторый список CIDR блоков.

00:11:31.000 --> 00:11:37.000
Нам необходимо предоставить
доступ ко всему интернету на 80 порт.

00:11:37.000 --> 00:11:42.488
Для этого необходимо нажать
на кнопку Edit inbound rules,

00:11:42.512 --> 00:11:48.000
далее добавить новый rule
путем нажатия на кнопку Add rule.

00:11:48.000 --> 00:11:53.911
После чего как Type выбираем HTTP,
Protocol и Port range  автоматически

00:11:53.935 --> 00:11:59.000
заполняется и как Source
необходимо выбрать Anywhere-IPv4.

00:11:59.000 --> 00:12:07.000
И вы увидите, что появится значение
0.0.0.0/0, это CIDR блок всего интернета.

00:12:07.000 --> 00:12:11.000
Все готово, мы можем
сохранить наши изменения.

00:12:11.000 --> 00:12:18.000
Как только сохранили свои изменения в списке
Inbound rules  мы видим новый созданный rule.

00:12:18.000 --> 00:12:27.674
Теперь давайте попробуем вернуться на
страницу с нашей тестовой веб-страницы и

00:12:27.698 --> 00:12:38.000
видим, что она успешно открылась.
Мы видим текст Hello from the cafe web server!.

00:12:38.000 --> 00:12:44.488
Мы с вами двигаемся дальше к
следующему заданию, теперь нам

00:12:44.512 --> 00:12:51.000
необходимо установить приложение
с динамическим контентом.

00:12:51.000 --> 00:12:56.000
Это приложение уже было написано
в рамках лабораторной работы за нас.

00:12:56.000 --> 00:13:02.000
Нам лишь необходимо произвести его
установку и настройку и все, что касается AWS.

00:13:02.000 --> 00:13:09.488
В рамках лабораторного задания
даны команды для загрузки архивов

00:13:09.512 --> 00:13:17.000
и разархивирования содержания 
этих архивов. Давайте их запустим.

00:13:17.000 --> 00:13:29.000
После этого у нас в папке Environment
появятся три папки, это cafe, db и setup.

00:13:29.000 --> 00:13:36.000
Давайте посмотрим содержание папки
cafe, а именно откроем файл index.php.

00:13:36.000 --> 00:13:43.000
Вы видите, что это html документ, также
есть php вставки, то есть запускается php скрипт.

00:13:43.000 --> 00:13:52.000
В этом случае запускаем getAppParameters.php.
Теперь откроем этот файл, посмотрим, что там есть.

00:13:52.000 --> 00:14:01.598
Вы видите, что на третьей строчке используется
AWSSDK и скрипт использует клиент systems

00:14:01.622 --> 00:14:11.000
manager для создания семи параметров.
Давайте запустим этот скрипт в bash терминале.

00:14:11.000 --> 00:14:15.988
Вы видите, что наши параметры
были успешно созданы, тем не

00:14:16.012 --> 00:14:21.000
менее давайте перепроверим
это в AWS Management Console.

00:14:21.000 --> 00:14:31.000
Для этого начнем вводить systems manager и в
появившейся выдаче воспользуемся нужной ссылкой.

00:14:31.000 --> 00:14:35.215
Как только мы перейдем на главную
страницу Systems manager, нам

00:14:35.239 --> 00:14:40.000
необходимо в левом навигационном
меню выбрать пункт Parameter store.

00:14:40.000 --> 00:14:46.498
Как только вы нажимаете на эту ссылку,
нас направляет на страницу со всеми

00:14:46.522 --> 00:14:54.000
параметрами в этом AWS аккаунте и мы
видим, что 7 параметров были успешно созданы.

00:14:54.000 --> 00:15:01.505
Теперь нам необходимо открыть параметр
/cafe/dbPassword, так как мы воспользуемся

00:15:01.529 --> 00:15:08.000
его значением в следующем шаге.
Нам необходимо скопировать значение.

00:15:08.000 --> 00:15:11.000
Теперь нам необходимо
произвести настройку баз данных.

00:15:11.000 --> 00:15:21.000
Для этого необходимо в bash терминале открыть
папку db, там запустить скрипт set-root-password.sh.

00:15:21.000 --> 00:15:28.000
Он запросит новый пароль и здесь вам
необходимо вставить скопированный ранее пароль.

00:15:28.000 --> 00:15:34.033
Далее необходимо запустить скрипт
/create-db.sh, он произведет необходимые

00:15:34.057 --> 00:15:41.000
настройки в базе данных, создаст таблицы
и наполнит эти таблицы тестовыми данными.

00:15:41.000 --> 00:15:51.000
Вы также можете посмотреть содержание лог
файлов, это set-root-password.log и create-db.log.

00:15:51.000 --> 00:15:56.208
Тем не менее давайте попробуем подключиться
к базе данных и посмотреть действительно

00:15:56.232 --> 00:16:01.000
ли все там на месте. Для этого введем
следующую команду, пароль у нас есть.

00:16:01.000 --> 00:16:05.671
Как только мы подключимся мы
увидим приветственные сообщения

00:16:05.695 --> 00:16:11.000
MySQL и увидим prompt, то есть мы
уже можем вводить наши команды.

00:16:11.000 --> 00:16:16.000
Давайте введем следующие команды,
мы посмотрим какие базы данных есть.

00:16:16.000 --> 00:16:25.000
Если мы спозиционируемся на cafe-db, посмотрим какие
есть таблицы, мы видим что у нас есть 4 таблицы.

00:16:25.000 --> 00:16:31.988
Давайте как пример откроем
содержание таблицы product, мы увидим,

00:16:32.012 --> 00:16:39.000
что у нас есть 9 различных позиций
и деталей по каждой из позиций.

00:16:39.000 --> 00:16:51.000
Отлично, давайте теперь произведем последнюю
настройку, нам необходимо ввести тайм зону для PHP.

00:16:51.000 --> 00:16:59.488
Как только мы это сделаем, мы можем
рестартовать наш веб-сервер и можем

00:16:59.512 --> 00:17:08.000
попробовать открыть публичный IP
адрес EC2 инстанса с добавлением /cafe.

00:17:08.000 --> 00:17:14.000
Это тот путь, где находится
наш динамический веб-сайт.

00:17:14.000 --> 00:17:20.000
Мы видим, что отображается только header
Cafe, а оставшаяся часть не отображается.

00:17:20.000 --> 00:17:23.652
Значит что-то работает
некорректно, здесь в рамках

00:17:23.676 --> 00:17:28.000
задания необходимо произвести
некоторый troubleshooting.

00:17:28.000 --> 00:17:34.530
Как подсказка нам
предлагается посмотреть в сторону

00:17:34.554 --> 00:17:42.000
доступов, так как ошибок на
стороне PHP приложения нет.

00:17:42.000 --> 00:17:46.988
Когда мы говорим про доступы,
сразу вспоминается сервис IAM,

00:17:47.012 --> 00:17:52.000
давайте попробуем на него
перейти, посмотрим список ролей.

00:17:52.000 --> 00:17:56.702
В списке ролей мы видим есть
CafeRole, как Trusted entities указано

00:17:56.726 --> 00:18:02.000
сервис EC2, давайте ее откроем и
посмотрим какие policy к ней привязаны.

00:18:02.000 --> 00:18:08.595
Первая policy разрешает действие
EC2 import key, keypair, далее

00:18:08.619 --> 00:18:15.000
есть другая policy, называется
root следующего содержания.

00:18:15.000 --> 00:18:22.000
Предоставляется полные права
для работы с Parameter store.

00:18:22.000 --> 00:18:26.488
Отлично, вам не кажется, что
эта роль идеально бы подошла

00:18:26.512 --> 00:18:31.000
для нашего EC2 инстанса и
соответственно веб-приложения?

00:18:31.000 --> 00:18:39.000
Это и есть ответ на вопрос, давайте теперь
привяжем эту роль к нашему EC2 инстансу.

00:18:39.000 --> 00:18:46.988
Для этого необходимо выбрать наш
EC2 инстанс, далее нажать на кнопку

00:18:47.012 --> 00:18:55.000
Actions, выбрать опцию Security и
далее выбрать опцию Modify IAM role.

00:18:55.000 --> 00:18:59.038
Как только вы на нее нажмете,
вас направят на отдельную

00:18:59.062 --> 00:19:04.000
страницу, где вы можете выбрать
из списка IAM roles нужную role.

00:19:04.000 --> 00:19:12.000
Обратите внимание, в этом списке ролей намного
меньше, чем мы видели ранее в сервисе IAM, почему?

00:19:12.000 --> 00:19:16.708
Потому что не все сервисы
указали как Trusted entity, сервис

00:19:16.732 --> 00:19:22.000
EC2, поэтому мы видим только две
роли, которые мы можем выбрать.

00:19:22.000 --> 00:19:31.000
Нас интересует роль CafeRole, давайте ее
выберем и нажмем на кнопку Update IAM role.

00:19:31.000 --> 00:19:36.650
Как только мы это сделаем, мы
получим сообщение о том, что изменения

00:19:36.674 --> 00:19:43.000
успешно выполнены и также вы увидите
в поле IAM role ссылку на нашу роль.

00:19:43.000 --> 00:19:49.000
Отлично, давайте теперь вернемся на страницу с
нашим веб-приложением и попробуем ее обновить.

00:19:49.000 --> 00:19:54.528
Вы видите, что страница полностью
открылась, у нас появилось некоторое

00:19:54.552 --> 00:20:00.000
содержание, также различные
вкладки и нас интересует вкладка Menu.

00:20:00.000 --> 00:20:09.086
Давайте на нее перейдем и мы увидим, что здесь
можно выбрать продукцию, указать количество,

00:20:09.110 --> 00:20:18.000
давайте выберем три круассана, внизу отображается
 общая сумма и есть кнопка Submit Order.

00:20:18.000 --> 00:20:24.488
Как только мы на нее нажмем, мы перейдем на
страницу с подтверждением нашего заказа.

00:20:24.512 --> 00:20:31.000
Давайте для разнообразия сделаем второй заказ
и закажем горячий шоколад в одном количестве.

00:20:31.000 --> 00:20:36.000
Order Total отображается корректно,
также нажмем на кнопку Submit Order.

00:20:36.000 --> 00:20:44.000
Как только это сделаем, мы получаем подтверждение,
теперь давайте посмотрим на вкладку Order History.

00:20:44.000 --> 00:20:52.988
Отлично, мы видим, что оба наших заказа
корректно отображаются, все детали верны и

00:20:53.012 --> 00:21:02.000
я вас поздравляю с этим, мы успешно
настроили приложение и все корректно работает.

00:21:02.000 --> 00:21:14.000
Теперь мы переходим к следующему заданию, мы будем
создавать второй environment в другом AWS регионе.

00:21:14.000 --> 00:21:20.232
Первым шагом для этого является
создание AMI, а перед созданием AMI нам

00:21:20.256 --> 00:21:26.488
необходимо создать SSH ключи, чтобы
они остались в этом AMI, и можно было

00:21:26.512 --> 00:21:32.487
со скопированным на локальный
компьютер приватным ключом подключаться к

00:21:32.511 --> 00:21:39.000
любому инстансу в любом AWS регионе,
который использует созданный нами AMI.

00:21:39.000 --> 00:21:46.148
Но подключаться по SSH нет
необходимости, это лишь сейчас сообщается

00:21:46.172 --> 00:21:53.000
и показывается как это можно
настроить в будущей вашей работе.

00:21:53.000 --> 00:22:01.488
С точки зрения безопасности,
хранение этих ключей в AMI может

00:22:01.512 --> 00:22:10.000
быть не самым лучшим решением,
это лишь один из вариантов.

00:22:10.000 --> 00:22:16.482
Самым лучшим с точки зрения безопасности
и использования готового функционала,

00:22:16.506 --> 00:22:22.988
является использование соответствующей
настройки при создании EC2 инстанса, где

00:22:23.012 --> 00:22:29.494
вы можете указать нужный вам публичный ключ.
Если у вас есть приватный ключ пара

00:22:29.518 --> 00:22:36.000
от этого публичного ключа, то вы успешно
сможете подключиться к этому инстансу.

00:22:36.000 --> 00:22:43.000
Отлично, необходимо запустить серию команд, которые
создаст SSH ключ и перенесет его в нужное место.

00:22:43.000 --> 00:22:47.529
После того как мы это проделаем,
мы можем начать создание

00:22:47.553 --> 00:22:52.488
AMI. Для этого необходимо в
списке инстансов выбрать наш EC2

00:22:52.512 --> 00:22:57.284
Instance, нажать на кнопку Actions,
в выпадающем меню выбрать

00:22:57.308 --> 00:23:02.000
опцию Image and Templates и
нажать на кнопку Create Image.

00:23:02.000 --> 00:23:07.980
Нас направят на страницу
создания Image, но перед тем как мы

00:23:08.004 --> 00:23:15.000
начнем ее заполнять, нам необходимо
ответить на несколько вопросов.

00:23:15.000 --> 00:23:22.000
Сейчас нам необходимо ответить на
три вопроса, это пятый, шестой и седьмой.

00:23:22.000 --> 00:23:26.267
Пятый вопрос звучит следующим образом.
Когда мы создаем AMI

00:23:26.291 --> 00:23:31.000
от существующего инстанса,
будет ли этот инстанс перезагружен?

00:23:31.000 --> 00:23:35.943
Давайте вернемся на
страницу создания AMI и обратим

00:23:35.967 --> 00:23:42.000
внимание на параметр No Reboot.
По умолчанию он не включен.

00:23:42.000 --> 00:23:50.000
Это говорит о том, что по умолчанию инстанс
при создании от него AMI будет перезагружен.

00:23:50.000 --> 00:23:58.000
Если мы не хотим, чтобы инстанс перезагружался,
то здесь необходимо поставить галочку.

00:23:58.000 --> 00:24:04.000
Таким образом для пятого вопроса
третий вариант ответа является верным.

00:24:04.000 --> 00:24:08.000
Переходим к следующему вопросу.
Звучит он следующим образом.

00:24:08.000 --> 00:24:17.000
Какие свойства root volume мы можем изменять
при создании AMI от существующего инстанса?

00:24:17.000 --> 00:24:23.000
Давайте вернемся обратно на страницу
создания AMI и посмотрим, что мы можем сделать.

00:24:23.000 --> 00:24:29.510
Вы видите, что мы можем изменить размер.
Также мы видим, что мы можем менять

00:24:29.534 --> 00:24:37.000
параметр Delete on termination. Но Volume Type
 и другие параметры мы менять не можем.

00:24:37.000 --> 00:24:49.000
Поэтому возвращаемся обратно к вопросу и выбираем
третий вариант ответа, который является верным.

00:24:49.000 --> 00:24:54.000
Переходим к следующему вопросу.
Седьмой. Звучит он следующим образом.

00:24:54.000 --> 00:25:03.000
Можем ли мы добавить больше volume при создании
AMI от инстанса, у которого есть один root volume?

00:25:03.000 --> 00:25:11.715
Если вы обратили внимание, у нас активная кнопка
Add volume, что означает, что мы можем добавлять

00:25:11.739 --> 00:25:20.000
любое количество data volume при необходимости.
Поэтому на седьмой вопрос мы отвечаем Yes.

00:25:20.000 --> 00:25:28.000
На этом мы ответили на все вопросы.
Возвращаемся к AWS Management Console.

00:25:28.000 --> 00:25:35.000
Необходимо как Image Name ввести CafeServer
и внизу страницы нажать на кнопку Create Image.

00:25:35.000 --> 00:25:41.488
Image будет создаваться порядка двух минут.
Для того, чтобы отобразить

00:25:41.512 --> 00:25:48.000
список AMI, нам необходимо в левом
навигационном меню выбрать пункт AMI.

00:25:48.000 --> 00:25:57.000
Мы увидим, что у нас есть один единственный AMI,
который сейчас создается, так как статус Pending.

00:25:57.000 --> 00:26:03.858
Обновляя страницу, нам необходимо
дождаться, что статус поменяется

00:26:03.882 --> 00:26:10.000
на Available и мы можем
переходить к следующему заданию.

00:26:10.000 --> 00:26:22.000
Следующее задание: необходимо поднять
инстанс в другом регионе, используя этот AMI.

00:26:22.000 --> 00:26:27.000
В рамках лабораторной работы предлагается
самостоятельно попробовать это сделать.

00:26:27.000 --> 00:26:36.000
И первым делом нам нужно скопировать AMI
и сменить регион в AWS Management Console.

00:26:36.000 --> 00:26:43.000
Мы меняем его на регион US West (Oregon). Как
только это сделаем, мы видим, что список AMI пуст.

00:26:43.000 --> 00:26:51.000
Даже если мы начнем искать по скопированному
AMI ID, то поиск тоже ничего не выдает.

00:26:51.000 --> 00:27:04.000
Как решение предлагается скопировать AMI, так
как AMI доступен только в рамках одного региона.

00:27:04.000 --> 00:27:09.988
Если вам нужно этот AMI использовать
в другом регионе, то необходимо его туда

00:27:10.012 --> 00:27:16.000
скопировать, что мы сейчас и сделаем.
Нам необходимо выбрать AMI из списка.

00:27:16.000 --> 00:27:22.000
Далее нажать на кнопку Actions
и выбрать опцию Copy AMI.

00:27:22.000 --> 00:27:32.000
Вы перейдете на соответствующую страницу. Здесь
 оставляем все поля со значениями по умолчанию.

00:27:32.000 --> 00:27:36.000
Единственное необходимо выбрать регион.
В нашем случае US West (Oregon).

00:27:36.000 --> 00:27:41.000
После чего мы можем нажимать на
кнопку Copy AMI в нижней части страницы.

00:27:41.000 --> 00:27:47.000
Отлично, процесс создания копии
AMI в другом регионе был запущен.

00:27:47.000 --> 00:27:59.000
Занимает это порядка 5 минут. Вы можете наблюдать
за статусом создания AMI уже в target регионе.

00:27:59.000 --> 00:28:06.000
Поэтому мы переходим в AWS Management
Console на регион US West (Oregon).

00:28:06.000 --> 00:28:16.000
Обновляя страницу, необходимо дождаться, что
статус из состояния Pending поменяется на Available.

00:28:16.000 --> 00:28:21.000
Как только это произойдет, мы
можем двигаться к следующему заданию.

00:28:21.000 --> 00:28:29.000
Теперь от созданного AMI
мы можем создать EC2 инстанс.

00:28:29.000 --> 00:28:35.000
Для этого необходимо выделить AMI и в верхней правой
части нажать на кнопку Launch instance from AMI.

00:28:35.000 --> 00:28:45.000
Здесь нам необходимо как Name ввести 
ProdCafeServer. Далее Instance Type - t2.small.

00:28:45.000 --> 00:28:51.826
Как Network Settings необходимо будет
ввести некоторые вправки, поэтому необходимо

00:28:51.850 --> 00:28:58.000
нажать на кнопку Edit. Здесь нужно 
будет выбрать VPC - Lab VPC Region 2.

00:28:58.000 --> 00:29:02.000
Далее как Subnet выбираем Public
Subnet из предложенного списка.

00:29:02.000 --> 00:29:10.000
И далее необходимо будет создать
новую Security группу. Ее мы назовем cafeSG.

00:29:10.000 --> 00:29:13.000
Для него необходимо будет
создать два Inbound rules.

00:29:13.000 --> 00:29:17.000
Первый будет разрешать
доступ из интернета на 22 порт.

00:29:17.000 --> 00:29:21.000
Это на тот случай, если нам
нужно будет подключаться по SSH.

00:29:21.000 --> 00:29:29.000
Если все будет корректно выполнено, то в рамках
лабораторной работы мы по SSH подключаться не будем.

00:29:29.000 --> 00:29:41.000
Второй рул - на 80 порт, доступ со всего интернета,
чтобы любой из интернета мог открыть наш веб-сайт.

00:29:41.000 --> 00:29:47.106
Как только мы введем эти настройки,
нам необходимо прокрутить в самый низ

00:29:47.130 --> 00:29:54.000
страницы и в Advanced Details выбрать
роль CafeRole, который мы выбирали ранее.

00:29:54.000 --> 00:30:07.000
И нажать на кнопку Launch Instance, чтобы
запустить процесс создания этого инстанса.

00:30:07.000 --> 00:30:14.180
Как только вы ее нажмете, выйдет
всплывающее окно о том, что мы создаем

00:30:14.204 --> 00:30:22.000
инстанс, где не будет SSH ключей и мы
не сможем подключиться под 22 порту.

00:30:22.000 --> 00:30:26.243
В нашем случае нужные SSH
ключи находятся внутри AMI,

00:30:26.267 --> 00:30:31.000
поэтому мы можем выбрать
опцию Proceed without Key Pair.

00:30:31.000 --> 00:30:36.000
После этого нажимаем на
кнопку Proceed without Key Pair.

00:30:36.000 --> 00:30:42.698
Отлично, мы увидим сообщение о том, что
процесс создания инстанса успешно запущен

00:30:42.722 --> 00:30:49.000
и есть кнопка для перехода к списку всех 
инстансов. Давайте на нее нажмем.

00:30:49.000 --> 00:30:54.000
Как только мы на нее нажмем,
мы увидим, что инстанс создается.

00:30:54.000 --> 00:30:59.000
Необходимо дождаться, чтобы он
прошел все системные проверки.

00:30:59.000 --> 00:31:05.488
Как только все будет готово, нам необходимо
будет выбрать наш инстанс, отобразиться список

00:31:05.512 --> 00:31:12.000
метаданных этого инстанса и во вкладке Details
необходимо скопировать публичный IP адрес.

00:31:12.000 --> 00:31:20.535
Давайте попробуем по нему перейти. Как только
мы по нему перейдем и перейдем именно на наше

00:31:20.559 --> 00:31:29.000
веб-приложение, это IP-адрес/cafe, мы увидим,
что главная страница успешно отображается.

00:31:29.000 --> 00:31:34.000
Давайте теперь попробуем перейти
на вкладку Menu, чтобы сделать заказ.

00:31:34.000 --> 00:31:41.000
Как только мы нажимаем на вкладку Menu,
мы видим, что никакие items не существуют.

00:31:41.000 --> 00:31:46.988
Здесь в рамках лабораторной работы
необходимо было troubleshooting, в чем же

00:31:47.012 --> 00:31:53.000
является проблема и попробовать
самостоятельно ее решить. Я сразу дам ответ.

00:31:53.000 --> 00:32:02.000
Проблема в том, что в этом регионе не созданы
нужные нам параметры. Необходимо их создать.

00:32:02.000 --> 00:32:14.000
Давайте проверим, действительно ли это является
причиной отсутствия продуктов на нашем веб-сайте.

00:32:14.000 --> 00:32:23.000
Для этого переходим к AWS Management Console и
здесь необходимо перейти в сервис Parameter Store.

00:32:23.000 --> 00:32:32.000
Вы можете переходить напрямую на нужную
вам ссылку, если начнете вводить Parameter Store.

00:32:32.000 --> 00:32:36.000
В выдаче в секции Features вы
увидите ссылку на Parameter Store.

00:32:36.000 --> 00:32:41.488
Как только вы на нее нажмете, вы также
перейдете на Systems Manager, это группа

00:32:41.512 --> 00:32:47.000
сервисов, но уже окажетесь на нужной
вам вкладке в левом навигационном меню.

00:32:47.000 --> 00:32:52.988
Обратите внимание, что вы должны
находиться в регионе Oregon и если

00:32:53.012 --> 00:32:59.000
все верно, вы увидите страницу с
предложением создать новый параметр.

00:32:59.000 --> 00:33:05.000
Это говорит о том, что
параметры еще не создавались.

00:33:05.000 --> 00:33:16.000
Отлично, теперь нам необходимо перейти на
основной регион, North Virginia и открыть наш ID.

00:33:16.000 --> 00:33:27.988
Как только мы ее откроем, необходимо также
открыть скрипт set-app-parameters и внести некоторые

00:33:28.012 --> 00:33:40.000
изменения, а именно на строке 12 для переменной
region и на строке 18 для переменной publicDNS.

00:33:40.000 --> 00:33:44.164
Как region нам необходимо
ввести us-west-2, а как publicDNS

00:33:44.188 --> 00:33:49.000
необходимо скопировать значения
у нового созданного EC2 инстанса.

00:33:49.000 --> 00:33:53.188
Как только мы это сделаем,
мы можем нажать правой кнопкой

00:33:53.212 --> 00:33:58.000
мыши на название нашего
скрипта и выбрать опцию Run this file.

00:33:58.000 --> 00:34:05.000
Автоматически откроется новая вкладка
Bash терминала и запустит этот скрипт.

00:34:05.000 --> 00:34:10.176
Мы увидим, что параметры были 
успешно созданы. Давайте теперь вернемся

00:34:10.200 --> 00:34:15.000
к AWS Management Console и
обновим страницу с Parameter Store.

00:34:15.000 --> 00:34:21.197
Мы увидим, что 7 параметров были
успешно созданы и также обратите

00:34:21.221 --> 00:34:28.000
внимание, что вы находитесь в
нужном регионе, то есть регион Oregon.

00:34:28.000 --> 00:34:34.162
Отлично, давайте теперь вернемся на
сайт и обновим страницу и во вкладке

00:34:34.186 --> 00:34:40.000
Menu мы видим, что появились все
наши продукты с тем же составом.

00:34:40.000 --> 00:34:45.678
Давайте теперь попробуем 
что-нибудь заказать. В этот раз

00:34:45.702 --> 00:34:52.000
закажем донат в одном количестве
и попробуем создать заказ.

00:34:52.000 --> 00:34:58.028
Мы увидим подтверждение, что заказ
успешно создан и если перейдем на страницу

00:34:58.052 --> 00:35:04.000
с историей заказов, также видим, что
оно пополнилось одним нашим заказом.

00:35:04.000 --> 00:35:13.000
Все верно. Отлично, я вас поздравляю, на этом
мы успешно завершили эту лабораторную работу.

00:35:13.000 --> 00:35:16.488
Теперь нам необходимо запустить
систему оценивания, чтобы

00:35:16.512 --> 00:35:20.000
убедиться, что мы действительно
все правильно сделали.

00:35:20.000 --> 00:35:25.000
Для этого необходимо перейти на страницу с
лабораторной работой и нажать на кнопку Submit.

00:35:25.000 --> 00:35:31.000
Выйдет всплывающее окно, необходимо нажать 
на кнопку Yes и подождать некоторое время.

00:35:31.000 --> 00:35:38.000
Вы увидите сообщение о том, что вы
набрали столько-то баллов из 30 возможных.

00:35:38.000 --> 00:35:43.000
В моем случае 30 из 30 это максимальный балл.
Надеюсь, что у вас так же.

00:35:43.000 --> 00:35:51.988
Если не так, то вы видите, что есть расшифровка
баллов и сможете определить, на каком этапе, в какой

00:35:52.012 --> 00:36:01.000
задачи была ошибка и попробовать ее исправить.
Сейчас нам необходимо правильно выйти со всех систем.

00:36:01.000 --> 00:36:05.988
Для AWS Management Console
необходимо в верхней правой части

00:36:06.012 --> 00:36:11.000
нажать на название пользователя
и выбрать опцию Sign out.

00:36:11.000 --> 00:36:18.000
На странице с лабораторной работой необходимо
 нажать на кнопку End lab и подтвердить.

00:36:18.000 --> 00:36:21.712
Во всплывающем окне мы
должны увидеть сообщение You may

00:36:21.736 --> 00:36:26.000
close this message box now.
Lab resources are terminating...

00:36:26.000 --> 00:36:32.000
После этого мы закрываем всплывающее окно и
можем закрывать окно с лабораторной работой.

00:36:32.000 --> 00:36:38.000
На этом мы завершили лабораторную
работу, полностью ее разобрали.

00:36:38.000 --> 00:36:43.000
Я очень надеюсь, что вы получили
более полное представление.

00:36:43.000 --> 00:36:48.000
Спасибо за внимание, увидимся с
вами на следующих наших активностях.