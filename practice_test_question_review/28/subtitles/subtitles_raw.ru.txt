 Добрый день, уважаемые студенты! Мы с вами начинаем разбор вопроса practice теста. Что нам дано? Компания использует сервис Amazon S3 для хранения часто запрашиваемых данных. Что сейчас уже настроено, это Event Notification. В момент, когда создается либо удаляется объект в S3 Bucket, оно отправляет это событие сообщением в очередь SQS. Вас, как Солученского Архитекта, попросили сделать следующую логику. Необходимо, чтобы обе команды, разработка и администраторы получали независимо друг от друга сообщение о том, что объекты в S3 Bucket созданы или удалены. Необходимо выбрать один вариант ответа, который является правильным. Давайте посмотрим, какие варианты ответов предлагаются. Вы видите, что первый вариант ответа является верным. Тем не менее, давайте рассмотрим подробнее, какие варианты есть. Обратите внимание, что первый и третий варианты ответа они достаточно похожи. В обоих вариантах предлагается настроить SNS topic. Дальше необходимо дополнительно настроить два SQS. В первом случае наши SQS очереди будут подписаны на SNS topic. А в третьем варианте SQS очереди будут запрашивать данные с SNS topic. Забегая наперед, скажу, что третий вариант заведомо неправильный, потому что SQS сохраняет в себе сообщения, и при этом уже приложения в режиме polling запрашивают новые сообщения с SQS. А SNS это обратный случай, когда у нас не pull based, а push based логика. То есть в момент, когда приходит сообщение SNS, она всем подписчикам в тот же момент рассылает это сообщение. То есть он push это сообщение. Если мы говорим про второй и четвертый вариант, то предлагается добавить дополнительный ресурс. Во втором варианте это SQS очередь, а в четвертом варианте предлагается добавить даже не SQS, а SNS FIFO topic. Самым первым делом давайте вспомним, что такое Event Notification. Это некоторый функционал внутри S3, который помогает вам описать некоторые события, связанные либо с бакетом, либо с объектами внутри этого S3 бакета, и отправить это событие на один target. Как target может выступать либо SNS, либо SQS, либо AWS Lambda. Когда мы говорим конфигурации, мы не можем создать две одинаковых конфигурации. Представим, что как событие мы описываем добавление объектов внутри S3 bucket. В этом случае мы создаем конфигурацию, указываем как target лямбда функцию. Вы не можете в рамках этого функционала создать такое же событие, при этом как target указать что-то другое. То есть на одну конфигурацию, на одно событие может быть создан только один Event Notification. Более того, в рамках одного Event Notification вы не можете указать более одного таргета. Это ограничение данного функционала. Поэтому в случае, если у вас несколько получателей одного и того же события, то рекомендуется настроить следующую архитектуру. У вас есть S3 bucket, так как у вас может быть на одно событие только один таргет, мы отправляем это сообщение в SNS topic. Далее к SNS topic уже прикрепляются подписчики. В нашем случае это два SQS, отдельно, независимо друг от друга. И так как оба SQS являются подписчиками SNS topic, то в момент, когда сообщение доходит до SNS topic, она в этот же момент всем подписчикам рассылает это сообщение. Далее уже отдельно на каждом SQS одно и то же сообщение в продублированном виде живет и отдельно обрабатывается. В нашем случае к одной SQS будет привязана одна команда, ко второй SQS будет привязана вторая команда и независимо будет работать каждый со своей очередью. Таким образом правильным ответом является первый вариант ответа, где нам рекомендуется создать SNS topic, далее сконфигурировать два отдельных SQS и подписаться на SNS topic. На стороне S3 необходимо настроить права доступа, так чтобы S3 могло отправлять сообщение на SNS topic. Давайте теперь подробнее остановимся на неправильных вариантах ответа. Когда мы говорим, варианты ответа, в которых предлагалось добавить дополнительный ресурс либо SQS очередь для второй команды, либо SNS topic для второй команды, оба эти варианты являются неверными. Почему? Потому что мы в рамках Event Notification можем привязаться к конкретному одному событию, то есть добавление нового объекта в S3 bucket или добавление и удаление. Далее мы указываем один единственный таргет. Более того, на одно и то же событие мы не можем создать несколько Event Notification. Вот такие ограничения у этого функционала. Поэтому к Event Notification создание и удаление объектов в S3 bucket мы не можем привязать дополнительный SQS либо SNS. Это нереализуемо. Соответственно, эти оба варианта являются неверными. Когда мы говорим про последний неверный вариант ответа, оно было очень похоже на правильный вариант ответа, отличаясь лишь тем, что SQS очереди должны были полить SNS topic. Полить это значит периодически время от времени запрашивать есть ли новые сообщения там или нет. Если есть, то забирать ее. Здесь специально хитро построили этот вариант ответа, так чтобы запутать. Да, polling относится к SQS, но относится не к источнику SQS, а относится к получателю сообщений от SQS. SQS сам по себе это очередь сообщений. И в очередь сообщений вы либо синхронно, а синхронно, не важно в каком режиме, вы накапливаете сообщения, отправляете в него сообщения. Далее уже получатели этих сообщений, в момент, когда им удобно, они как раз таки запускают polling, то есть время от времени, или в момент, когда получателю удобно принять это сообщение, запрашивает сообщение с SQS и ее обрабатывает. В случае с SNS обратная ситуация. SQS это pull-based logic, SNS это push-based logic. То есть, опять же, не упоминается, как в SNS будет приходить сообщение, здесь имеется в виду, как будут получатели работать с сообщениями от SNS. Так как это push-based logic, то есть SNS topic, к нему подписываются subscribers, то есть подписчики, в нашем случае это два отдельных SQS. И в момент, когда приходит сообщение SNS, SNS topic в ту же секунду сам рассылает всем подписчикам это сообщение и дублирует по всем получателям. Таким образом, SNS он push-ит сообщение, а в этом варианте ответа нам говорится, что мы должны pull-ить сообщение от SNS topic, что является неверным. Поэтому этот вариант также считается неверным вариантом ответа. На этом мы разобрали этот вопрос. Спасибо за внимание.
