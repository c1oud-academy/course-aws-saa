Добрый день, уважаемые студенты! Я рад вас видеть на очередном Демо сессии. Тема сегодняшнего Демо – это разбор функционала автоматических бэкапов и read-реплик у сервиса Amazon RDS. Итак, давайте начнем. Начинаем мы это Демо с основной страницы AWS Management Console. Теперь воспользуемся строкой поиска сервисов и начнем вводить RDS. Первая ссылка – это та ссылка, которая нам нужна. Как только мы оказываемся на основной странице сервиса Amazon RDS, у нас есть две различные кнопки для создания инстанса RDS. Мы можем нажать на любую из них. Нас перенаправят на страницу с входными данными для создания инстанса. Давайте выберем опцию Standard Create и как движок выберем MySQL. Далее есть опция выбрать MySQL Community. В данном случае это единственный возможный вариант. Для других движков, возможно, есть несколько вариантов. Остальные опции оставляем по умолчанию. Как Template выберем Free Tier, чтобы создать этот инстанс в рамках Free Tier на 12 месяцев. Availability и Durability сразу установилась опция и стало недоступны. Мы создаем единственный инстанс без опции Multi-AZ. Как DB instance identifier укажем c1oud-academy-demo-rds. Остальные входные данные оставляем по умолчанию. Как пароль укажем adminadmin. Мы этот инстанс удалим после Демо, поэтому может быть любой пароль. Как тип инстанса выберем Burstable classes. Оно будет выбрано по умолчанию, а также будет выбран тип t3.micro. Это тот тип инстанса, который доступен в рамках Free Tier. Для целей Демо этого более чем достаточно. Для Storage по умолчанию будет введено 200 ГБ. 200 ГБ это очень много. Для целей Демо достаточно указать 20 ГБ. Это минимальное значение, которое мы можем указать. Все другие значения оставляем по умолчанию. Как VPC мы выбираем VPC созданный ранее на предыдущем Демо. Как Security group выбираем существующий дефолтовый. Далее как Availability zone необходимо выбрать ту, на которой у нас активирован VPC. В нашем случае это us-east-1a. Все оставшиеся значения оставляем по умолчанию. Для секции Enhanced monitoring необходимо флажок убрать, для того, чтобы инстанс базы данных создался быстрее. Этот функционал мы не рассматриваем в рамках Демо, поэтому мы можем его отключить. Прокручиваем в самый низ и мы видим здесь информацию по примерной стоимости этого инстанса. Но так как эта настройка попадает в рамках Free Tier, ничего конкретного здесь не сказано. В случае, когда вы будете создавать инстанс, не входящий во Free Tier, у вас будет разбивка отдельная за инстанс баз данных, отдельная за storage хранения. И вы увидите итоговую сумму к оплате в месяц на конкретный инстанс баз данных. Отлично, мы ввели все необходимые настройки. Необходимо нажать на кнопку Create Database, чтобы начать процесс создания базы данных. Оно займет некоторое время, от двух до трех минут. Необходимо на странице со списком баз данных нажимать на кнопку Refresh, либо обновлять страницу. Через некоторое время статус поменяется на Available и мы можем нажать на название баз данных, чтобы открыть основную страницу этого инстанса и посмотреть детали нашей базы данных. Как только мы оказываемся на основной странице нашей базы данных, мы можем здесь найти любую необходимую нам информацию. В самом верху выведена самая основная информация, это имя нашей базы данных. В нашем случае это c1oud-academy-demo-rds. Далее как Role мы видим, что это Instance. Есть еще опция Cluster, когда поднимаются несколько инстансов и работают совместно. Мы видим также нагрузку на CPU, количество connections, так как сейчас нет connections, так и написано 0 connections. Status - Available. Видим информацию о движке, это MySQL Community. Class - это db.t3.micro и информация о Availability зоне, в которой находится база данных. В нашем случае, это us-east-1a. Ниже есть несколько вкладок, сгруппированная информация. Первый - это Connectivity and Security. Здесь вы видите информацию об Endpoint and Port, используя который мы можем подключаться к нашей базе данных. Мы будем это делать в рамках наших лабораторных работ. Далее есть информация по Networking. Это в какой VPC находится, к какому Subnet относится. Информация по безопасности. Есть ссылка на Security группу. Мы видим также отдельно вынесено, доступна эта база публично или нет и так далее. Если мы откроем вторую вкладку Monitoring, мы также видим, у нас есть более шести страниц с дешбордами. Каждый дешборд показывает определенную метрику. Давайте посмотрим на первые два. Это CPU Utilization, то есть какая нагрузка идет на наши процессоры. Вы видите, что недавно эта база данных была создана и в момент включения, когда база поднималась, была нагрузка на CPU. После этого, так как эта база данных нигде не используется, не утилизируется, то нагрузка на нее минимальна, менее 5%. Если вы посмотрите на количество подключений, то с момента запуска не было ни одного подключения и метрика показывает, что на текущий момент 0 подключений к этой базе данных. Третья вкладка - Logs and Events. Здесь мы можем настраивать CloudWatch alarms. Также вы видите секцию Recent Events. Это все события, которые произошли с этим инстансом баз данных. Вы видите время, когда произошло и какое событие. Мы видим, что оно поднялось, инстанс создался, произошел автоматический бэкап нашего инстанса. И также есть события, что бэкап был успешно создан. Ниже есть секция с логами. Здесь сохраняются все логи с привязкой ко времени. И вы можете на любой интересующий вас день скачать логи. Есть различные виды логов. О них мы поговорим чуть позже. У вас есть возможность выбрать любой лог-файл, его посмотреть здесь в AWS Management Console, либо его скачать. Следующая вкладка - это Configuration. Здесь мы видим информацию по железу, по движку. Из основных это вы видите версию движка 8.0.28. Также видите, что у нас есть ARN, который мы можем скопировать. Информация о том, когда база данных была создана. Мы видим также информацию, какой тип инстанса у нас, t3.micro. Количество ядер процессора - 2. Количество оперативной памяти - 1 ГБ. Также видим информацию, что основной пользователь называется admin. Multi-AZ функционал не включен. Шифрование включено. Мы используем AWS KMS key сервиса RDS. У нас storage это General Purpose SSD на 20 гигабайтов. То есть вся необходимая информация может быть найдена в AWS Management Console. Следующая вкладка - это Maintenance and Backups. Здесь мы видим, что есть отдельная секция maintenance, она включена. Она говорит о том, что мы можем указать некоторый промежуток времени, расписание. И в рамках этого времени AWS самостоятельно будет устанавливать обновление базы данных, патчи безопасности и так далее. Это относится только к minor версии базы данных. Если мы говорим про major версию, то это очень большое обновление, ее нужно будет проделывать отдельно. Здесь только информация про апгрейд minor версий баз данных. Также мы видим в следующей секции Pending maintenance ни одной записи. Это говорит о том, что мы сейчас используем самую последнюю версию движка MySQL. Следующая секция - это Backup and Snapshots. В секции Backup информация о том включена ли у нас бэкапирование. Также информация когда, как часто происходят бэкапы. И в секции Snapshots мы можем увидеть все автоматически вручную созданные снапшоты. Сейчас у нас один единственный снапшот, который был создан в момент создания базы данных, на который мы в любой момент можем откатиться. Если вам необходимо изменить некоторые настройки, в том числе и настройки расписания бэкапов, то вы это можете сделать используя кнопку Modify в верхней правой части страницы. Откроется очень похожая страница, которую мы вводили ранее при создании базы данных. И вам необходимо в случае бэкапов спозиционироваться на соответствующей секции и ввести необходимые для вас входные данные. Здесь вы видите мы можем указать частоту создания бэкапов. На текущий момент это 7, то есть каждые 7 дней мы создаем бэкап. Также мы видим, что у нас настроено временное окно, когда может происходить создание бэкапов. Создание бэкапа не требует остановки баз данных, но в момент создания вы можете почувствовать некоторую замедленную работу баз данных. То есть создание бэкапов также дает нагрузку на железо и не рекомендуется выставлять временное окно в то время, когда у вас пиковые нагрузки. Здесь вы можете выбрать время начала, а также длительность временного окна. Как только вы введете изменения, вы увидите в соответствующей секции Summary of modifications все детали того, какие изменения произошли. На примере изменения настроек бэкапов мы видим, что у нас поменялся Backup window с текущего значения на новое значение. И у нас есть два варианта применения этих изменений. Первый вариант - это дождаться следующего maintenance window, когда мы можем устанавливать минорные версии обновления движка, либо использовать опцию Apply immediately, что может быть нежелательно в production среде, но можно для dev environment, чтобы не терять время. И так как мы знаем, что ничего критического не произойдет, если мы применим изменения сразу, то мы можем воспользоваться опцией Apply immediately и нажать на кнопку Modify DB instance. Мы с вами переходим ко второй части нашего сегодняшнего Демо и будем создавать read replica. Для этого необходимо в верхней правой части нажать на кнопку Actions в выпадающем списке выбрать опцию Create read replica. Нас направит на такую же страницу для ввода входных данных, отличается только первая секция. Здесь необходимо выбрать основную базу данных, а также ввести название инстанса баз данных, который является read replica. Все остальные настройки, они точно такие же, как у основной базы данных, при необходимости вы можете ввести правки. В самом конце будет кнопка Create read replica, нам необходимо будет ее нажать и начнется создание инстанса read реплики. Также вы увидите, что статус для основной базы данных поменялся на Modifying, так как она уже становится кластером, у нас уже в кластере два инстанса, один Primary, другой Replica. Также вы в столбце Role видите, что они соответствующе отмечены. Через некоторое время оба инстанса переходят в состояние Available, давайте теперь выберем по очереди каждую базу данных и посмотрим некоторые детали. Если вы выберете основную базу данных, то Endpoint не поменялся, остается таким же, вы можете его использовать для операции чтения, так и для записи. Если вы прокрутите чуть ниже, отдельно есть секция Replication, где находятся два инстанса, основной и replica. Также видите, что для реплики в столбце Replication state указано Replicating, то есть он активирован и репликация также активирована. Если мы выберем Instance read replica, то в секции Endpoint мы видим, что URL отличается, таким образом вы можете ее использовать для ваших операций чтения. И нагрузка уже пойдет на read replica и вы таким образом сможете разгрузить вашу основную базу данных. На этом мы добрались до конца нашей сегодняшней сессии. Я очень надеюсь, что вы получили более полное представление о работе сервиса Amazon RDS. Спасибо за внимание, увидимся с вами на следующих наших активностях.