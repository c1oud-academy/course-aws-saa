Қайырлы күн, құрметті студенттер! Сіздерді келесі зертханалық шолу сессиясында көргеніме қуаныштымын. Бүгінгі зертханалық жұмыстың тақырыбы - біздің бизнес жағдайымызға, яғни кафеге арналған желіні орнату. Бұл зертханалық жұмыс Challenge Lab болып табылады, яғни өте аз нұсқаулар беріледі және өз бетімізше шешімін табуымыз керек. Сондай-ақ, зертханалық жұмыстың өзі өте ауқымды екенін атап өткім келеді, бұл сізге ұнайды және оны жасауға қызығушылық танытады деп сенемін. Ендеше, бастайық. Зертханалық жұмысымызды AWS Academy-дегі Cloud Architecting курсының негізгі парақшасынан бастаймыз. Сол жақтағы шарлау мәзірін пайдаланып, модульге өту керек. Мұнда бізді алтыншы модуль қызықтырады, атап айтқанда Challenge Lab Creating VPC Networking Environment for the Cafe сілтемесі. Зертхананың негізгі парақшасына кіргеннен кейін, Terminal терезесі кедергі жасамайтындай етіп жасырып, зертхана тақырыбын қайта тексеру керек. Барлығын орындағаннан кейін, бизнес кейсімізге көшеміз. Оған сәйкес, София мен Никхил жақында ғана AWS бұлтындағы архитектураны жақсартты және дерекқорды Amazon RDS managed service-тегі EC2 инстансына көшірді. Бұл бүкіл инфрақұрылымның өнімділігін жақсартты, дерекқорды жүргізуге байланысты әкімшілік жұмыстардан босатты, сонымен қатар олар дерекқор ресурстарын public subnet-тен private subnet-ке ауыстырып, оны одан да қауіпсіз етті. Жақында олар Матеомен кездесті. Матео - AWS жүйесіндегі жүйелік әкімші және ол біздің кейіпкерлеріміздің жаңартуларын тыңдап, архитектураны одан әрі жақсартуға кеңес берді. Ол VPC-ді дұрыс орнатуды, оның барлық қажетті құрамдастарын жасауды, сонымен қатар әкімшілік құқықтарға қашықтан қол жеткізу үшін барлық қажетті ресурстарды құруды ұсынды. Сондай-ақ, бұл шешім дұрыс жұмыс істейтініне және шабуылдардың болмауына көз жеткізу үшін қауіпсіздіктің қосымша қабаттарын қосу қажет болады. Зертханалық жұмыстың аясында біз VPC және оның негізгі компоненттерін құруды үйренеміз. Әрі қарай, private subnet-тегі ресурстарға қауіпсіз, қашықтан қосылуға мүмкіндік беретін ресурстарды қалай жасау керектігін үйренеміз. Сондай-ақ, VPC периметрін одан әрі қорғау үшін қосымша қауіпсіздік деңгейлерін баптаймыз. Зертханалық жұмысты аяқтағаннан кейін, AWS бұлтындағы архитектураның қандай болатынын слайдтан көре аласыз. Бұл зертханалық жұмысты орындау үшін 90 минут ұсынылады. Егер бұл уақыт жеткіліксіз болса, End lab батырмасын баспай-ақ, Start lab батырмасын басып, есептегішті басына келтіруге болады. Сондай-ақ, зертханалық жұмыстар үшін арнайы әзірленген уақытша AWS аккаунты жасалып жатқанын және зертханалық жұмыстарға қатысы жоқ барлық сервистер мен құрамдас бөліктердің қолжетімсіз болуы мүмкін екенін еске саламыз. Зертханалық жұмыста қолданылатын барлық сервистер мен компоненттердің қолжетімді болуына кепілдік беріледі. Зертханалық жұмысты бастау үшін Start lab батырмасын басып, зертханалық жұмысты бастайтынымызды растап, уақытша AWS аккаунты жасалуы аяқталғанша күту керек. Сіз оның жұмыс істеуге дайын күйін көресіз. Осыдан кейін уақытша AWS аккаунтына ауысып, зертханалық жұмысты орындауды бастау үшін AWS батырмасын басуға болады. Біз тапсырмалардың бірінші блогына жеттік және бизнес-кейстің аясында VPC ішінде bastion host-тан бастап, subnet-ке дейінгі әлі жасалмаған барлық қажетті компоненттерді жасау керек. Әрі қарай, bastion host-ының Интернеттен қол жетімді екеніне көз жеткізуіміз керек. Осыдан кейін private subnet-тен Интернетке қауіпсіз қосыла алатындай, бірақ private subnet-тегі ресурстарға қолжетімділік тек public subnet-тегі EC2 инстансы арқылы болатындай етіп барлық қажетті қадамдарды жасаймыз. Біздің жағдайда, бұл - bastion host. Ендеше, бастайық. Бірінші тапсырма. Бірінші тапсырманың аясында public subnet құруымыз керек. Уақытша AWS аккаунтындағы бар VPC тізімінде Lab VPC деп аталатын VPC жасалғанын ескеріңіз. Оны кейін пайдаланамыз. Келесі қадам. Бізге public subnet құру керек. Ол үшін subnet-тер тізіміне өтіп, жаңа subnet құру үшін тиісті батырманы басамыз. Name ретінде Public subnet көрсетеміз, VPC ретінде Lab VPC таңдаймыз, Availability zone ретінде а-ға аяқталатынды таңдауымыз керек. Уақытша AWS аккаунты North Virginia аймағында жасалған болса, Availability zone ретінде us-east-1a таңдау керек. CIDR block ретінде келесі мәнді көрсетеміз және subnet жасаймыз. Содан кейін Internet gateway жасап, оны VPC-ге байланыстыруымыз керек. Келесі қадам - public subnet-тің route table-ін баптау, осылайша интернет трафик target ретінде Internet gateway-ді пайдаланады. Осыдан кейін кастомдық route table жасалған болса, route table-ді public subnet-ке байланыстыру қажет. Егер әдепкі route table қолданып, өзгерткен болсақ, онда байланыстырудың қажеті жоқ, ол VPC ішіндегі барлық subnet-терге автоматты түрде байланыстырылған, мұнда біз кастомдық route table-ді нақты көрсетпедік. Екінші тапсырмада bastion host жасауымыз керек. Bastion host-ты public subnet-те жасаймыз, бұл SSH бойынша Интернет арқылы қосылатын EC2 инстансы. Осы EC2 инстансын жасау кезінде қандай параметрлерді көрсету керек екенін қарастырайық. Операциялық жүйе ретінде Amazon Linux, Amazon Linux 2 AMI (HVM) нұсқасын қолданамыз. Instance Type - t2.micro болуы керек. Әрі қарай, Auto-assign public IP параметрінде жалпы IP мекенжайы тағайындалмауы үшін құсбелгіні алып тастау керек. Бұл не үшін қажет екенін қазір қарастырамыз және келесі қадамда қосымша талдаймыз. Name ретінде Bastion host көрсетуіңіз керек, сонымен қатар Bastion host SG атымен Security тобын жасауыңыз керек және оны тек 22 портта Inbound трафикке рұқсат беру үшін пайдалануыңыз керек, яғни бұл тек біздің IP мекенжайымыз үшін inbound трафикке рұқсат беретін SSH трафигі. Private key ретінде vockey қолданамыз. Енді үшінші тапсырмада Elastic IP address жасауымыз керек. Естеріңізде болса, Bastion host компанияның барлық қызметкерлері қашықтан қосылатын инстанс және ол жалпыға ортақ кіру нүктесі болып табылады. Сондықтан оның IP мекенжайы барлығына белгілі және өзгермеуі өте маңызды. Егер біз инстанс үшін жалпыға ортақ IP мекенжайын жасасақ, онда bastion host белгілі бір себептермен қайта жасалғанда, оның жалпы IP мекенжайы өзгеруі мүмкін және біз оны алдыңғысына қайтара алмаймыз. Осылайша, Bastion host ескі IP мекенжайы жазылған қызметкерлер бұлттағы инфрақұрылымға қосыла алмайды. Сондықтан, дұрыс шешім - жалпыға ортақ IP мекенжайын тұрақты ету, ол үшін Elastic IP address жасаймыз. Оны жасағаннан кейін, оны bastion host-қа байланыстыруымыз керек. Төртінші тапсырмада bastion host-ымен байланысты тексеруіміз керек. Мұны істеу үшін зертханалық жұмыстың парақшасында Details батырмасын басып, ашылмалы тізімнен AWS жанындағы Show батырмасын басыңыз. Мұнда жеке кілтті екі нұсқада жүктеп алу мүмкіндігі бар. Егер Windows операционды жүйесі болса, PPK-мен аяқталатын кілтті жүктеп алу керек. Егер сіз Linux немесе macOS операционды жүйесімен жұмыс істеп жатсаңыз, бұл жағдайда PEM кеңейтімі бар кілтті жүктеп алуыңыз керек. Жүктеп алғаннан кейін, осы терезені жауып, bastion host-ына қосылуға болады. Біз зертханалық жұмыста және Демо сессияларымызда қашықтағы EC2 инстансына қосылу жолын бірнеше рет жасадық, сондықтан бұл жерде егжей-тегжейлі тоқталмаймыз. Бесінші тапсырмада private subnet жасау керек. Private subnet параметрлері үшін Name ретінде Private subnet көрсетеміз, Availability zone ретінде Public subnet үшін көрсетілген availability zone көрсетеміз, CIDR блогы ретінде келесі мәнді көрсетеміз және осымен private subnet жасаймыз. Бірақ private subnet-тен Интернетке қауіпсіз кіру мүмкіндігін қамтамасыз ету үшін NAT gateway жасау керек. NAT gateway public subnet-те жасалады және NAT gateway-мен қатар Elastic IP address жасау керек екенін еске саламын. Осыдан кейін private subnet-тің route table-де routing rule қосу керек, ол интернет-трафикті NAT gateway-ге бағыттайды. Зертханалық жұмыстың аясында private route table деп аталатын route table жасауымыз керек. Бұл өте маңызды, өйткені біздің орындалған жұмысымызды автоматты түрде бағалау кезінде бұл да ескерілуі мүмкін және сіздің ұпайларыңызға әсер етуі мүмкін, сондықтан ресурстарымыз үшін енгізуіміз керек мәнді қатаң сақтау қажет. Жетінші тапсырмада private subnet-тегі EC2 инстансына bastion host-ына байланысты тексеру үшін private subnet-те EC2 инстансын жасау керек болады. Қандай параметрлерді енгізу керек екенін көрейік, AMI ретінде Amazon Linux 2 AMI (HVM), Instance Type ретінде t2.micro, атау ретінде Private instance және Security тобында bastion host security group үшін тек 22 порты бойынша кіріс трафикті белгілейміз. Сондай-ақ, private subnet-тегі инстанс үшін жаңа private key жасаймыз. Оны vockey2 деп атаймыз. Сегізінші тапсырмаға жеттік және бұл жасаған барлық қадамдарды сынаудың алдындағы соңғы қадам. Мұнда bastion host-та private кілтті сақтамай, bastion host-қа, сондай-ақ bastion host-тан private subnet-тегі EC2 инстансына қосылу мүмкіндігін баптауымыз керек. Басқаша айтқанда, Интернет арқылы SSH протоколы бойынша кез келген қашықтағы серверге қосылғанда, біз жеке кілтті компьютерде жергілікті түрде сақтаймыз. PuTTY арқылы қосылғанда, бағдарлама параметрлерінде кілттің қайда орналасқанын, және қосылу кезінде жалпы IP мекенжайын көрсетеміз және кілтпен бірге осы инстансқа сәтті қосыламыз. Енді келесі қадам, осы инстансқа қосылған кезде, біздің жағдайда бұл bastion host, SSH арқылы басқа EC2 инстансына қайта қосылуымыз керек, бірақ бұл EC2 инстансы private subnet-те орналасқан. Сондықтан, мұны істеу үшін екінші EC2 инстансына қосылу үшін bastion host-ында жеке кілт болуы керек. Бұл қауіпті, өйткені бір пайдаланушы арқылы bastion host-қа қосылатын барлық пайдаланушылар олар көрмеуі тиіс кілттерді көруі мүмкін. Сондықтан бұл қауіпсіздік тұрғысынан ең жақсы тәсіл емес, бірақ SSH passthrough деп аталатын дайын шешім бар. Идея мынада: сіз барлық қажетті кілттерді жергілікті түрде сақтайсыз және SSH арқылы бірнеше инстансқа дәйекті түрде қосылсаңыз, бұл кілттер сіз қосылып жатқан инстанстан ізделмейді, олар алғаш SSH қосылымы болған жергілікті компьютерден алынады. Бұл үшін не істеу керек? Windows операциялық жүйесінің пайдаланушылары үшін сілтеме бойынша өтіп, Pageant бағдарламасын жүктеп алу керек. Бұл бағдарламаны да PuTTY бағдарламасын жасаған топ әзірлеген. Оны жүктеп алғаннан кейін орнатып, іске қосуымыз керек. Оны іске қосқаннан кейін, өте қарапайым интерфейс болады және екі кілтті Bastion Host-тан vockey және private subnet-тен vockey2 осы бағдарламаға қосу керек. Жеке кілттеріңізде .PPK кеңейтімі болуы керек екенін ескеріңіз. Әрі қарай, PuTTY арқылы қосылу кезінде қосымша параметрлерді енгізу қажет болады, атап айтқанда Connection - SSH - Auth жолы арқылы өтіп, Allow agent forwarding үшін құсбелгі қойыңыз. Сондай-ақ, сол бөлімдегі Credentials бөлімін, атап айтқанда, Private key for authentication өрісін толтыруды ұмытпаңыз. Мұнда bastion host-ына қосылу үшін private key таңдауымыз керек. Біздің жағдайда, бұл - vockey. Оны жасағаннан кейін, біздің bastion host-ымыздың жалпы IP мекенжайын пайдаланып, қосылып көреміз. MacOS немесе Linux операциялық жүйесі бар пайдаланушылар үшін тапсырмада көретін келесі командаларды ретімен енгізу керек. Идеясы бірдей, сіз кілттерді параметрлердің белгілі бір жерінде сақтайсыз, содан кейін қосымша белгімен қосылған кезде bastion host-ына SSH қосылымын жасайсыз. Енді bastion host-ына қосылуымыз керек. Қосылғаннан кейін, bastion host-ынан private subnet-тегі EC2 инстансына қосылуымыз керек. Оны қалай жасау керектігін білесіз, сондықтан мұнда көп тоқталмаймын. Private subnet-тегі EC2 инстансына сәтті қосылғаннан кейін, осы инстанстың Интернетке кіру мүмкіндігі бар-жоғын тексерейік. Мұны істеу үшін қарапайым ping командасын және барлық сегіздіктері бар IP мекенжайын енгізуге болады, егер пакеттер алмасуын көрсеңіз және бұл пакеттер алмасу сәтті болса, бұл инстанстың Интернетке кіру мүмкіндігі бар және барлық параметрлерді дұрыс енгіздік дегенді білдіреді. Біз зертханалық жұмысымыздың екінші блогына жеттік, мұнда қауіпсіздіктің қосымша деңгейлерін жасаймыз. Бизнес-кейсімізге сәйкес, София мен Никхил бұлттық архитектурадағы жаңартуларын досы Матеомен бөлісті, ол барлық жаңартуларды тыңдағаннан кейін, қосымша AWS бұлтындағы IT архитектурасын одан әрі қорғау үшін Network ACL пайдалануды ұсынды. Енді оны жасайтын боламыз. Бірінші кезекте Network ACL жасау керек. Бұл Network ACL кастомдық болып табылады, біз әдепкі Network ACL барлық кіріс және шығыс трафикке рұқсат беретінін және әдепкі бойынша subnet-терге байланыстыратынын есте ұстаймыз. Custom Network ACL жасаған жағдайда, әдепкі бойынша кіріс және шығыс қатынас жабылады және кіруге рұқсат беру үшін қосымша ережелер жасау керек. Бізге Custom Network ACL-ді Lab Network ACL деп атап, оны private subnet-ке байланыстыру керек. Әрі қарай, осы Custom subnet үшін біз барлық кіріс және шығыс трафикке рұқсат беруіміз керек, содан кейін оны 11-ші тапсырмада сынаймыз. Оны тексеру үшін public subnet-те келесі параметрлері бар сынақ EC2 инстансын жасау керек. AMI ретінде Amazon Linux 2 AMI (HVM), Instance Type ретінде t2.micro болады, атауы Test Instance болады және осы инстанстың Security тобында барлық кіріс ICMP IPv4 трафигіне рұқсат беруіміз керек. Бұл - команда жолында ping командасын іске қосқаннан кейін келетін трафик. Осы сынақ инстансының жеке IP мекенжайын ол жасалған бойда сақтауымыз керек және команда жолына ораламыз, мұнда private subnet-тегі жеке инстансқа ағымдағы қосылымымыз бар және осы жерде ping арқылы сынақ инстансының жеке IP мекенжайына қосылып көреміз. Сіз ping өтіп жатқанын, пакеттер алмасатынын көресіз және бұл жеке инстанс public subnet-тегі сынақ инстансымен байланыса алатынын көрсетеді. Енді кастомдық Network ACL-ге өзгертулер енгізуіміз керек, бұл Network ACL private subnet-ке байланысты екенін еске саламын. Мұнда белгілі бір IP мекенжайы үшін барлық ICMP IPv4 трафигіне тыйым салу керек. Бір IP мекенжайын көрсету қажет болғанда, бір IP мекенжайы бар 32 өлшемді CIDR блогы пайдаланылады. Бұл ереженің басымдығы оның жұмыс істеуі үшін басқа ережелерден жоғары болуы керек екенін ескеріңіз. Ping командасы орындалып жатқан Terminal-ды жаппай, пакеттерді жіберуге рұқсат етейік. Network ACL өзгертулерін сақтағаннан кейін, пакеттердің алмасуы тоқтағанын көресіз. Бұл Network ACL арқылы кіру тыйым салынған және қауіпсіздіктің қосымша қабатын қосқанымызды көрсетеді. Енді public subnet-тегі сынақ инстансы үшін арнайы кіруге рұқсат бермейтін кастомдық Network ACL бар екенін көресіз. Мұның бәрі дұрыс жұмыс істесе, бұл параметрлерді дұрыс енгізгеніңізді білдіреді, осымен тапсырмалардың соңғы блогына жеттік. Мұнда зертханалық жұмыстың негізгі парақшасында Details батырмасын басу керек, содан кейін ашылмалы мәзірде Access the multiple choice questions сілтемесін басу керек. Ол 6 сұрақтан тұрады. Сұрақтардың әрқайсысына тоқталайық. Бірінші сұрақ келесідей. Public subnet-тегі Internet gateway-дің мақсаты қандай? Келесі екінші сұрақ. Private subnet-тегі инстансына Интернетке қосылуға және жаңартуларды жүктеп алуға не мүмкіндік береді? Үшінші сұрақ. Private subnet-тегі инстанс Интернетке тікелей қосыла ала ма? Төртінші сұрақ. Неліктен біз private subnet-тегі инстансқа және public subnet-тегі инстансқа, атап айтқанда, bastion host үшін екі бөлек кілт жасадық? Бесінші сұрақ. Bastion host ping командасын сәтті қосып, private subnet-тегі инстанстан жауап ала алады ма? Бұл өте жақсы сұрақ. Алтыншы сұрақ. Private subnet-тегі инстанстың Security тобындағы қандай ереже осы инстанстан public subnet-тегі сынақ инстансына жіберілген ping командасының кіріс трафигіне рұқсат береді? Сұрақтар бар парақшада жауап нұсқалары болады, оларды талдап, дұрыс жауап беру үшін дұрыс емес жауап нұсқаларын алып тастау әдісін қолдануға болады. AWS Management Console-де орындалатын әрекеттерді бірнеше рет қайталауға болатынын ескеріңіз. Тапсырманы жіберу үшін зертханалық жұмыстың негізгі парақшасында Submit батырмасын басып, автобағалау скриптін орындап жатқаныңызды растау керек. Зертханалық жұмыс ауқымды болғандықтан, ол сәтті аяқталғанша біраз уақыт күту керек және жинаған ұпайларыңызды парақшаның оң жағында көресіз. Егер максималды ұпай жинай алмасаңыз, онда әрқашан қай қадамда, қай тапсырмада ұпайыңыз жеткіліксіз екенін қарап, сол тапсырмаға оралып, оны қайталап орындауыңызға болады. Қажетті өзгерістерді енгізгеннен кейін, автоматты бағалау скриптін қайта іске қосып, зертханалық жұмыстың аясында алған ұпайларды жаңартуға болады. Зертханалық жұмысты орындағаннан кейін, барлық жүйелерден дұрыс шығуыңыз керек. Ең алдымен, AWS Management Console жүйесінен шығуыңыз керек. Әрі қарай, зертханалық жұмыстың негізгі парақшасында End lab батырмасын басып, зертханалық жұмысты аяқтағаныңызды растау керек, содан кейін зертханалық жұмыс парақшасын жабу керек. Осымен біздің зертханалық жұмысқа шолу сессиямыз аяқталды. Бұл өте қызықты зертханалық жұмыс және сізге ұнады деп үміттенемін. Сұрақтарыңыз болса, сұраңыз. Назарларыңызға рахмет, келесі белсенділіктерде кездескенше.