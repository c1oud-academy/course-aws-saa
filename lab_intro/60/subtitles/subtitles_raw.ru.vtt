WEBVTT

00:00:00.000 --> 00:00:07.000
Добрый день, уважаемые студенты! Я рад вас всех видеть на очередной сессии «Введение лаборатурную работу».

00:00:07.000 --> 00:00:17.000
Тема сегодняшней лаборатурной работы – это введение в сервис Amazon Elastic File System или вкратце Amazon EFS.

00:00:17.000 --> 00:00:21.000
Итак, давайте начнем.

00:00:21.000 --> 00:00:28.000
Начинаем мы с вами лаборатурную работу с основной страницы курса AWS Academy Cloud Architecting

00:00:28.000 --> 00:00:37.000
В навигационное меню нам необходимо выбрать вкладку Modules, спозиционироваться на 4-м модуле Adding a Compute Layer

00:00:37.000 --> 00:00:44.000
и как активность нас интересует Guided Lab – Introducing Amazon Elastic File System.

00:00:44.000 --> 00:00:48.000
Давайте на нее нажмем, чтобы перейти на основную страницу лаборатурной работы.

00:00:48.000 --> 00:00:56.000
Здесь нам нужно будет скрыть окно терминала для того, чтобы все задание отображалось на всю страницу.

00:00:56.000 --> 00:00:58.000
Итак, мы начинаем.

00:00:58.000 --> 00:01:03.000
Эта лаборатурная работа рассчитана на 20 минут.

00:01:03.000 --> 00:01:08.000
В рамках лаборатурной работы мы создадим свой EFS.

00:01:08.000 --> 00:01:17.000
Далее подключимся через SSH к инстанцу EC2 и там попробуем подключиться к EFS.

00:01:17.000 --> 00:01:26.000
После чего сделаем некоторые тесты производительности нашего созданного EFS.

00:01:26.000 --> 00:01:34.000
Напоминаю, что будут некоторые ограничения к сервисам, не относящимся к лаборатурной работе.

00:01:34.000 --> 00:01:40.000
Это нормально, так как мы работаем в песочнице AWS Academy.

00:01:40.000 --> 00:01:47.000
Для того, чтобы начать лаборатурную работу, необходимо нажать на кнопку Start Lab.

00:01:47.000 --> 00:01:50.000
Откроется специальное окно.

00:01:50.000 --> 00:01:55.000
В этом окне будет статус инициации AWS аккаунта.

00:01:55.000 --> 00:02:02.000
Как только вы увидите сообщение о готовности этого аккаунта, мы можем закрывать это всплывающее окно.

00:02:02.000 --> 00:02:10.000
И нам необходимо будет нажать на кнопку AWS для перехода на основную страницу AWS Management Console.

00:02:10.000 --> 00:02:16.000
Итак, мы начинаем изучение деталей первого задания.

00:02:16.000 --> 00:02:26.000
Здесь нам необходимо создать Security Group для того, чтобы мы могли обращаться к EFS.

00:02:26.000 --> 00:02:36.000
А именно, мы создадим Security Group, для которой разрешено Inbound подключение TCP по порту 2049.

00:02:36.000 --> 00:02:41.000
Это как раз таки тот порт, который используется NFC.

00:02:41.000 --> 00:02:49.000
Для этого в AWS Management Console необходимо в строке поиска начать вводить EC2.

00:02:49.000 --> 00:02:52.000
В выдаче увидим нужный нам сервис и по нему перейти.

00:02:52.000 --> 00:03:00.000
Либо вы можете воспользоваться кнопкой Services и в большом выпадающем меню попробовать найти сервис EC2.

00:03:00.000 --> 00:03:04.000
В зависимости от того, что вам удобнее, оба варианта верны.

00:03:04.000 --> 00:03:16.000
Как только мы оказываемся на основной странице сервиса EC2, в левом навигационном меню необходимо будет нажать на вкладку Security Groups.

00:03:16.000 --> 00:03:21.000
Вы увидите список существующих Security Group на этом аккаунте.

00:03:21.000 --> 00:03:33.000
Если вас интересует Security Group под названием EFS Client, нам необходимо ее выбрать и когда выйдет окошко с деталями скопировать ее ID.

00:03:33.000 --> 00:03:39.000
Как только мы это сделали, мы можем начинать создание новой Security Group.

00:03:39.000 --> 00:03:43.000
Для этого необходимо будет нажать на кнопку Create Security Group.

00:03:43.000 --> 00:03:50.000
Как входные данные для создания этого ресурса, можно ввести следующие.

00:03:50.000 --> 00:03:53.000
Сериалом Security Group Name будет EFS Mount Target.

00:03:53.000 --> 00:03:58.000
Как description нужно будет указать Inbound NFS Access from EFS Clients.

00:03:58.000 --> 00:04:04.000
И как VPC нужно будет из выпадающего списка выбрать Lab VPC.

00:04:04.000 --> 00:04:10.000
Далее прокрутить чуть ниже будет специальная секция для настройки рулов.

00:04:10.000 --> 00:04:13.000
Inbound рулов и Outbound рулов.

00:04:13.000 --> 00:04:15.000
Нас интересуют Inbound рулы.

00:04:15.000 --> 00:04:17.000
Необходимо нажать на кнопку Add Rule.

00:04:17.000 --> 00:04:19.000
Добавится строчка.

00:04:19.000 --> 00:04:23.000
В строчке выбрать NFC и как Source выбрать Custom.

00:04:23.000 --> 00:04:41.000
Как только вы это сделаете, в поле Custom Box можно будет ввести Security Group ID скопированное ранее и выбрать отобразившуюся Security Group.

00:04:41.000 --> 00:04:47.000
После чего нажать на кнопку Create Security Group.

00:04:47.000 --> 00:04:50.000
Мы с вами переходим к следующему заданию.

00:04:50.000 --> 00:04:54.000
Здесь мы будем создавать EFS файловую систему.

00:04:54.000 --> 00:04:58.000
Пару моментов хотелось бы сказать из теории.

00:04:58.000 --> 00:05:10.000
EFS может быть привязан к нескольким сетям инстанцам, которые находятся в различных availability зонах, но в одной и том же AWS регионе.

00:05:10.000 --> 00:05:17.000
Для того, чтобы подключить файловую систему к инстанцам, используются mount targets.

00:05:17.000 --> 00:05:22.000
Это те ресурсы, которые создаются на каждой availability зоне.

00:05:22.000 --> 00:05:28.000
Это нужно в рамках стандарта NFC 4 версии.

00:05:28.000 --> 00:05:37.000
Также следует помнить, что EFS может быть подключена к только одной VPC в один момент времени.

00:05:37.000 --> 00:05:46.000
Если вам нужно подключить EFS к инстанцам, находящимся в другом VPC, то из первого VPC нужно отключиться.

00:05:46.000 --> 00:05:51.000
Далее произвести подключение уже к инстанцам из второго VPC.

00:05:51.000 --> 00:06:03.000
Еще раз хотел бы отметить, что EFS файловая система и VPC должны находиться в одном и том же AWS регионе, чтобы мы могли настроить подключение между ними.

00:06:03.000 --> 00:06:15.000
Итак, мы начинаем выполнение задания. Для этого необходимо в строке поиска сервисов начать вводить EFS, выбрать из выдачи нужный нам пункт и перейти на этот сервис.

00:06:15.000 --> 00:06:21.000
В открывшейся странице мы можем начать сразу создавать нашу файловую систему.

00:06:21.000 --> 00:06:24.000
Для этого необходимо нажать кнопку Create File System.

00:06:24.000 --> 00:06:32.000
В открывшейся странице выбрать опцию Customize и на первом шаге начать вводить некоторые значения.

00:06:32.000 --> 00:06:36.000
В поле Enable automatic backups нужно будет галочку убрать.

00:06:36.000 --> 00:06:40.000
Далее, где Lifecycle Management, нужно будет выбрать опцию None.

00:06:40.000 --> 00:06:44.000
Все это не нужно в рамках нашей лаборатурной работы.

00:06:44.000 --> 00:06:52.000
В будущем вы будете исходить из вашей бизнес-садачи. Если нужно, то эти настройки будете производить.

00:06:52.000 --> 00:06:58.000
Необходимо добавить тег, ключ Name, значение My First EFS File System.

00:06:58.000 --> 00:07:08.000
Как только это все сделали, остальные значения оставляем по умолчанию и нажимаем на кнопку Next, чтобы перейти на вторую страницу настроек.

00:07:08.000 --> 00:07:15.000
Здесь нужно будет для VPC выбрать наш предварительно созданный LAP VPC.

00:07:15.000 --> 00:07:22.000
Далее вы увидите, что для каждой availability зоны была привязана дефолтовая security группа.

00:07:22.000 --> 00:07:28.000
Нам необходимо нажать на кнопку X, чтобы их удалить.

00:07:28.000 --> 00:07:35.000
И мы сейчас будем привязывать созданную нами ранее security группу к каждой availability зоне.

00:07:35.000 --> 00:07:46.000
Для этого в соответствующих полях необходимо будет выбрать security группу EFS Mount Target.

00:07:46.000 --> 00:07:56.000
Как только вы это все проделаете, вам представлен пример части страницы, как должно выглядеть.

00:07:56.000 --> 00:08:02.000
Если оно совпадает, значит вы все сделали правильно и можете двигаться к следующей, третьей странице.

00:08:02.000 --> 00:08:05.000
Для этого нажмем на кнопку Next.

00:08:05.000 --> 00:08:12.000
На третьей странице ничего изменять не нужно, поэтому мы нажимаем еще раз на кнопку Next, оказываемся на четвертой странице.

00:08:12.000 --> 00:08:16.000
Здесь отображаются все введенные нами настройки.

00:08:16.000 --> 00:08:22.000
Проверяем, что все совпадает так, как просят задание лабораторной работы.

00:08:22.000 --> 00:08:25.000
Если все отлично, нажимаем на кнопку Create.

00:08:25.000 --> 00:08:31.000
Обратите внимание, что создание EFS занимает некоторое время, от двух до трех минут.

00:08:31.000 --> 00:08:43.000
Поэтому нам необходимо на странице со всеми файловыми системами, обновляя страницу, дождаться, что ее статус поменяется на available.

00:08:43.000 --> 00:08:51.000
Как только это произойдет, мы можем переходить на следующее задание.

00:08:51.000 --> 00:08:54.000
Мы с вами переходим к третьему заданию.

00:08:54.000 --> 00:08:59.000
Здесь нам необходимо подключиться по SSH к EC2 инстанцу.

00:08:59.000 --> 00:09:02.000
Это задание поделено на две независимые части.

00:09:02.000 --> 00:09:09.000
В первой части описывается инструкция для пользователей с операционной системой Windows.

00:09:09.000 --> 00:09:22.000
Вторая часть, если ваше устройство, компьютер или ноутбук на операционной системе macOS или Linux.

00:09:22.000 --> 00:09:26.000
Если это так, то вы можете пропустить первую часть и переходить ко второй.

00:09:26.000 --> 00:09:32.000
Итак, что нам необходимо сделать, чтобы подключиться к EC2 инстанцу по SSH?

00:09:32.000 --> 00:09:36.000
Первым делом нам необходимо скачать private key.

00:09:36.000 --> 00:09:41.000
Для этого необходимо на странице лабораторной работы нажать на кнопку details.

00:09:41.000 --> 00:09:44.000
В выпадающем меню нажать на кнопку show.

00:09:44.000 --> 00:09:47.000
Откроется специальная страница.

00:09:47.000 --> 00:09:57.000
И здесь будет ссылка download ppk, по нажатию которой начнется загрузка private key.

00:09:57.000 --> 00:10:00.000
Называется он labuser.ppk.

00:10:00.000 --> 00:10:04.000
Необходимо будет его скачать локально на ваш компьютер.

00:10:04.000 --> 00:10:11.000
Далее нам необходимо вернуться на AWS Management консоль.

00:10:11.000 --> 00:10:23.000
Найти единственный EC2 инстанц, открыть его детали и сохранить у себя его публичный IP адрес.

00:10:23.000 --> 00:10:34.000
После того как мы это сделали, мы можем открывать специальную программу пути.

00:10:34.000 --> 00:10:45.000
Если она у вас не установлена, вы можете нажать на кнопку либо через поисковик найти эту программу, скачать и установить.

00:10:45.000 --> 00:10:49.000
Программа не требует стандартной установки.

00:10:49.000 --> 00:10:57.000
Обычно после того как вы запускаете файл, сразу открывается программка и готова к использованию.

00:10:57.000 --> 00:11:18.000
Но только вы открываете файл, необходимо будет внести некоторые настройки, а именно во вкладке connection необходимо для поля seconds between keepalives ввести 30, для того чтобы наша сессия проработала дольше.

00:11:18.000 --> 00:11:25.000
Далее необходимо будет перейти на вкладку session, это основная вкладка.

00:11:25.000 --> 00:11:40.000
В поле hostname or ipaddress необходимо будет вставить IP адрес инстанца, который мы скопировали ранее.

00:11:40.000 --> 00:12:00.000
В основании нам необходимо будет указать путь до нашего приватного ключа, для этого в левом навигационном меню нужно будет перейти на вкладку connection, внутри будет еще одна под вкладка ssh, далее off и последнее credentials.

00:12:00.000 --> 00:12:17.000
Как только мы на нее нажмем, откроется основная страница связанная с этими настройками, в поле private key for the authentication необходимо будет нажать на кнопку browse и выбрать файл labuser.ppk.

00:12:17.000 --> 00:12:44.000
Как только вы это сделаете, вы можете нажать на кнопку open, выберется этот файл, нажать на open еще раз и после этого нажатия откроется отдельное окошко с подключением, придет сообщение о том, что действительно ли вы доверяете этому серверу, в нашем случае да, мы доверяем и нажимаем на кнопку accept.

00:12:44.000 --> 00:13:11.000
Возьмите в вкладку login пользователя, для всех ec2 инстанцев на базе линукс операционной системы пользователем по умолчанию является ec2-user, давайте ее введем, нажмем на кнопку enter, после чего отобразится welcome сообщение и отобразится prompt, куда вы можете вводить ваши команды.

00:13:11.000 --> 00:13:20.000
Теперь давайте пройдемся по тем действиям, которые должны произвести пользователи с операционной системой macOS или Linux.

00:13:20.000 --> 00:13:49.000
Здесь необходимо скачать уже ключ в другом формате, для этого необходимо нажать на кнопку details на странице лаборатурной работы, далее нажать на кнопку show, в открывшейся странице будет кнопка download pem, то есть не ppk, а pem формат, как только вы ее нажмете откроется страница для сохранения файла labuser.pem,

00:13:49.000 --> 00:14:13.000
локальная на вашем компьютере, давайте ее сохраним, далее нам необходимо будет в AWS Management Console перейти на сервис ec2, найти там instance ec2 public IP и в деталях этого инстанса скопировать public IP адрес.

00:14:13.000 --> 00:14:24.000
IP адрес этого инстанса также возможно будет на этой странице, где вы будете скачивать private key, если он есть можете скопировать ее оттуда.

00:14:24.000 --> 00:14:49.000
Как только вы скачали ключ, вы можете перейти по пути cd downloads в директории пользователя, домашней директории пользователя и убедиться, что папка labuser.pem присутствует.

00:14:49.000 --> 00:14:58.000
Для того, чтобы ее использовать, нам необходимо задать соответствующие права, поэтому введем следующую команду chmod 400 labuser.pem.

00:14:58.000 --> 00:15:26.000
Далее нам необходимо будет ввести команду для подключения к удаленному серверу, вы видите на экране эту команду ssh-i labuser.pem указываем наш private key и вводим ec2 user, собачка и IP адрес нашего инстанса.

00:15:26.000 --> 00:15:52.000
Здесь также возможно будет сообщение с предупреждением доверяете ли вы этому подключению, мы нажимаем на кнопку yes, после чего нас перебрасывает на страницу с ec2 instance, где вы можете начать вводить ваши команды.

00:15:52.000 --> 00:16:05.000
Мы с вами переходим к четвертому заданию, здесь нам необходимо создать новую директорию и к этой директории присоединить нашу EFS файловую систему.

00:16:05.000 --> 00:16:28.000
Первым делом в ssh сессии давайте введем команду sudo mkdir EFS, это создаст папку EFS, далее нам необходимо перейти в AWS Management Console, там перейти в сервис EFS и в отобразившемся списке EFS файловых систем выбрать ту, которую мы создали ранее, она называется my first EFS file system.

00:16:28.000 --> 00:16:40.000
Как только мы ее выберем станет активна кнопка attach сверху справа, давайте на нее нажмем, после нажатия отобразится всплывающее окно с различными командами.

00:16:40.000 --> 00:17:03.000
Нас интересует секция using the nfs client, это специальная команда, предподготовленная специально для этого EFS, которая подключает ее к ec2 instance через nfs client, давайте ее скопируем и введем в наши ssh сессии.

00:17:03.000 --> 00:17:11.000
Мы можем также проверить, что подключение прошло успешно, введя команды, которые вы видите на слайде.

00:17:11.000 --> 00:17:33.000
В результате вы должны увидеть список файловых систем, одна из них в названии содержит EFS, ваш регион amazon.aws.com, вы видите как тип nfs4 и также видите папку, которая она примонтирована, то есть подключена.

00:17:33.000 --> 00:17:43.000
Должно быть slash home, slash ec2 user, название нашего пользователя, slash EFS, это та папка, которую мы создавали ранее.

00:17:43.000 --> 00:17:58.000
Мы с вами добрались до заключительной части нашей сегодняшней лабораторной работы, это пятое задание, здесь мы будем проводить искусственные тесты, операции ввода вывода, так называемые IEO операции,

00:17:58.000 --> 00:18:14.000
для того, чтобы посмотреть как хорошо работает EFS файловая система. В этом нам поможет инструмент flexible.io, оно доступно уже в операционной системе и ее дополнительно устанавливать не нужно.

00:18:14.000 --> 00:18:34.000
Вы видите готовую команду, которая генерирует файл размером 10 гигабайт, мы этот файл будем создавать напрямую в EFS и таким образом посмотрим как быстро мы можем передавать данные между нашими c2 инстанцем и EFS файловой системой.

00:18:34.000 --> 00:18:47.000
Запуск команды может занять некоторое время, в среднем это от 5 до 10 минут, поэтому после запуска команды вы можете взять небольшой перерыв и вернуться через некоторое время.

00:18:47.000 --> 00:19:11.000
Как только вы вернетесь, вы увидите детали запуска этого теста, нас в частности интересует последняя строчка, начинается на write и здесь вы видите IEO равно 10 240 MB, это 10 гигабайтов весь файл, далее видите agrb, это скорость записи при создании этого файла,

00:19:11.000 --> 00:19:37.000
мы видим что она создавалась со скоростью чуть меньше чем 20 мегабайтов в секунду, то же самое относится minb и maxb, это минимальная и максимальная скорость во время записи и также видите сколько времени нам потребовалось чтобы записать этот файл.

00:19:37.000 --> 00:19:53.000
Теперь давайте посмотрим метрики, которые у нас доступны в рамках сервиса Amazon CloudWatch, для этого найдем ее в списке сервисов, либо начнем вводить строки для поиска сервисов и перейдем на этот сервис.

00:19:53.000 --> 00:20:07.000
Как только перейдем в левом навигационном меню нужно перейти на вкладку metrics, откроется страница, там нужно будет выбрать all metrics, выбрать EFS и далее выбрать file system metrics.

00:20:07.000 --> 00:20:29.000
Откроется целый список metrics, нам необходимо будет выбрать permitted throughput, как только вы ее нажмете в верхней части экрана нарисуется график, если ничего не видно подождите некоторое время, так как данные появляются с небольшим отставанием.

00:20:29.000 --> 00:20:39.000
После двух-трех минут можете обновить страницу и вы увидите, у вас появился график.

00:20:39.000 --> 00:20:57.000
Если вы наведете мышку на любое место в этом графике, вы увидите значение 105 мегабайтов, это та скорость, с которой мы создавали наш файл.

00:20:57.000 --> 00:21:06.000
Это максимальная скорость, которая разрешена для записи для пустого, недавно созданного EFS.

00:21:06.000 --> 00:21:15.000
Обращаю ваше внимание, что с увеличением размера EFS скорость, которая разрешена для записи и для чтения, также увеличивается.

00:21:15.000 --> 00:21:23.000
Чем больше ваш EFS, тем большую пропускную способность она может выдать.

00:21:23.000 --> 00:21:34.000
Давайте вернемся обратно к All tab metrics, уберем галочку с метрики permitted throughput и выберем метрику data right IO bytes.

00:21:34.000 --> 00:21:49.000
Как только вы ее выберете, вы увидите другой график. Давайте введем некоторые уточнения, а именно перейдем на вкладку statistics.

00:21:49.000 --> 00:22:00.000
Далее выберем как операцию по отображению сумм, как период укажем одну минуту и попробуем навести на пиковое значение.

00:22:00.000 --> 00:22:08.000
Вы видите на примере значение в 6000.

00:22:08.000 --> 00:22:20.000
Если мы поделим это значение на 60, то мы плюс-минус должны получить то значение, которое отображалось на нашем тесте в SSH сессии.

00:22:24.000 --> 00:22:30.000
На этом мы завершили нашу лабораторную работу. Я вас поздравляю.

00:22:30.000 --> 00:22:40.000
Давайте теперь попробуем запустить проверку и убедиться, что мы все задания сделали верно.

00:22:40.000 --> 00:22:47.000
Для этого необходимо нажать на кнопку submit в сообщении подтвердить нажать на кнопку yes.

00:22:47.000 --> 00:22:54.000
Через какое-то время после того как отработают все проверки отобразится вкладка grades.

00:22:54.000 --> 00:23:06.000
Там вы увидите все детали. Если вы получили не максимальную оценку, хотите ее улучшить, вы можете посмотреть в какое из заданий не хватает баллов и попробовать ее выполнить снова.

00:23:06.000 --> 00:23:21.000
Если же вы получили максимальный балл, я вас поздравляю. Вы сделали все абсолютно верно и надеюсь все правильно для себя поняли, получили более полное представление о сервисе Amazon EFS.

00:23:21.000 --> 00:23:32.000
Также не забывайте правильно выходить из лабораторной работы. Для этого необходимо нажать на кнопку end lab в сообщении.

00:23:32.000 --> 00:23:44.000
Необходимо подтвердить, что мы хотим завершить нажать на кнопку yes и в всплывающем окне дождаться, когда отобразится сообщение, что мы можем закрывать страницу с лабораторной работы.

00:23:44.000 --> 00:23:58.000
На этом мы закончили сессию обзора лабораторной работы. Спасибо за внимание. Увидимся с вами на следующих наших активностях.