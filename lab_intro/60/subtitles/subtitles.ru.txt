Добрый день, уважаемые студенты! Я рад вас всех видеть на очередной сессии «Введение в лабораторную работу». Тема сегодняшней лабораторной работы – это введение в сервис Amazon Elastic File System или вкратце Amazon EFS. Итак, давайте начнем. Начинаем лабораторную работу с основной страницы курса AWS Academy Cloud Architecting. В левом навигационном меню нам необходимо выбрать вкладку Modules, спозиционироваться на 4-м модуле Adding a Compute Layer и как активность нас интересует Guided Lab – Introducing Amazon Elastic File System. Давайте на нее нажмем, чтобы перейти на основную страницу лабораторной работы. Здесь нужно скрыть окно Terminal для того, чтобы все задание отображалось на всю страницу. Итак, мы начинаем. Эта лабораторная работа рассчитана на 20 минут. В рамках лабораторной работы мы создадим свой EFS. Далее, подключимся через SSH к EC2 инстансу и там попробуем подключиться к EFS. После чего сделаем некоторые тесты производительности нашего созданного EFS. Напоминаю, что будут некоторые ограничения к сервисам, не относящимся к лабораторной работе. Это нормально, так как мы работаем в песочнице AWS Academy. Для того, чтобы начать лабораторную работу, необходимо нажать на кнопку Start Lab. Откроется специальное окно. В этом окне будет статус инициации AWS аккаунта. Как только увидите сообщение о готовности этого аккаунта, можем закрывать это всплывающее окно. И нам необходимо будет нажать на кнопку AWS для перехода на основную страницу AWS Management Console. Итак, мы начинаем изучение деталей первого задания. Здесь нам необходимо создать Security Group для того, чтобы мы могли обращаться к EFS. А именно, мы создадим Security Group, для которой разрешено Inbound подключение TCP по порту 2049. Это как раз таки тот порт, который используется NFC. Для этого в AWS Management Console необходимо в строке поиска начать вводить EC2. В выдаче увидим нужный нам сервис и по нему перейти. Либо можете воспользоваться кнопкой Services и в большом выпадающем меню найти сервис EC2. В зависимости от того, что вам удобнее, оба варианта верны. Как только мы оказываемся на основной странице сервиса EC2, в левом навигационном меню необходимо будет нажать на вкладку Security Groups. Вы увидите список существующих Security Group на этом аккаунте. Нас интересует Security Group под названием EFS Client, нам необходимо ее выбрать и когда выйдет окошко с деталями скопировать ее ID. Как только мы это сделали, мы можем начинать создание новой Security Group. Для этого необходимо будет нажать на кнопку Create Security Group. Как входные данные для создания этого ресурса, можно ввести следующие. Security Group Name будет EFS Mount Target. Как Description нужно будет указать Inbound NFS Access from EFS Clients. И как VPC нужно будет из выпадающего списка выбрать Lab VPC. Далее, прокрутить чуть ниже, будет специальная секция для настройки рулов, Inbound rules и Outbound rules. Нас интересуют Inbound rules. Необходимо нажать на кнопку Add Rule. Добавится строчка. В этой строчке выбрать NFS и как Source выбрать Custom. Как только вы это сделаете, в поле Custom Box нужно будет ввести Security Group ID скопированное ранее и выбрать отобразившуюся Security Group. После чего нажать на кнопку Create Security Group. Мы с вами переходим к следующему заданию. Здесь мы будем создавать EFS файловую систему. Пару моментов хотелось бы сказать из теории. EFS может быть привязан к нескольким EC2 инстанcам, которые находятся в различных availability зонах, но в одном и том же AWS регионе. Для того, чтобы подключить файловую систему к инстансам, используются mount targets. Это ресурсы, которые создаются на каждой availability зоне. Это нужно в рамках стандарта NFC 4 версии. Также следует помнить, что EFS может быть подключена только к одной VPC в один момент времени. Если вам нужно подключить EFS к инстансам, находящимся в другом VPC, то из первого VPC нужно отключиться. Далее произвести подключение уже к инстансам из второго VPC. Еще раз хотел бы отметить, что EFS файловая система и VPC должны находиться в одном и том же AWS регионе, чтобы мы могли настроить подключение между ними. Итак, мы начинаем выполнение задания. Для этого необходимо в строке поиска сервисов начать вводить EFS, выбрать из выдачи нужный нам пункт и перейти на этот сервис. В открывшейся странице мы можем начать сразу создавать нашу файловую систему. Для этого необходимо нажать кнопку Create File System. В открывшейся странице выбрать опцию Customize и на первом шаге начать вводить некоторые значения. В поле Enable automatic backups нужно будет галочку убрать. Далее, где Lifecycle Management, нужно будет выбрать опцию None. Все это не нужно в рамках нашей лабораторной работы. В будущем вы будете исходить из вашей бизнес-задачи. Если нужно, то эти настройки будете производить. Необходимо добавить тег, Key: Name, Value: My First EFS File System. Как только это все сделали, остальные значения оставляем по умолчанию и нажимаем на кнопку Next, чтобы перейти на вторую страницу настроек. Здесь нужно будет для VPC выбрать наш предварительно созданный Lab VPC. Далее вы увидите, что для каждой availability зоны была привязана default security group. Нам необходимо нажать на кнопку X, чтобы их удалить. И мы сейчас будем привязывать созданную нами ранее security group к каждой availability зоне. Для этого в соответствующих полях необходимо будет выбрать security group EFS Mount Target. Как только вы это все проделаете, вам представлен пример части страницы, как должно выглядеть. Если оно совпадает, значит вы все сделали правильно и можете двигаться к следующей, третьей странице. Для этого нажмем на кнопку Next. На третьей странице ничего изменять не нужно, поэтому мы нажимаем еще раз на кнопку Next, оказываемся на четвертой странице. Здесь отображаются все введенные нами настройки. Проверяем, что все совпадает так, как указано в задании лабораторной работы. Если все отлично, нажимаем на кнопку Create. Обратите внимание, что создание EFS занимает некоторое время, от двух до трех минут. Поэтому нам необходимо на странице со всеми файловыми системами, обновляя страницу, дождаться, что ее статус поменяется на Available. Как только это произойдет, мы можем переходить к следующему заданию. Мы с вами переходим к третьему заданию. Здесь необходимо подключиться по SSH к EC2 инстансу. Это задание поделено на две независимые части. В первой части описывается инструкция для пользователей с операционной системой Windows. Вторая часть, если ваше устройство, компьютер или ноутбук на операционной системе macOS или Linux. Если это так, то вы можете пропустить первую часть и переходить ко второй. Итак, что нам необходимо сделать, чтобы подключиться к EC2 инстансу по SSH? Первым делом нам необходимо скачать private key. Для этого необходимо на странице лабораторной работы нажать на кнопку Details. В выпадающем меню нажать на кнопку Show. Откроется специальная страница. И здесь будет ссылка Download PPK, по нажатию которой начнется загрузка private key. Называется он labsuser.ppk. Необходимо будет его скачать локально на ваш компьютер. Далее нам необходимо вернуться на AWS Management Console. Найти единственный EC2 инстанс, открыть его детали и сохранить у себя его публичный IP-адрес. После того как мы это сделали, мы можем открывать специальную программу PuTTY. Если она у вас не установлена, вы можете нажать на кнопку либо через поисковик найти эту программу, скачать и установить. Программа не требует стандартной установки. Обычно после того как вы запускаете файл, сразу открывается программа и готова к использованию. Как только вы открываете файл, необходимо внести некоторые настройки, а именно во вкладке Connection для поля Seconds between keepalives ввести 30, чтобы наша сессия проработала дольше. Далее необходимо будет перейти на вкладку Session, это основная вкладка. В поле Host Name or IP address необходимо вставить IP-адрес инстанса, который мы скопировали ранее. Далее необходимо указать путь до нашего приватного ключа, для этого в левом навигационном меню нужно перейти на вкладку Connection, внутри будет еще одна под вкладка SSH, далее Auth и последнее Credentials. Как только мы на нее нажмем, откроется основная страница, связанная с этими настройками, в поле Private key file for authentication необходимо нажать на кнопку Browse и выбрать файл labsuser.ppk. Как только вы это сделаете, можете нажать на кнопку Open, выберется этот файл, нажать на Open еще раз и после этого нажатия откроется отдельное окошко с подключением, придет сообщение о том, что действительно ли вы доверяете этому серверу, в нашем случае да, мы доверяем и нажимаем на кнопку Accept. Вас запросит ввести login пользователя, для всех EC2 инстансов на базе Linux OS пользователем по умолчанию является ec2-user, давайте ее введем, нажмем на кнопку Enter, после чего отобразится welcome сообщение и отобразится prompt, куда вы можете вводить ваши команды. Теперь давайте пройдемся по тем действиям, которые должны произвести пользователи с операционной системой macOS или Linux. Здесь необходимо скачать уже ключ в другом формате, для этого необходимо нажать на кнопку Details на странице лабораторной работы, далее нажать на кнопку Show, в открывшейся странице будет кнопка Download PEM, то есть не ppk, а pem формат, как только вы ее нажмете откроется страница для сохранения файла labsuser.pem, локально на компьютере, давайте ее сохраним, далее необходимо в AWS Management Console перейти на сервис EC2, найти инстанс EC2PublicIP и в деталях инстанса скопировать public IP address. IP-адрес этого инстанса также возможно будет на этой странице, где вы будете скачивать private key, если он есть можете скопировать ее оттуда. Как только вы скачали ключ, вы можете перейти по пути cd ~/Downloads в домашнем директории пользователя и убедиться, что папка labsuser.pem присутствует. Для того, чтобы ее использовать, нам необходимо задать соответствующие права, поэтому введем следующую команду chmod 400 labsuser.pem. Далее необходимо ввести команду для подключения к удаленному серверу, вы видите на экране эту команду ssh -i labsuser.pem указываем наш private key и вводим ec2-user@<public-ip> IP-адрес нашего инстанса. Здесь будет сообщение с предупреждением доверяете ли вы этому подключению, мы нажимаем на кнопку Yes, после чего нас перебрасывает на страницу с EC2 инстансом, где вы можете начать вводить ваши команды. Мы с вами переходим к четвертому заданию, здесь нам необходимо создать новую директорию и к этой директории присоединить нашу EFS файловую систему. Первым делом в SSH session давайте введем команду sudo mkdir efs, это создаст папку EFS, далее нам необходимо перейти в AWS Management Console, там перейти в сервис EFS и в отобразившемся списке EFS файловых систем выбрать ту, которую мы создали ранее, она называется My first EFS file system. Как только мы ее выберем станет активна кнопка Attach сверху справа, давайте на нее нажмем, после нажатия отобразится всплывающее окно с различными командами. Нас интересует секция Using the NFS client, это команда, предподготовленная для этого EFS, которая подключает ее к EC2 инстансу через NFS client, давайте скопируем и введем в SSH session. Мы можем также проверить, что подключение прошло успешно, введя команды, которые вы видите на слайде. В результате должны увидеть список файловых систем, одна из них в названии содержит EFS, ваш регион amazonaws.com, как тип nfs4 и также папку, к которой она примонтирована, то есть подключена. Должно быть /home/ec2-user/efs, это та папка, которую мы создавали ранее. Мы с вами добрались до заключительной части нашей сегодняшней лабораторной работы, это пятое задание, здесь мы будем проводить искусственные тесты, операции ввода вывода, так называемые IO операции, для того, чтобы посмотреть как хорошо работает EFS файловая система. В этом нам поможет инструмент Flexible IO (fio), оно доступно уже в операционной системе и ее дополнительно устанавливать не нужно. Вы видите готовую команду, которая генерирует файл размером 10 гигабайт, мы этот файл будем создавать напрямую в EFS и таким образом посмотрим как быстро мы можем передавать данные между нашим EC2 инстансом и EFS файловой системой. Запуск команды может занять некоторое время, в среднем от 5 до 10 минут, поэтому после запуска команды вы можете взять небольшой перерыв и вернуться через некоторое время. Как только вы вернетесь, вы увидите детали запуска этого теста, нас в частности интересует последняя строчка, начинается на WRITE и здесь вы видите io = 10 240 MB, это 10 гигабайтов весь файл, далее видите aggrb, это скорость записи при создании этого файла, мы видим что она создавалась со скоростью чуть меньше чем 20 мегабайтов в секунду, то же самое относится к minb и maxb, это минимальная и максимальная скорость во время записи и также видите сколько времени нам потребовалось чтобы записать этот файл. Теперь посмотрим метрики, которые у нас доступны в рамках сервиса Amazon CloudWatch, для этого найдем ее в списке сервисов, либо начнем вводить в строке для поиска сервисов и перейдем на сервис. Как только перейдем в левом навигационном меню нужно перейти на вкладку Metrics, откроется страница, там нужно будет выбрать All metrics, выбрать EFS и далее выбрать File system metrics. Откроется целый список метрик, нам необходимо будет выбрать PermittedThroughput, как только вы ее нажмете в верхней части экрана нарисуется график, если ничего не видно подождите некоторое время, так как данные появляются с небольшим отставанием. После двух-трех минут можете обновить страницу и вы увидите, что у вас появился график. Если вы наведете мышкой на любое место в этом графике, вы увидите значение 105 мегабайтов, это та скорость, с которой мы создавали наш файл. Это максимальная скорость, которая разрешена для записи для пустого, недавно созданного EFS. Обращаю ваше внимание, что с увеличением размера EFS, скорость, которая разрешена для записи и для чтения, также увеличивается. Чем больше ваш EFS, тем большую пропускную способность она может выдать. Давайте вернемся обратно к All metrics tab, уберем галочку с метрики PermittedThroughput и выберем метрику DataWriteIOBytes. Как только вы ее выберете, вы увидите другой график. Давайте введем некоторые уточнения, а именно перейдем на вкладку Graphed metrics tab. Далее как Statistics - Sum, как Period укажем 1 Minute и попробуем навести на пиковое значение. Вы видите на примере значение в 6000. Если мы поделим это значение на 60, то мы плюс-минус должны получить то значение, которое отображалось на нашем тесте в SSH Session. На этом мы завершили нашу лабораторную работу. Я вас поздравляю. Давайте теперь попробуем запустить проверку и убедиться, что мы все задания сделали верно. Для этого необходимо нажать на кнопку Submit, в сообщении подтвердить нажать на кнопку Yes. Через какое-то время после того как отработают все проверки отобразится вкладка Grades. Там вы увидите все детали. Если вы получили не максимальную оценку, хотите ее улучшить, вы можете посмотреть в каком из заданий не хватает баллов и попробовать ее выполнить снова. Если же вы получили максимальный балл, я вас поздравляю. Вы сделали все абсолютно верно и надеюсь все правильно для себя поняли, получили более полное представление о сервисе Amazon EFS. Также не забывайте правильно выходить из лабораторной работы. Для этого необходимо нажать на кнопку End lab, в сообщении необходимо подтвердить, что мы хотим завершить нажать на кнопку Yes и в всплывающем окне дождаться, когда отобразится сообщение, что мы можем закрывать страницу с лабораторной работы. На этом мы закончили сессию введения в лабораторную работу. Спасибо за внимание. Увидимся с вами на следующих наших активностях.