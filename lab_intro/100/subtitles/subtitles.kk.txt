Қайырлы күн, құрметті студенттер! Келесі зертханалық шолу сессиясында көруге қуаныштымын. Зертханалық жұмыстың тақырыбы - дерекқорды Amazon RDS сервисіне көшіру болып табылады. Ендеше, бастайық. Зертханалық жұмысты шолуды AWS Academy-дегі Cloud Architecting курсының басты парақшасынан бастаймыз. Мұнда біз сол жақтағы шарлау мәзірін пайдаланып, Modules опциясын таңдауымыз керек. Барлық модульдері бар парақша ашылады. Біз бесінші модульге кіруіміз керек – Adding a database layer және Module 5 – Challenge Lab – Migrating a database to Amazon RDS сілтемесін басыңыз. Оны басқаннан кейін зертханалық жұмыстың негізгі парақшасына өтесіз. Мұнда зертханалық тапсырмаларды оқуға ыңғайлы болу үшін Terminal терезесін алып тастау керек. Ол үшін Terminal құсбелгісін алып тастау керек. Ендеше зертханалық жұмысқа шолуды бастаймыз. Зертханалық жұмыстың тақырыбы - Amazon RDS сервисіне дерекқорды көшіру. Сценарий бойынша кафе айтарлықтай танымал болды, бірақ қазіргі уақытта веб-сервер де, дерекқор да, қолданба коды да бір EC2 құрылғысында жұмыс істейді. Бұл ұзақ мерзімді және сенімді шешім емес, сондықтан қосымша техникалық жұмысты қажет етпейтін және кейіпкерлерімізді біраз босатып, басқа маңызды тапсырмаларға назар аударуға көмектесетіндей дерекқорды бөліп алу туралы шешім қабылданды. Бұл деректер өте маңызды, өйткені Марта деректерді бухгалтерлік есеп үшін, ал Фрэнк өнімдердің жаңа түрлерін шығару үшін тапсырыстар тарихын пайдаланып, талдау жасайды. Сондықтан, осы кейстің аясында Марта қызы Софиядан қандай техникалық шешімдер бар екенін және дерекқордың жұмысын жақсарту үшін не істеуге болатынын қарастыруды сұрады. Зертханалық жұмыстың аясында EC2 машинасында орнатылған дерекқорды Amazon RDS сервисіне ауыстырамыз және екі жақта да бірдей қозғалтқыш болады, бұл MariaDB. Зертханалық жұмысты аяқтағаннан кейін RDS деректер базасын құруды, сонымен қатар деректерді MariaDB-ге экспорттауды және импорттауды үйренеміз. Егер импорттасақ, RDS инстансына қосыламыз. Сондай-ақ, осы зертхананың бөлігі ретінде алдын ала жазылған веб-қосымшаны қолданамыз және ол арқылы Amazon RDS дерекқор инстансына қосылымды баптаймыз. Зертханалық жұмыстың басында бізде AWS аккаунтында келесі ресурстар диаграммасы болады. Сіз EC2 құрылғысында веб-сервер, деректер базасы және қолданбаның өзі бар екенін көресіз. Зертханалық жұмысты аяқтағаннан кейін MariaDB дерекқорын сол availability zone-дағы private subnet-ке тасымалдаймыз және ол Amazon RDS сервисінің бөлігі ретінде іске қосылады. Бұл зертханалық жұмысты 80 минут ішінде орындау ұсынылады. Сондай-ақ, егер бұл уақыт жеткіліксіз болса, End lab батырмасын баспай-ақ, Start lab батырмасын бассаңыз, есептегіш қайта басталатынын еске саламын. Сондай-ақ, құмсалғышта жұмыс істейтінімізге назар аударғым келеді. Бұл - тиісті шектеулері бар уақытша жасалған AWS аккаунт. Бұл сервистердің сервистері мен функционалдығы зертханалық жұмыстың аясында қолжетімді болады. Басқа сервистер мен функциялар қол жетімді болмауы мүмкін. Зертханалық жұмысты бастау үшін жоғарғы оң жақ бөлігінде Start lab батырмасын басу керек. Терезе ашылады, зертханалық жұмысты бастауға болатынын күтуіңіз керек, уақытша AWS аккаунты жасалды және енді осы қалқымалы терезені жабуға болады және AWS батырмасын басқаннан кейін AWS Management Console негізгі парақшасына бағытталасыз. Зертханалық жұмыстың бірінші тапсырмасын бастаймыз. Мұнда, кейс бойынша, София AWS Solutions Architect болып табылатын Оливиямен кеңесіп, жағдайын түсіндірді. Оливия Amazon RDS сервисін пайдалануды ұсынды, бұл Софияны дерекқормен байланысты әкімшілік жұмыстан босатуға көмектеседі. Ол Amazon RDS сервисінің артықшылықтарын айтты және нәтижесінде София келісті, енді осы тапсырманың аясында Amazon RDS сервисінің дерекқорының инстансын жасаймыз. Ең алдымен, Amazon RDS сервисіне бару керек, содан кейін Create database батырмасын басыңыз. Кіріс деректерін енгізуге арналған парақша ашылады, онда қозғалтқыш ретінде MariaDB, Templates ретінде Dev/Test, DB Instance identifier ретінде CafeDatabase, Username ретінде admin енгізу керек, Password ретінде бұл мәнді көшіріп, тиісті өріске қою қажет. DB Instance class ретінде db.t2.micro таңдау керек, t2 тобы қол жетімді емес және жалғыз қол жетімді t3 тобы болуы мүмкін, бұл жағдайда t3.micro таңдаймыз. Storage type ретінде General Purpose (SSD) таңдаймыз, зертханалық жұмыс үшін жеткілікті, Allocated storage ретінде 20 ГБ таңдаймыз, бұл ең аз мүмкін мән және зертханалық жұмыс үшін жеткілікті. Содан кейін Standby instance жасамау опциясын таңдауыңыз керек, бұл жағдайда Multi-AZ deployment опциясы өшіріледі және жасалған availability zone-да инстанстың бір көшірмесі болады. VPC ретінде біз Lab VPC, Subnet ретінде lab-db-subnet-group таңдаймыз, ол біз үшін жасалған, оны таңдауымыз керек, бұл private subnet. Содан кейін Security group ретінде Default security group құсбелгіні алып тастап, жасалған dbSG security group таңдау керек. Availability zone өрісінде a әрпімен аяқталатын zone-ды таңдау керек. Мысалы, егер сізде уақытша AWS аккаунты North Virginia аймағында ашылған болса, ол us-east-1, онда availability zone ретінде us-east-1a таңдау керек. Database port ретінде 3306 TCP портын пайдалануыңыз керек, бұл - MariaDB дерекқорының әдепкі порты. Сондай-ақ, Enhanced monitoring опциясын өшіруіміз керек екенін ескертемін, өйткені бұл зертханалық жұмыстың бөлігі ретінде қажет емес. Себебі Enhanced monitoring опциясы өшірілгенде, дерекқор әлдеқайда жылдам жасалады. Дерекқор инстансын жасай бастағанда, барлық дерекқорлары бар парақшаға өтесіз және дерекқорды жасау процесінің басталғанын көрсететін хабарды көресіз. Дерекқорды құрудың аяқталуын күтудің қажеті жоқ, тікелей екінші тапсырмаға өте берсеңіз болады. Біз екінші тапсырмаға көшеміз және мұнда EC2 инстансында қолданбамыздың жұмысын тексереміз. Мұны істеу үшін EC2 сервисіне өтуіміз керек, содан кейін барлық бар инстанстарды ашуымыз керек және CafeServer деп аталатын инстанстың мәліметтерін ашуымыз керек. Мұны істегеннен кейін Public IP address көшіріп, осы IP мекенжайын браузердің жаңа қойындысына енгізіп, соңында /cafe деп қосуымыз керек. Біз веб-серверімізге өтеміз. Веб-қосымшаның парақшасы ашылады, оның дерекқормен дұрыс жұмыс істейтінін тексеріп көрейік. Ол үшін Menu қойындысына өтіп, кез келген позиция үшін нөлден басқа мәнді көрсетіңіз және ең төменгі жағындағы Submit order батырмасын басыңыз. Біз растау парақшасына бағытталатын боламыз, сіз таңдаған өнімдердің осы парақшада дұрыс және қажетті мөлшерде көрсетілгеніне көз жеткізуіңіз керек. Сондай-ақ, тапсырыстар журналының парақшасын қайта тексеру керек, егер оны ашсаңыз, ең соңғы тапсырыс сіз жасаған тапсырыс көрсетіледі. Егер бәрі дұрыс болса, жақсы, қосымша дұрыс жұмыс істеп тұр, әрі қарай жүреміз. Енді EC2 инстансына қосылу керек, ол үшін AWS Systems Manager сервисін қолданамыз. Бұл әрекетті орындау үшін сервистерді іздеу жолағына Systems Manager енгізіп, сәйкес сілтемені таңдаңыз. AWS Systems Manager сервисі ашылған бойда сессияны бастаймыз және қосылу үшін CafeServer таңдаңыз. Мұны жасағаннан кейін веб-браузерде жаңа қойынды ашылады және бұл EC2 инстансына қосылым болады. Промптты көресіз, командаларды енгізуге болады, Bash shell-ге ауысу керек, сондықтан bash деп енгіземіз. Енді ec2-user пайдаланушысына ауысуымыз керек, бірақ ол үшін алдымен root пайдаланушыға ауысайық. Ол үшін sudo su командасын енгізіңіз, содан кейін root пайдаланушысынан su ec2-user командасын енгізіп, ec2-user пайдаланушысы атынан қосыламыз. Егер whoami командасын енгізсек, жауапта ec2-user пайдаланушысын пайдаланып жатқанымызды көресіз. Және соңғы команда, пайдаланушының басты папкасына өтуіміз керек, ол үшін cd /home/ec2-user/ енгіземіз. Бұл слайдта енгізілген командаларды және нәтижелерді көресіз, егер бәрі солай болса, онда бәрін дұрыс орындадыңыз. Бұл жерде Systems Manager-де агент бар екенін атап өткім келеді, ол әдепкі бойынша барлық Amazon Linux 2 инстанстарында, сондай-ақ кейбір басқа операциялық жүйелерде орнатылған. Инстанстарға SSH клиентін пайдаланбай, тікелей AWS Management Console-ден қосылу үшін екі қадамды орындау керек. Бірінші қадам - user data-да ssm agent іске қосу және оны автоматты жүктелуге қосу. Екінші қадам - EC2 инстансына байланыстырылған рөл үшін AmazonSSMManagedInstanceCore policy қосу. Онда AWS Systems Manager немесе қысқаша SSM арқылы инстансқа қосылу үшін барлық қажетті құқықтар мен рұқсаттар бар. Біз тапсырмалардың екінші бөлігіне жеттік. Бұл блоктағы бірінші тапсырма кесте құрылымын және деректерімізді бар кестеден экспорттау болады. Ал екінші тапсырмада EC2 инстансын RDS инстансына қосылымын баптап көреміз. Ендеше, бастайық. Terminal терезесіне келесі командаларды енгізіп, дерекқордың күйін қарайық. Егер оның жұмыс істеп тұрғанын және белсенді екенін көрсек, онда алға қарай жылжи аламыз. Келесі қадам - Parameter store сервисін ашуымыз керек, ол жерден /cafe/dbPassword параметрін табуымыз керек және мән ретінде бізде бар дерекқордың құпия сөзі болады. Бұл мәнді көшіріп, Terminal-ға оралуымыз керек. Terminal-да келесі команданы енгізіңіз, оны енгізген бойда құпия сөз сұралады. Бұрын көшірген мәнді енгізуіңіз керек. Скриншоттағыдай ұқсас хабарламаны көресіз және ең соңғы жол MariaDB болады және дерекқорға командаларды енгізуді бастауға болатын арнайы промпт болады. Олай болса, келесі қадамға көшеміз. Келесі командалар жинағын енгізу керек. Бірінші қадам - бар дерекқорларды көрсету. Дерекқорларда cafe-db дерекқорын таңдау керек. Бұл дерекқорды таңдағаннан кейін бар кестелердің тізімін аша аламыз. Ол үшін show tables командасын енгізіңіз, сонда біз барлық бар кестелердің тізімін көреміз. Бізді order кестесінің мазмұны қызықтырады. Ол үшін select * from 'order' командасын енгізіңіз. Яғни, парақшада order кестесінің барлық бағандары мен барлық жолдары көрсетіледі. Сіз барлық жасалған тапсырыстарды көресіз. Сондай-ақ, order item кестесінің мазмұнын қарасаңыз, әрбір тапсырыс үшін қандай өнім қандай мөлшерде таңдалғанын көресіз. Жақсы. Егер осының барлығын сәтті іске қоссақ, онда дерекқор дұрыс бапталған, бәрі дұрыс жұмыс істейді және SQL клиентінен шыға аламыз. Ол үшін exit командасын енгізу керек. Шыққаннан кейін дерекқор дампын жасай аламыз. Ол үшін келесі команданы енгізіңіз. Бұл жерде cafe-db дерекқорына root пайдаланушы ретінде қосылып, құпия сөзді енгізіп, CafeDbDump.sql файлында дерекқор дампын сақтайтынымызды ескеріңіз. Біз оны іске қосқаннан кейін қате пайда болмаса, бұл оның сәтті жұмыс істегенін білдіреді. Енді ls командасын енгізсек, файл бар екенін көреміз, сонымен қатар cat CafeDbDump.sql командасын енгізсек, осы файлдың мазмұнын көреміз. Кесте құрылымдарын құру командалары және осы кестелерге деректерді қосу командалары болады. Төртінші тапсырмаға көшеміз, мұнда EC2 инстансынан RDS дерекқор инстансына қосылымды баптаймыз. Ең алдымен, дерекқор инстансының Available күйін күтуіміз керек. Олай болса, келесі қадамдарға көшеміз. Бұл қадамда бірнеше сұрақтарға жауап беруіміз керек. Сұрақтарға жету үшін зертхана парақшасында Details батырмасын басу керек. Ашылмалы тізімде Show батырмасын басыңыз, содан кейін қалқымалы терезеде Access the multiple choice questions сілтемесін басыңыз. Браузерде жаңа қойынды ашылады және бірнеше сұрақты көресіз. Бізге 4 сұраққа жауап беру керек. Бірінші сұрақ: RDS инстансы қай жерде іске қосылады? Екінші сұрақ: RDS инстансының байланған жалпыға ортақ IP мекенжайы бар ма? Үшінші сұрақ: RDS инстансы орналасқан subnet үшін name tag мәнін көрсетіңіз. Және соңғы сұрақ: RDS инстансына қанша security group rules бекітілген? Сұрақтарға бір-бірден жауап беру керек, бұл парақшаны жаппаңыз. Соңында автоматты бағалауды іске қосқан кезде осы сұрақтарға жауаптарыңыз да ескеріледі. Енді RDS инстансына қосылып көреміз. Ол үшін Amazon RDS сервис парақшасындағы дерекқорымыздың негізгі парақшасына өтіп, RDS Endpoint көшіріңіз. Содан кейін слайдта көрсетілген команданы пайдаланып, дерекқорға қосылып көріңіз. Назар аударыңыз, пайдаланушы әртүрлі, ол admin, ал құпия сөз - RDS дерекқор инстансын жасаған кезде ең басында пайдаланған құпия сөз. Сіз команданың орындалмағанын көресіз және мәселе пароль дұрыс емес немесе пайдаланушыда емес, мәселе желі арқылы кіру мүмкіндігі жоқ екендігінде. Мұнда мәселенің не болуы мүмкін екенін және оны қалай шешуге болатынын өзіңіз ойластыру ұсынылады, шешім ретінде RDS инстансының security тобын тексеру керек. TCP 3306 портында кіріс трафикке рұқсат беретін ережелер жоқ екенін ескеріңіз. Біреуін жасайық. Сондай-ақ, source ретінде, яғни бұл трафиктің көзі ретінде барлық IP мекенжайларын пайдалану ұсынылмайтынын, бірақ біздің EC2 инстансына байланысты қауіпсіздік тобын пайдалану ұсынылатынын атап өткім келеді. Сіз оны қалай тексеру керектігін білесіз. Қажетті ережелерді жасағаннан кейін, EC2 инстансынан RDS инстансына кіруді тексерейік. Ол үшін nmap -Pn rds-endpoint командасын енгізіңіз. Рұқсат бар екенін көрсететін хабарлама пайда болады. Осыдан кейін біз алдыңғы команданы пайдаланып инстансымызға қосылуға тырысамыз. Енді қандай дерекқорлар бар екенін көрейік. Ол үшін show databases командасын енгізу керек. Оны енгізгеннен кейін тек 4 жүйелік дерекқорды көресіз және cafe_db дерекқорын көрмейсіз. Барлығы дұрыс, бұл бос дерекқор болғандықтан, біздің cafeDB қолданбасы үшін дерекқор жоқ. Бұл дерекқорды RDS инстансына импорттаймыз. Бәрі жақсы, дерекқорға қосыла алдық. Енді команда жолына оралу үшін exit командасын енгізу керек. Енді тапсырмалардың үшінші блогына көшеміз. Мұнда дерекқорды RDS инстансына импорттаймыз. Сондай-ақ, қосымшаның дұрыс жұмыс істеп тұрғанын тексереміз. Ең алдымен, Terminal-ға келесі команданы енгізу керек. Бұл команда дерекқордың дампын импорттайды. Содан кейін RDS инстансына қосылып, келесі командаларды орындау керек болады. Біз cafe_db дерекқорын көруіміз керек. Order және order items кестесі де пайда болуы керек. Егер бәрі осылай болса және деректер осы кестеде пайда болса, онда бәрі дұрыс импортталған және біз SQL клиентінен шыға аламыз. Алтыншы тапсырмаға көшейік. Мұнда EC2 инстансы RDS инстансымен жұмыс істей алуы үшін қосымша жағында кейбір өзгерістер жасау керек. Мұны істеу үшін Parameter store-ға өтіңіз және кейбір параметрлерді жаңартуымыз керек. Қандай параметрлерді жаңарту қажет екенін өзіңіз талдап көріңіз. Анықтама ретінде: currency, dbName, timeZone және showServerInfo параметрлерін өзгерту қажет емес, олар өзгеріссіз қалады. Барлық қалған параметрлер өзгеруі керек. Келесі кеңес dbUrl параметрі үшін RDS Endpoint мәнін пайдалану керектігін айтады. Барлық қажетті параметрлерді өзгерткеннен кейін EC2 инстансында дерекқорды тоқтатуымыз керек. Ол үшін sudo service mariadb stop командасын енгізіңіз. Осыдан кейін public-ip/cafe/menu.php сілтемесі арқылы веб-қосымшаға қосылуға тырысамыз. Тапсырыс беріп көріңіз. Тапсырысты растағаннан кейін тапсырысыңыз бар парақшаны көресіз. Сондай-ақ, Order history парақшасына өткенде, барлық алдыңғы тапсырыстармен тізімделген тапсырысыңызды көруіңіз керек. Егер бар болса, бұл бәрін дұрыс жасағаныңызды білдіреді. Осылайша, София осы аптаның басты кейіпкері. Барлығы қуанышты. Бәрінен де Фрэнк пен Марта қуанышты. София да қуанышты, өйткені ол дерекқормен байланысты әкімшілік жұмыстарды енді жасамайды. Фрэнк қуанышты, өйткені ол дерекқор қауіпсіз жұмыс істейтініне сенімді. Марта да қуанышты, өйткені ол деректердің жоғалуымен байланысты проблемаларға тап болмайды және бухгалтерлік есеп үшін осы деректермен жұмыс істеуді жалғастырады. Келесі қадам ретінде София EC2 инстансының EBS volume өлшемін азайтуды жоспарлап отыр, өйткені дерекқор бөлек тасымалданған және бұл қосымша бос орындар енді қажет емес. Бұлттағы шығындарды үнемдеу үшін қажет емес data volume алып тастау, сондай-ақ мұндай үлкен өлшемді қажет етпесе, root data volume азайту ұсынылады. Осымен зертханалық жұмысты аяқтадық. Зертханалық жұмыстың негізгі парақшасындағы Submit батырмасын басып, автоматты бағалауды бастағымыз келетінін растап, бағаларымызды көргенше күтуіміз керек. Егер сіз ең көп ұпай жинасаңыз, құттықтаймын, бәрін дұрыс жасадыңыз. Егер жоғары балл болмаса, онда тапсырмалардың қайсысында қате болғанын көре аласыз, сол тапсырмаға оралып, оны түзетуге тырысыңыз. Сондай-ақ, барлық жүйелерден қауіпсіз шығу керек екенін ескеріңіз, бұл AWS Management Console-ге қатысты, жүйеден шығу керек, сонымен қатар AWS Academy-дегі зертханалық жұмысты аяқтау керек. Осымен зертханалық жұмысқа шолу аяқталды. Сіз бірден өзіңіз жасай аласыз деп үміттенемін және Amazon RDS туралы жақсырақ түсіндіңіз деп үміттенемін. Назарларыңызға рахмет, келесі белсенділіктерде кездескенше.